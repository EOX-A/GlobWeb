/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/var o=!0,q=null,u=!1;function aa(a){return function(){return this[a]}}var v,ba=ba||{};var ca=Array;function x(a){var b=new ca(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b}function da(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]}function ea(a,b,c){if(!c||a==c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c}function y(a,b,c){if(!c||a==c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c}function E(a,b,c){if(!c||a==c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c}
function F(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(!f)return b[0]=0,b[1]=0,b[2]=0,b;if(1==f)return b[0]=c,b[1]=d,b[2]=e,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b}function fa(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f;return c}function ga(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)}function ha(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function G(){return new ca(16)}
function H(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],k=a[5],i=a[6],h=a[7],l=a[8],m=a[9],j=a[10],n=a[11],p=a[12],r=a[13],t=a[14],s=a[15],w=c*k-d*g,z=c*i-e*g,D=c*h-f*g,B=d*i-e*k,A=d*h-f*k,P=e*h-f*i,Q=l*r-m*p,R=l*t-j*p,S=l*s-n*p,T=m*t-j*r,U=m*s-n*r,V=j*s-n*t,C=1/(w*V-z*U+D*T+B*S-A*R+P*Q);b[0]=(k*V-i*U+h*T)*C;b[1]=(-d*V+e*U-f*T)*C;b[2]=(r*P-t*A+s*B)*C;b[3]=(-m*P+j*A-n*B)*C;b[4]=(-g*V+i*S-h*R)*C;b[5]=(c*V-e*S+f*R)*C;b[6]=(-p*P+t*D-s*z)*C;b[7]=(l*P-j*D+n*z)*C;b[8]=(g*U-k*S+h*Q)*C;b[9]=(-c*U+
d*S-f*Q)*C;b[10]=(p*A-r*D+s*w)*C;b[11]=(-l*A+m*D-n*w)*C;b[12]=(-g*T+k*R-i*Q)*C;b[13]=(c*T-d*R+e*Q)*C;b[14]=(-p*B+r*z-t*w)*C;b[15]=(l*B-m*z+j*w)*C}
function I(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],k=a[4],i=a[5],h=a[6],l=a[7],m=a[8],j=a[9],n=a[10],p=a[11],r=a[12],t=a[13],s=a[14],a=a[15],w=b[0],z=b[1],D=b[2],B=b[3],A=b[4],P=b[5],Q=b[6],R=b[7],S=b[8],T=b[9],U=b[10],V=b[11],C=b[12],pa=b[13],qa=b[14],b=b[15];c[0]=w*d+z*k+D*m+B*r;c[1]=w*e+z*i+D*j+B*t;c[2]=w*f+z*h+D*n+B*s;c[3]=w*g+z*l+D*p+B*a;c[4]=A*d+P*k+Q*m+R*r;c[5]=A*e+P*i+Q*j+R*t;c[6]=A*f+P*h+Q*n+R*s;c[7]=A*g+P*l+Q*p+R*a;c[8]=S*d+T*k+U*m+V*r;c[9]=S*e+T*i+U*j+V*t;c[10]=S*f+T*h+U*n+V*s;
c[11]=S*g+T*l+U*p+V*a;c[12]=C*d+pa*k+qa*m+b*r;c[13]=C*e+pa*i+qa*j+b*t;c[14]=C*f+pa*h+qa*n+b*s;c[15]=C*g+pa*l+qa*p+b*a}function ia(a,b){var c;c||(c=b);var d=b[0],e=b[1],f=b[2];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12];c[1]=a[1]*d+a[5]*e+a[9]*f+a[13];c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]}function ja(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b}
function ka(a,b,c,d,e){var a=c*Math.tan(a*Math.PI/360),b=a*b,f=-b,g=-a;e||(e=G());var k=b-f,i=a-g,h=d-c;e[0]=2*c/k;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*c/i;e[6]=0;e[7]=0;e[8]=(b+f)/k;e[9]=(a+g)/i;e[10]=-(d+c)/h;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(2*d*c)/h;e[15]=0}
function la(a,b,c,d){d||(d=G());var e=a[0],f=a[1],a=a[2],g=c[0],k=c[1],i=c[2],c=b[1],h=b[2];if(e==b[0]&&f==c&&a==h)d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0;else{var l,m,j,n,c=e-b[0],h=f-b[1],b=a-b[2];n=1/Math.sqrt(c*c+h*h+b*b);c*=n;h*=n;b*=n;l=k*b-i*h;i=i*c-g*b;g=g*h-k*c;(n=Math.sqrt(l*l+i*i+g*g))?(n=1/n,l*=n,i*=n,g*=n):g=i=l=0;k=h*g-b*i;m=b*l-c*g;j=c*i-h*l;(n=Math.sqrt(k*k+m*m+j*j))?(n=1/n,k*=n,m*=n,j*=n):j=m=k=0;d[0]=l;d[1]=k;
d[2]=c;d[3]=0;d[4]=i;d[5]=m;d[6]=h;d[7]=0;d[8]=g;d[9]=j;d[10]=b;d[11]=0;d[12]=-(l*e+i*f+g*a);d[13]=-(k*e+m*f+j*a);d[14]=-(c*e+h*f+b*a)}d[15]=1};function ma(a,b){a.a.Lb=this;this.c=a;var c=b?b.element:void 0;c&&(this.element="string"==typeof c?document.getElementById(c):c);this.dd=a.a.Wb;this.jd=b&&b.verbose?b.verbose:u;this.W=0;var d=this;window.setInterval(function(){d.print()},1E3)}ma.prototype.start=function(a){this[a]=Date.now()};ma.prototype.end=function(a){var b=Date.now()-this[a],c=this["max_"+a]||-1;c<b&&(c=b);var d=this["sum_"+a]||0;this[a]=b;this["max_"+a]=c;this["sum_"+a]=d+b;"globalRenderTime"==a&&this.W++};
ma.prototype.print=function(){if(0<this.W){var a="";this.dd&&(a+="FPS : "+this.W);a+="<br>Average render time : "+(this.sum_globalRenderTime/this.W).toFixed(2)+" ms";a+="<br># rendered tiles : "+this.c.j.ha.length;this.jd&&(a+="<br>Average traverse tiles time : "+(this.sum_traverseTime/this.W).toFixed(2)+" ms",a+="<br>Average render tiles time : "+(this.sum_renderTime/this.W).toFixed(2)+" ms",a+="<br>Average generate tiles time : "+(this.sum_generateTime/this.W).toFixed(2)+" ms",a+="<br>Average request tiles time : "+
(this.sum_requestTime/this.W).toFixed(2)+" ms",a+="<br>Max render time : "+this.max_globalRenderTime+" ms",a+="<br>Max traverse tiles time : "+this.max_traverseTime+" ms",a+="<br>Max render tiles time : "+this.max_renderTime+" ms",a+="<br>Max generate tiles time : "+this.max_generateTime+" ms",a+="<br>Max request tiles time : "+this.max_requestTime+" ms");this.element.innerHTML=a;this.W=this.max_requestTime=this.max_generateTime=this.max_renderTime=this.max_traverseTime=this.max_globalRenderTime=
this.sum_requestTime=this.sum_generateTime=this.sum_renderTime=this.sum_traverseTime=this.sum_globalRenderTime=0}};function na(a,b){function c(){}c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b};function J(a,b,c,d){this.Ya=b;this.ia=a;this.ra=d;this.Oa=c}J.prototype.Bc=aa("ra");J.prototype.Cc=aa("Ya");J.prototype.Ec=aa("ia");J.prototype.Ac=aa("Oa");function oa(a,b){a&&(this.min=x(a));b&&(this.max=x(b))}oa.prototype.extend=function(a,b,c){this.min?(a<this.min[0]&&(this.min[0]=a),b<this.min[1]&&(this.min[1]=b),c<this.min[2]&&(this.min[2]=c),a>this.max[0]&&(this.max[0]=a),b>this.max[1]&&(this.max[1]=b),c>this.max[2]&&(this.max[2]=c)):(this.min=x(),this.max=x(),this.min[0]=a,this.min[1]=b,this.min[2]=c,this.max[0]=a,this.max[1]=b,this.max[2]=c)};
oa.prototype.sb=function(a,b,c){this.min||(this.min=x(),this.max=x());this.min[0]=a[0];this.min[1]=a[1];this.min[2]=a[2];this.max[0]=a[0];this.max[1]=a[1];this.max[2]=a[2];for(var d=c||3,b=b||a.length;c<b;c+=d)for(var e=0;3>e;e++)a[c+e]<this.min[e]&&(this.min[e]=a[c+e]),a[c+e]>this.max[e]&&(this.max[e]=a[c+e])};function ra(a){var b=x();y(a.max,a.min,b);return 0.5*ga(b)};function sa(a){a-=1;return 1-a*a}function ta(a,b,c,d){d||(d=x());E(b,c,d);ea(d,a,d);return d}function ua(a,b,c,d,e,f,g,k){var i=(k-f)*(c-a)-(g-e)*(d-b);return 0==i?[-1,-1]:[((g-e)*(b-f)-(k-f)*(a-e))/i,((c-a)*(b-f)-(d-b)*(a-e))/i]}function va(a,b,c){var d=K.t,a=y(a,c,x()),b=2*ha(b,a),a=b*b-4*(ha(a,a)-d*d);if(0>a)return-1;a=Math.sqrt(a);d=(-b-a)/2;b=(-b+a)/2;d>b&&(a=d,d=b,b=a);return 0>b?-1:0>d?b:d}function wa(a,b){var c;c||(c=b);ja(a,b,c);var d=1/c[3];c[0]*=d;c[1]*=d;c[2]*=d;return c};function L(){this.mb=this.startTime=-1;this.c=q}L.prototype.start=function(){if(this.c&&(-1==this.startTime||-1!=this.mb)){var a=Date.now();-1==this.startTime?this.startTime=a:(this.startTime=a-this.mb,this.mb=-1);this.c.ja.push(this);M(this.c.a)}};L.prototype.stop=function(){this.mb=this.startTime=-1;this.kc&&this.kc();this.c.ja.splice(this.c.ja.indexOf(this),1)};function xa(a,b,c,d,e){L.prototype.constructor.call(this);this.Z=[[0,b],[1,c]];this.duration=a;this.Gc=d;this.Ib=e}na(L,xa);xa.prototype.start=function(){L.prototype.start.call(this);this.Ib(this.Kb)};xa.prototype.stop=function(){L.prototype.stop.call(this);this.Ib(this.ub)};
xa.prototype.update=function(a){a=this.startTime!=this.startTime+this.duration?(a-this.startTime)/(this.startTime+this.duration-this.startTime):0;if(1<=a)this.stop();else{for(var b=this.Z.length,c=0;c<b&&this.Z[c][0]<a;)c++;c=Math.min(c,b-1);b=Math.max(0,c-1);a=this.Z[b][0]!=this.Z[c][0]?(a-this.Z[b][0])/(this.Z[c][0]-this.Z[b][0]):0;a=this.Gc(a,this.Z[b][1],this.Z[c][1]);this.Ib(a)}};function ya(a,b){L.prototype.constructor.call(this);this.n=[];this.duration=a;this.Ia=b}na(L,ya);function za(a,b,c,d,e){this.start=a;this.Kb=b;this.end=c;this.ub=d;this.Hc=e}function Aa(a,b,c,d,e,f){for(var g=a.n.length,k=0;k<g&&a.n[k].end<=b;)k++;a.n.splice(k,0,new za(b,c,d,e,f))}ya.prototype.start=function(){L.prototype.start.call(this);this.Ia(this.n[0].Kb)};ya.prototype.stop=function(){L.prototype.stop.call(this);this.Ia(this.n[this.n.length-1].ub)};
ya.prototype.update=function(a){a=this.startTime!=this.startTime+this.duration?(a-this.startTime)/(this.startTime+this.duration-this.startTime):0;if(1<=a)this.stop();else{for(var b=this.n.length,c=0;c<b&&this.n[c].end<a;)c++;c=Math.min(c,b-1);a=this.n[c].start!=this.n[c].end?(a-this.n[c].start)/(this.n[c].end-this.n[c].start):0;a=this.n[c].Hc(a,this.n[c].Kb,this.n[c].ub);this.Ia(a)}};var K={t:1,ib:1/6356752.3142,Uc:6356752.3142,ca:function(a,b){b||(b=Array(3));var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,e=Math.cos(d),f=K.t+(2<a.length?K.ib*a[2]:0);b[0]=f*Math.cos(c)*e;b[1]=f*Math.sin(c)*e;b[2]=f*Math.sin(d);return b},xa:function(a,b){b||(b=Array(3));var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=Math.asin(a[2]/c);b[0]=180*Math.atan2(a[1]/c,a[0]/c)/Math.PI;b[1]=180*d/Math.PI;b[2]=K.Uc*Math.abs(c-K.t);return b},pd:function(a,b){b||(b=Array(3));var c=[];K.xa(a,c);K.ac(c,b);return b},
qd:function(a,b){b||(b=Array(3));var c=[];K.$b(a,c);K.ca(c,b);return b},$b:function(a,b){b||(b=[]);var c=a[0].split(" "),d=parseFloat(c[0]),e=parseFloat(c[1]),c=parseFloat(c[2]);b[0]=15*(d+e/60+c/3600);180<b[0]&&(b[0]-=360);var f=a[1].split(" "),d=parseFloat(f[0]),e=parseFloat(f[1]),c=parseFloat(f[2]);b[1]=("-"==f[0][0]?-1:1)*(Math.abs(d)+e/60+c/3600);return b},ac:function(a,b){b||(b=[]);var c=a[0];0>c&&(c+=360);var d=Math.abs(c/15),c=Math.floor(d),d=60*(d-c),e=Math.floor(d);b[0]=c+" "+e+" "+60*(d-
e);d=Math.abs(a[1]);c=Math.floor(d);d=60*(d-c);e=Math.floor(d);b[1]=(0<=a[1]?"":"-")+""+c+" "+e+" "+60*(d-e);return b},vd:function(a,b){b||(b=G());var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,d=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],c=[-Math.sin(c),Math.cos(c),0],e=x();fa(d,c,e);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=0;b[4]=e[0];b[5]=e[1];b[6]=e[2];b[7]=0;b[8]=d[0];b[9]=d[1];b[10]=d[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},ud:function(a,b){b||(b=G());var c=a[0]*Math.PI/
180,d=a[1]*Math.PI/180,d=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],c=[-Math.sin(c),Math.cos(c),0],e=x();fa(d,c,e);var f=K.ca(a);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=0;b[4]=e[0];b[5]=e[1];b[6]=e[2];b[7]=0;b[8]=d[0];b[9]=d[1];b[10]=d[2];b[11]=0;b[12]=f[0];b[13]=f[1];b[14]=f[2];b[15]=1;return b},wd:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},td:function(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6];return b},xd:function(a,b){b[0]=a[8];b[1]=a[9];b[2]=a[10];return b}};function Ba(){this.m=x([0,0,0]);this.va=0}function Ca(a,b,c){var d=[0,0,0],e=[],f=[];y(b,d,e);y(c,d,f);fa(e,f,a.m);F(a.m);a.va=-ha(d,a.m)}Ba.prototype.h=function(a){return a[0]*this.m[0]+a[1]*this.m[1]+a[2]*this.m[2]+this.va};function Da(){this.D=[new Ba,new Ba,new Ba,new Ba]}Da.prototype.sb=function(a){var b=G();H(a,b);var a=wa(b,[-1,-1,-1,1]),c=wa(b,[-1,1,-1,1]),d=wa(b,[1,1,-1,1]),b=wa(b,[1,-1,-1,1]);Ca(this.D[0],a,c);Ca(this.D[1],c,d);Ca(this.D[2],d,b);Ca(this.D[3],b,a)};
function Ea(a,b,c){for(var d=0;d<b.D.length;d++){var e=b.D[d],f=e.m[0],g=e.m[1],k=e.m[2],i=e.va,e=a.D[d];e.m[0]=c[0]*f+c[1]*g+c[2]*k+c[3]*i;e.m[1]=c[4]*f+c[5]*g+c[6]*k+c[7]*i;e.m[2]=c[8]*f+c[9]*g+c[10]*k+c[11]*i;e.va=c[12]*f+c[13]*g+c[14]*k+c[15]*i}};function Fa(a){this.Ed=a.shadersPath||"../shaders/";this.gd=a.tileErrorTreshold||4;this.Aa=a.lighting||u;this.Wb=a.continuousRendering||u;var b=this.Lb=q;if(!a.canvas)throw"GlobWeb : no canvas in options";b="string"==typeof a.canvas?document.getElementById(a.canvas):a.canvas;if(!b instanceof HTMLCanvasElement)throw"GlobWeb : invalid canvas";for(var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=q,e=0;e<c.length&&d==q;++e)try{d=b.getContext(c[e],a.contextAttribs)}catch(f){}if(d==q)throw"GlobWeb : WebGL context cannot be initialized";
a.backgroundColor?(a=a.backgroundColor,d.clearColor(a[0],a[1],a[2],a[3])):d.clearColor(0,0,0,1);d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE);d.enable(d.DEPTH_TEST);d.enable(d.CULL_FACE);this.u=G();this.M=G();this.R=G();this.f=d;this.canvas=b;this.bc=new Da;this.Nb=new Da;this.Ic=new Da;this.wb=x();this.vb=x();this.lb=1E-5;this.Ta=Fa.lb;this.la=6;this.N=0;this.yb=u;this.Zb=45;window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)})}function M(a){a.yb||(window.requestAnimationFrame(a.frame),a.yb=o)}
function Ga(a){var b=a.canvas.width,c=a.canvas.height,d=a.R,a=a.u,e=0.5*d[0]*b,b=0.5*d[8]*b+0.5*d[11]*b,b=[a[0]*e+a[2]*b,a[4]*e+a[6]*b,a[8]*e+a[10]*b],e=0.5*d[5]*c,c=0.5*d[9]*c+0.5*d[11]*c,c=[a[1]*e+a[2]*c,a[5]*e+a[6]*c,a[9]*e+a[10]*c],e=d[11],d=[a[2]*e,a[6]*e,a[10]*e,a[14]*e+a[15]*d[15]],a=0.7071067811/Math.sqrt(ha(b,b)+ha(c,c));d[0]*=a;d[1]*=a;d[2]*=a;d[3]*=a;return d}
function Ha(a,b,c){var b=2*(b/a.canvas.width)-1,d=-(2*(c/a.canvas.height)-1),e=G();I(a.R,a.u,e);H(e);c=[];ja(e,[b,d,0,1],c);c[0]/=c[3];c[1]/=c[3];c[2]/=c[3];H(a.u,e);a=[e[12],e[13],e[14]];b=x();y(c,a,b);F(b);c=va(a,b,[0,0,0]);return 0<=c?ta(a,b,c):q}
function Ia(a,b){var c=a.f,d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);return d};function Ja(a){this.a=a;this.eb=this.r=this.S=this.i=q;this.hc=0;this.mode=a.f.TRIANGLES}function Ka(a,b){var c=a.a.f;a.i==q&&(a.i=c.createBuffer());c.bindBuffer(c.ARRAY_BUFFER,a.i);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW);a.hc=b.length}function La(a,b){var c=a.a.f;a.r==q&&(a.r=c.createBuffer());c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a.r);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),c.STATIC_DRAW);a.X=b.length}
Ja.prototype.A=function(a){var b=this.a.f;b.bindBuffer(b.ARRAY_BUFFER,this.i);b.vertexAttribPointer(a.vertex,3,b.FLOAT,u,0,0);a.hasOwnProperty("tcoord")&&(b.bindBuffer(b.ARRAY_BUFFER,this.S),b.vertexAttribPointer(a.tcoord,2,b.FLOAT,u,0,0));a.hasOwnProperty("color")&&(b.bindBuffer(b.ARRAY_BUFFER,this.eb),b.vertexAttribPointer(a.color,4,b.FLOAT,u,0,0));this.r?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.r),b.drawElements(this.mode,this.X,b.UNSIGNED_SHORT,0)):b.drawArrays(this.mode,0,this.hc/3)};
Ja.prototype.K=function(){var a=this.a.f;this.r&&a.deleteBuffer(this.r);this.i&&a.deleteBuffer(this.i);this.S&&a.deleteBuffer(this.S);this.eb&&a.deleteBuffer(this.eb);this.eb=this.S=this.i=this.r=q};function Ma(a){this.a=a;this.q=q;this.attributes={};this.k={};this.N=0}Ma.prototype.createShader=function(a,b){var c=this.a.f,d=c.createShader(a);c.shaderSource(d,b);c.compileShader(d);return!c.getShaderParameter(d,c.COMPILE_STATUS)?(console.log("Shader compilation error: "+c.getShaderInfoLog(d)),c.deleteShader(d),q):d};
function Na(a,b,c){var d=a.a.f,b=a.createShader(d.VERTEX_SHADER,b),c=a.createShader(d.FRAGMENT_SHADER,c);if(!(b==q||c==q))if(a.q=d.createProgram(),d.attachShader(a.q,b),d.attachShader(a.q,c),d.linkProgram(a.q),d.getProgramParameter(a.q,d.LINK_STATUS)){b=d.getProgramParameter(a.q,d.ACTIVE_ATTRIBUTES);for(c=a.N=0;c<b;++c){var e=d.getActiveAttrib(a.q,c),f=d.getAttribLocation(a.q,e.name);a.attributes[e.name]=f;f+1>a.N&&(a.N=f+1)}b=d.getProgramParameter(a.q,d.ACTIVE_UNIFORMS);for(c=0;c<b;++c)e=d.getActiveUniform(a.q,
c),a.k[e.name]=d.getUniformLocation(a.q,e.name)}else console.log("Program link error: "+d.getProgramInfoLog(a.q)),d.deleteShader(b),d.deleteShader(c),d.deleteProgram(a.q),a.q=q}Ma.prototype.apply=function(){var a=this.a,b=a.f;b.useProgram(this.q);for(var c=a.N;c<this.N;c++)b.enableVertexAttribArray(c);for(c=this.N;c<a.N;c++)b.disableVertexAttribArray(c);a.N=this.N};function Oa(a,b){this.a=a;this.g=b;this.sa=q;this.Ea=[q,q,q,q];this.Ka=q;this.Fa=[q,q,q,q];this.ed=[q,q,q,q]}Oa.prototype.reset=function(){for(var a=this.a.f,b=0;4>b;b++)this.Ea[b]&&(a.deleteBuffer(this.Ea[b]),this.Ea[b]=q);this.sa&&(a.deleteBuffer(this.sa),this.sa=q);for(b=0;4>b;b++)this.Fa[b]&&(a.deleteBuffer(this.Fa[b]),this.Fa[b]=q);this.Ka&&(a.deleteBuffer(this.Ka),this.Ka=q)};function Pa(){this.parent=q;this.Ua=-1;this.i=this.G=this.b=this.children=q;this.mc=[1,1,0,0];this.Sa=this.V=q;this.H=new oa;this.h=this.t=0;this.Ub=[0,0,0];this.p={};this.state=N;this.g=q}var N=0;function Qa(a,b,c){for(var d=Math.floor(c),c=c-d,e=Math.floor(b),b=b-e,f=a.g.B,g=a.g.T,d=g*(d*f+e),e=[0,0,0],k=0;3>k;k++)e[k]=(1-c)*(1-b)*a.b[d+k]+c*(1-b)*a.b[d+g*f+k]+c*b*a.b[d+g*f+g+k]+(1-c)*b*a.b[d+g+k];return e}
function Ra(a,b,c,d){a.parent=b;a.Ua=2*d+c;a.V=b.V;a.Sa=b.Sa;a.G=b.G;a.g=b.g;a.i=b.i;for(var e=a.g.B,f=(e-1)/2,g=0;g<=f;g++)for(var k=a.g.T*((g+d*f)*e+c*f),i=0;i<=f;i++)a.H.extend(b.b[k],b.b[k+1],b.b[k+2]),k+=a.g.T;a.t=ra(a.H)}
function Sa(a,b){var c=a.Sa,d=b.wb,e=c[0]*d[0]+c[4]*d[1]+c[8]*d[2]+c[12],f=c[1]*d[0]+c[5]*d[1]+c[9]*d[2]+c[13],d=c[2]*d[0]+c[6]*d[1]+c[10]*d[2]+c[14],g=Math.sqrt(e*e+f*f+d*d);if(g<a.t)return a.h=0,b.Ta=b.lb,b.la=Math.max(b.la,2*a.t),u;var k=a.Ub;k[0]=Math.min(Math.max(e,a.H.min[0]),a.H.max[0]);k[1]=Math.min(Math.max(f,a.H.min[1]),a.H.max[1]);k[2]=Math.min(Math.max(d,a.H.min[2]),a.H.max[2]);var i=b.vb,h=-(c[0]*i[0]+c[4]*i[1]+c[8]*i[2]),l=-(c[1]*i[0]+c[5]*i[1]+c[9]*i[2]),c=-(c[2]*i[0]+c[6]*i[1]+c[10]*
i[2]),i=k[0],m=k[1],j=k[2]+K.t,i=(h*i+l*m+c*j)/Math.sqrt(i*i+m*m+j*j);a.h=g;i*=a.g.fb;if(-0.05>i)return o;g=b.Ic;Ea(g,b.Nb,a.V);a:{i=a.H;for(m=0;m<g.D.length;m++)if(j=g.D[m],0>(0<=j.m[0]?i.max[0]:i.min[0])*j.m[0]+(0<=j.m[1]?i.max[1]:i.min[1])*j.m[1]+(0<=j.m[2]?i.max[2]:i.min[2])*j.m[2]+j.va){g=u;break a}g=o}return g?(e=-(h*k[0]+l*k[1]+c*k[2]-(h*e+l*f+c*d)),b.Ta=Math.max(b.lb,Math.min(b.Ta,e)),b.la=Math.max(b.la,e+2*a.t),u):o}
Pa.prototype.K=function(a){if(3==this.state){a.Xb(this.i);a.Yb(this.G);for(var b in this.p)this.p[b].K&&this.p[b].K()}this.parent=this.G=this.i=q};function Ta(a,b){if(a.children){for(var c=0;4>c;c++)a.children[c].K(b),Ta(a.children[c],b);a.children=q}}
function Ua(a,b,c,d,e){for(var f=a.b,g=0.05*a.t,k=a.g.B,i=0;i<k;i++){var h=f[c]-b[0],l=f[c+1]-b[1],m=f[c+2]-b[2],j=g/Math.sqrt(h*h+l*l+m*m),h=h*j,l=l*j,m=m*j;f[e]=f[c]-h;f[e+1]=f[c+1]-l;f[e+2]=f[c+2]-m;for(h=3;h<a.g.T;h++)f[e+h]=f[c+h];e+=a.g.T;c+=d}}
Pa.prototype.ya=function(a,b){for(var c=this.g.B,d=[],e=1/(c-1),f=this.P&this.Ca*this.Ca-1,g=Va.Vb(f),f=Va.Vb(f>>>1),k=this.P>>>2*this.O,i=0;i<c;i++)for(var h=0;h<c;h++)d[i*c+h]=Va.yc((g+i*e)/this.Ca,(f+h*e)/this.Ca,k);for(var e=G(),g=x(),f=x(),k=x(),l=h=i=0,m=0;m<d.length;m++)i+=d[m][0],h+=d[m][1],l+=d[m][2];i=x([i/d.length,h/d.length,l/d.length]);da(i,k);F(k);y(d[0],d[3],f);fa(k,f,g);F(g);fa(k,g,f);F(f);e[0]=g[0];e[1]=g[1];e[2]=g[2];e[3]=0;e[4]=f[0];e[5]=f[1];e[6]=f[2];e[7]=0;e[8]=k[0];e[9]=k[1];
e[10]=k[2];e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;this.V=e;e=G();H(this.V,e);this.Sa=e;c=new Float32Array(3*c*c);for(f=g=0;f<d.length;f++)c[g]=e[0]*d[f][0]+e[4]*d[f][1]+e[8]*d[f][2]+e[12],c[g+1]=e[1]*d[f][0]+e[5]*d[f][1]+e[9]*d[f][2]+e[13],c[g+2]=e[2]*d[f][0]+e[6]*d[f][1]+e[10]*d[f][2]+e[14],g+=3;this.b=c;d=this.g.B;c=this.g.T;this.H.sb(this.b,c*d*d,c);this.t=ra(this.H);if(this.g.gc){e=this.g.B;g=this.g.T;f=g*e;for(i=k=0;i<e;i++){h=i==e-1?0:f;l=0==i?0:-f;for(m=0;m<e;m++){var j=m==e-1?0:
g,n=0==m?0:-g,j=fa([this.b[k+j]-this.b[k+n],this.b[k+j+1]-this.b[k+n+1],this.b[k+j+2]-this.b[k+n+2]],[this.b[k+h]-this.b[k+l],this.b[k+h+1]-this.b[k+l+1],this.b[k+h+2]-this.b[k+l+2]],[]);F(j);this.b[k+3]=j[0];this.b[k+4]=j[1];this.b[k+5]=j[2];k+=g}}}this.g.Xa&&(e=[0,0,0],ia(this.Sa,e),g=c*d*d,Ua(this,e,0,c,g),g+=c*d,Ua(this,e,c*d*(d-1),c,g),g+=c*d,Ua(this,e,0,c*d,g),g+=c*d,Ua(this,e,c*(d-1),c*d,g),g+=c*d,Ua(this,e,c*(d*(d-1)/2),c,g),Ua(this,e,c*((d-1)/2),c*d,g+c*d));this.i!=q&&this.parent==q&&a.Xb(this.i);
this.i=a.uc(this.b);b&&(this.G=a.vc(b));this.state=3};function Wa(a){var b=a.f,c=[],d=[],e=this;this.Mc=this.Lc=0;this.vc=function(a){if(0<c.length){var d=c.pop();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.RGB,b.RGB,b.UNSIGNED_BYTE,a);b.generateMipmap(b.TEXTURE_2D);e.Mc++}else d=b.createTexture(),b.bindTexture(b.TEXTURE_2D,d),b.texImage2D(b.TEXTURE_2D,0,b.RGB,b.RGB,b.UNSIGNED_BYTE,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.generateMipmap(b.TEXTURE_2D),e.Lc++;return a=d};this.uc=function(a){var c;c=0<d.length?d.pop():b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,a,b.STATIC_DRAW);return c};this.Yb=function(a){c.push(a)};this.Xb=function(a){d.push(a)};this.wc=function(){for(var a=0;a<c.length;a++)b.deleteTexture(c[a]);for(a=c.length=0;a<d.length;a++)b.deleteBuffer(d[a]);d.length=0}};function Xa(a){function b(){M(a)}this.a=a;this.ga=new Wa(a);this.Pa=this.na=q;this.ha=[];this.Ha=[];this.Q=[];this.z=[];this.ea=q;this.Ga=[];for(var c=0;4>c;c++)this.Ga[c]=new Ya(b);this.oa=u;this.C={B:9,Xa:o,fb:1,dc:256,T:a.Aa?6:3,gc:a.Aa};this.S=q;this.ab=new Oa(this.a,this.C);this.Fc=[1,1,0,0];this.freeze=this.Jb=u;this.U=this.Nc=0;c="\tattribute vec3 vertex;\n\tattribute vec2 tcoord;\n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 projectionMatrix;\n\tuniform vec4 texTransform;\n\tvarying vec2 texCoord;\n";
a.Aa&&(c+="attribute vec3 normal;\nvarying vec3 color;\n");c+="\tvoid main(void) \n\t{\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n";a.Aa&&(c+="vec4 vn = modelViewMatrix * vec4(normal,0);\ncolor = max( vec3(-vn[2],-vn[2],-vn[2]), 0.0 );\n");var d="\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\t\n\tvarying vec2 texCoord;\n";a.Aa&&(d+="varying vec3 color;\n");d+="\tuniform sampler2D colorTexture;\n\tuniform int wireframe;\n\t\n\tvoid main(void)\n\t{\n\t\tif(wireframe == 1)\n\t\t\tgl_FragColor.rgb = vec3(1.0,1.0,1.0);\n\t\telse {\n\t\t\tgl_FragColor.rgb = texture2D(colorTexture, texCoord).rgb;\n";
a.Aa&&(d+="gl_FragColor.rgb *= color;\n");this.e=new Ma(this.a);Na(this.e,c+"\t\ttexCoord = vec2(tcoord.s * texTransform.x + texTransform.z, tcoord.t * texTransform.y + texTransform.w);\n\t}\n\t",d+"\t\t}\n\t\tgl_FragColor.a = 1.0;\n\t}\n\t")}Xa.prototype.reset=function(){for(var a=0;a<this.z.length;a++)Ta(this.z[a],this.ga),this.z[a].state=N,this.z[a].K();a=this.a.f;this.ab.reset();a.deleteBuffer(this.S);this.ea=this.S=q};
function Za(a,b,c){a.Oc++;b.U=a.U;b.state==N&&(b.state=1,a.Ha.push(b));var d;if(d=3==b.state)if(d=c+1<a.na.Gb)if(d=a.a,b.h<b.t)d=o;else{var e=b.V,f=b.Ub,g=d.Pc;d=b.t/b.g.dc/((e[0]*f[0]+e[4]*f[1]+e[8]*f[2]+e[12])*g[0]+(e[1]*f[0]+e[5]*f[1]+e[9]*f[2]+e[13])*g[1]+(e[2]*f[0]+e[6]*f[1]+e[10]*f[2]+e[14])*g[2]+g[3])>d.gd}if(d){b.children==q&&(d=new $a(b.O+1,4*b.P,b.face),e=new $a(b.O+1,4*b.P+2,b.face),f=new $a(b.O+1,4*b.P+1,b.face),g=new $a(b.O+1,4*b.P+3,b.face),Ra(d,b,0,0),Ra(e,b,1,0),Ra(f,b,0,1),Ra(g,b,
1,1),b.children=[d,e,f,g]);for(d=0;4>d;d++)Sa(b.children[d],a.a)?Ta(b.children[d],a.ga):Za(a,b.children[d],c+1)}else a.ha.push(b)}
Xa.prototype.A=function(){if(this.na!=q&&this.na.Hb){this.ea==q&&this.na.pa&&(this.ea=Ia(this.a,this.na.pa));var a=this.a.Lb;if(!this.freeze){a&&a.start("traverseTime");this.ha.length=0;this.Oc=this.Ha.length=0;this.a.Ta=1E10;this.a.la=-1;if(!this.oa&&!this.ea){this.oa=o;for(var b=0;b<this.z.length;b++){var c=this.z[b],d=3==c.state;c.U=this.U;this.oa=this.oa&&d;!d&&c.state==N&&(c.state=1,this.Ha.push(c))}}if(this.oa||this.ea)for(b=0;b<this.z.length;b++)c=this.z[b],Sa(c,this.a)?(d=3==c.state,this.ea&&
d&&(this.ga.Yb(c.G),c.G=q,c.state=N),Ta(c,this.ga)):Za(this,c,0);a&&a.end("traverseTime")}if(this.oa||this.ea){a&&a.start("renderTime");b=this.a;c=this.a.f;c.enable(c.POLYGON_OFFSET_FILL);c.polygonOffset(0,4);c.disable(c.CULL_FACE);this.e.apply();d=this.e.attributes;ka(b.Zb,b.canvas.width/b.canvas.height,b.Ta,b.la,b.R);c.activeTexture(c.TEXTURE0);c.uniformMatrix4fv(this.e.k.projectionMatrix,u,b.R);c.uniform1i(this.e.k.colorTexture,0);if(!this.S){var e=this.C.B,f=this.C.Xa,g=2*e*e;f&&(g+=12*e);for(var g=
new Float32Array(g),k=1/(e-1),i=0,h=0,l=0;l<e;l++){for(var m=0,j=0;j<e;j++)g[i]=m,g[i+1]=h,i+=2,m+=k;h+=k}if(f){for(j=h=m=0;j<e;j++)g[i]=m,g[i+1]=h,m+=k,i+=2;m=0;h=1;for(j=0;j<e;j++)g[i]=m,g[i+1]=h,m+=k,i+=2;for(j=h=m=0;j<e;j++)g[i]=m,g[i+1]=h,h+=k,i+=2;m=1;for(j=h=0;j<e;j++)g[i]=m,g[i+1]=h,h+=k,i+=2;m=0;h=0.5;for(j=0;j<e;j++)g[i]=m,g[i+1]=h,m+=k,i+=2;m=0.5;for(j=h=0;j<e;j++)g[i]=m,g[i+1]=h,h+=k,i+=2}e=this.a.f;f=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,f);e.bufferData(e.ARRAY_BUFFER,g,e.STATIC_DRAW);
this.S=f}c.bindBuffer(c.ARRAY_BUFFER,this.S);c.vertexAttribPointer(d.tcoord,2,c.FLOAT,u,0,0);e=g=q;for(f=0;f<this.ha.length;f++){k=this.ha[f];i=3==k.state;h=-1==k.Ua;!i&&h?(c.bindTexture(c.TEXTURE_2D,this.ea),l=k.mc):(c.bindTexture(c.TEXTURE_2D,k.G),l=this.Fc);e!=l&&(c.uniform4f(this.e.k.texTransform,l[0],l[1],l[2],l[3]),e=l);I(b.u,k.V,b.M);c.uniformMatrix4fv(this.e.k.modelViewMatrix,u,b.M);c.bindBuffer(c.ARRAY_BUFFER,k.i);c.vertexAttribPointer(d.vertex,3,c.FLOAT,u,4*this.C.T,0);this.C.gc&&c.vertexAttribPointer(d.normal,
3,c.FLOAT,u,4*this.C.T,12);if(this.Jb){if(i||h){l=this.ab;if(l.Ka==q){for(var j=l.g.B,m=[],n=0;n<j;n++)for(var p=0;p<j-1;p++)m.push(n*j+p),m.push(n*j+p+1);for(n=0;n<j;n++)for(p=0;p<j-1;p++)m.push(p*j+n),m.push((p+1)*j+n);j=l.a.f;n=j.createBuffer();j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,n);j.bufferData(j.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),j.STATIC_DRAW);l.X=m.length;n.X=m.length;l.Ka=n}l=l.Ka}else{l=this.ab;m=k.Ua;if(l.Fa[m]==q){for(var n=m%2,p=Math.floor(m/2),r=l.g.B,t=(r-1)/2,j=[],s=t*p;s<t*(p+
1)+1;s++)for(var w=t*n;w<t*(n+1);w++)j.push(s*r+w),j.push(s*r+w+1);for(s=t*n;s<t*(n+1)+1;s++)for(w=t*p;w<t*(p+1);w++)j.push(w*r+s),j.push((w+1)*r+s);n=l.a.f;p=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,p);n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),n.STATIC_DRAW);p.X=j.length;l.Fa[m]=p}l=l.Fa[m]}g!=l&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,l),g=l);c.uniform1i(this.e.k.wireframe,1);c.drawElements(c.LINES,g.X,c.UNSIGNED_SHORT,0);c.uniform1i(this.e.k.wireframe,0)}if(i||h){k=this.ab;
if(k.sa==q){h=k.g.B;i=[];for(l=0;l<h-1;l++)for(m=0;m<h-1;m++)i.push(l*h+m),i.push((l+1)*h+m),i.push(l*h+m+1),i.push(l*h+m+1),i.push((l+1)*h+m),i.push((l+1)*h+m+1);if(k.g.Xa){j=h*h;for(m=0;m<h-1;m++)i.push(j+m),i.push(m),i.push(j+m+1),i.push(j+m+1),i.push(m),i.push(m+1);j+=h;for(m=0;m<h-1;m++)i.push((h-1)*h+m),i.push(j+m),i.push((h-1)*h+m+1),i.push((h-1)*h+m+1),i.push(j+m),i.push(j+m+1);j+=h;for(l=0;l<h-1;l++)i.push(j+l),i.push(j+l+1),i.push(l*h),i.push(l*h),i.push(j+l+1),i.push((l+1)*h);j+=h;for(l=
0;l<h-1;l++)i.push(l*h+h-1),i.push((l+1)*h+h-1),i.push(j+l),i.push(j+l),i.push((l+1)*h+h-1),i.push(j+l+1)}h=k.a.f;l=h.createBuffer();h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l);h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),h.STATIC_DRAW);k.X=i.length;k.sa=l;k.sa.X=i.length}k=k.sa}else{i=this.ab;k=k.Ua;if(i.Ea[k]==q){l=k%2;m=Math.floor(k/2);j=i.g.B;n=(j-1)/2;h=[];for(p=n*m;p<n*(m+1);p++)for(r=n*l;r<n*(l+1);r++)h.push(p*j+r),h.push((p+1)*j+r),h.push(p*j+r+1),h.push(p*j+r+1),h.push((p+1)*j+r),h.push((p+
1)*j+r+1);i.ed[k]=h;if(i.g.Xa){t=0==m?j*j:j*j+4*j;s=0==m?0:n*j;for(p=n*l;p<n*(l+1);p++)h.push(t+p),h.push(s+p),h.push(t+p+1),h.push(t+p+1),h.push(s+p),h.push(s+p+1);t=0==m?j*j+4*j:j*j+j;s=0==m?n*j:(j-1)*j;for(p=n*l;p<n*(l+1);p++)h.push(s+p),h.push(t+p),h.push(s+p+1),h.push(s+p+1),h.push(t+p),h.push(t+p+1);t=0==l?j*j+2*j:j*j+5*j;s=0==l?0:n;for(r=n*m;r<n*(m+1);r++)h.push(t+r),h.push(t+r+1),h.push(s+r*j),h.push(s+r*j),h.push(t+r+1),h.push(s+(r+1)*j);t=0==l?j*j+5*j:j*j+3*j;s=0==l?n:j-1;for(r=n*m;r<n*
(m+1);r++)h.push(r*j+s),h.push((r+1)*j+s),h.push(t+r),h.push(t+r),h.push((r+1)*j+s),h.push(t+r+1)}l=i.a.f;m=l.createBuffer();l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,m);l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),l.STATIC_DRAW);m.X=h.length;i.Ea[k]=m}k=i.Ea[k]}l=k;g!=l&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,l),g=l);c.drawElements(c.TRIANGLES,g.X,c.UNSIGNED_SHORT,0)}for(f=0;f<this.Q.length;f++)this.Q[f].Kc&&this.Q[f].A(this.ha);c.disable(c.POLYGON_OFFSET_FILL);for(f=0;f<this.Q.length;f++)this.Q[f].Kc||
this.Q[f].A(this.ha);a&&a.end("renderTime")}a&&a.start("generateTime");for(b=0;b<this.Ga.length;b++)if(c=this.Ga[b],(d=c.$a)&&c.qb){if(d.U==this.U){this.Pa?d.ya(this.ga,c.ma,this.Pa.Bd(c.xc)):d.ya(this.ga,c.ma);for(b=0;b<this.Q.length;b++)this.Q[b].ya&&this.Q[b].ya(d);this.Nc++;M(this.a)}else d.state=N;c.$a=q}else d&&c.xb&&(d.state=-10,c.$a=q);a&&a.end("generateTime");a&&a.start("requestTime");this.Ha.sort(function(a,b){return a.h-b.h});b=this.Ha.length;for(c=0;c<b;c++)if(d=this.Ha[c],d.U==this.U){e=
q;for(g=0;g<this.Ga.length;g++)if(!this.Ga[g].$a){e=this.Ga[g];break}e?(e.$a=d,g=q,this.Pa&&(g=ab(this.Pa,d)),f=ab(this.na,d),e.qb=u,e.xb=u,e.Db=u,e.ma.src=f,g&&(e.tb=u,e.La.open("GET",g),e.La.send()),d.state=2):d.state=N}else d.state=N;a&&a.end("requestTime");this.U++}};function bb(a){this.rb=-1;this.oc=q;this.Gb=-1;this.name=a&&a.hasOwnProperty("name")?a.name:"";this.Ad=a&&a.hasOwnProperty("overlay")?a.overlay:u;this.Hb=o;this.c=q}bb.prototype.ta=function(a){this.c=a};bb.prototype.Ob=function(){this.c=q};function Ya(a){this.xb=this.qb=u;this.$a=q;this.Db=u;this.tb=o;this.Sb=a;var b=this;this.ma=new Image;this.ma.crossOrigin="";this.ma.onload=function(){b.Db=o;b.tb&&(b.qb=o,b.Sb())};this.ma.onerror=function(){console.log("Error while loading "+b.ma.src);b.xb=o};this.La=new XMLHttpRequest;this.La.onreadystatechange=function(){4==b.La.readyState&&200==b.La.status&&(b.xc=b.La.responseText,b.tb=o,b.Db&&(b.qb=o,b.Sb()))}};function O(a){this.a=new Fa(a);this.j=new Xa(this.a);this.j.Jb=a.showWireframe;this.Ja=new cb(this);this.Fb=[];this.ja=[];var b=this;this.a.frame=function(){b.a.yb=u;b.A();b.a.Wb?M(b.a):0<b.ja.length&&M(b.a)};M(this.a);a.atmosphere&&(this.$=new ba.rc(this.a))}v=O.prototype;v.K=function(){this.j.ga.wc();this.j.Dd()};v.ad=function(a,b){switch(a){case "atmosphere":b?this.$||(this.$=new ba.rc(this.a)):this.$&&(this.$=q);break;case "showWireframe":this.j.Jb=b}};
v.Zc=function(a){var b=this.j;b.na=a;b.reset();if(a){b.C.dc=a.rb;var c=a.oc,d=b.C,e=b.ga;d.Xa=u;d.fb=-1;d.B=5;for(var f=[],g=Math.pow(c.Ca,2),k=12*g,i=0;i<k;i++){var h=new $a(c.O,i,Math.floor(i/g));h.g=d;f.push(h);h.ya(e);h.state=N}b.z=f;b.oa=u}a.ta(this);M(this.a)};v.Yc=function(a){var b=this.j;b.reset();b.Pa=a;b.C.B=a?a.rb:9;a.ta(this);M(this.a)};v.tc=function(a){this.Fb.push(a);a.ta(this);M(this.a)};v.Wc=function(a){var b=this.Fb.indexOf(a);-1!=b&&(this.Fb.splice(b,1),a.Ob())};
function db(a,b,c){a=a.j.z[0];return 3==a.state?db(a,b,c):0}
v.Dc=function(){var a=this.a,b=G();H(a.u,b);var c=[b[12],b[13],b[14]];I(a.R,a.u,b);H(b);for(var a=[[-1,-1,1,1],[1,-1,1,1],[-1,1,1,1],[1,1,1,1]],d=x(),e=[0,0,0],f=0;4>f;f++){ja(b,a[f]);E(a[f],1/a[f][3]);y(a[f],c,a[f]);F(a[f]);var g=va(c,a[f],e);if(0>g)return q;a[f]=K.xa(ta(c,a[f],g,d))}b=new J;b.ia=a[0][0];b.Oa=a[0][0];b.Ya=a[0][1];b.ra=a[0][1];for(c=1;c<a.length;c++)b.ia=Math.min(b.ia,a[c][0]),b.Oa=Math.max(b.Oa,a[c][0]),b.Ya=Math.min(b.Ya,a[c][1]),b.ra=Math.max(b.ra,a[c][1]);return b};
v.cc=function(a,b){var c=Ha(this.a,a,b);if(c==q)return q;var d=[];K.xa(c,d);return d};
v.A=function(){var a=this.a,b=a.Lb,c=a.f;b&&b.start("globalRenderTime");if(0<this.ja.length)for(var d=Date.now(),e=0;e<this.ja.length;e++)this.ja[e].update(d);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);if(!(0==a.canvas.width||0==a.canvas.height)){c.viewport(0,0,a.canvas.width,a.canvas.height);c=G();H(a.u,c);da([0,0,0],a.wb);ia(c,a.wb);da([0,0,-1],a.vb);var f=a.vb,g;g||(g=f);d=f[0];e=f[1];f=f[2];g[0]=c[0]*d+c[4]*e+c[8]*f;g[1]=c[1]*d+c[5]*e+c[9]*f;g[2]=c[2]*d+c[6]*e+c[10]*f;a.Pc=Ga(a);ka(a.Zb,a.canvas.width/
a.canvas.height,a.lb,a.la,a.R);a.bc.sb(a.R);Ea(a.Nb,a.bc,a.u);this.$&&this.$.Cd(this.j);this.j.A();0!=this.j.ha.length&&(this.$&&this.$.A(),b&&b.end("globalRenderTime"))}};function W(a,b,c,d){L.prototype.constructor.call(this);this.speed=b*K.ib/1E3;this.d=[];for(b=0;b<a.length;b++){var e={position:K.ca(a[b]),I:q,h:0};this.d.push(e);if(0<b){var e=this.d[b].position[0]-this.d[b-1].position[0],f=this.d[b].position[1]-this.d[b-1].position[1],g=this.d[b].position[2]-this.d[b-1].position[2];this.d[b-1].h=Math.sqrt(e*e+f*f+g*g)}}for(b=1;b<a.length-1;b++)e=y(this.d[b+1].position,this.d[b].position,x()),f=y(this.d[b-1].position,this.d[b].position,x()),F(e),F(f),this.d[b].I=
y(e,f,x()),F(this.d[b].I);e=y(this.d[1].position,this.d[0].position,x());E(e,3/this.d[0].h);this.d[0].I=y(e,this.d[1].I,x());E(this.d[0].I,0.5);b=a.length-1;e=y(this.d[b].position,this.d[b-1].position,x());E(e,3/this.d[b-1].h);this.d[b].I=y(e,this.d[b-1].I,x());E(this.d[b].I,0.5);this.c=d;this.ka=this.index=0;this.Wa=-1;this.od=[];this.Tb=-0.2;this.Pb=1E3;var k=this;this.Ia=c?c:function(a,b){var c=F(a,x()),d=K.xa(a);d[2]=db(k.c,d[0],d[1])+k.Pb;var d=K.ca(d),e=F(b,x()),e=ea(d,e,x());ea(e,E(c,k.Tb,
x()));la(d,e,c,Fa.u)}}na(L,W);v=W.prototype;v.bd=function(a){this.speed=parseFloat(a)*K.ib/1E3};v.Xc=function(a){this.Pb=parseFloat(a)};v.$c=function(a){this.Tb=Math.tan(parseFloat(a)*Math.PI/180)};v.start=function(){var a=-1;this.state==L.md.ld&&(a=this.startTime);L.prototype.start.call(this);this.Wa=-1!=a?this.Wa+(this.startTime-a):-1};
v.update=function(a){-1==this.Wa?this.ka=this.index=0:this.ka+=(a-this.Wa)*this.speed;for(this.Wa=a;this.ka>=this.d[this.index].h&&this.index<this.d.length-1;)this.ka-=this.d[this.index].h,this.index+=1;if(this.index<this.d.length-1){var a=this.ka/this.d[this.index].h,b=this.d[this.index].position,c=this.d[this.index+1].position,d=E(this.d[this.index].I,this.d[this.index].h,x()),e=E(this.d[this.index+1].I,this.d[this.index].h,x()),f=a*a,g=f*a,k=2*b[0]-2*c[0]+d[0]+e[0],i=2*b[1]-2*c[1]+d[1]+e[1],h=
2*b[2]-2*c[2]+d[2]+e[2],l=-3*b[0]+3*c[0]-2*d[0]-e[0],m=-3*b[1]+3*c[1]-2*d[1]-e[1],j=-3*b[2]+3*c[2]-2*d[2]-e[2],n=x();n[0]=k*g+l*f+d[0]*a+b[0];n[1]=i*g+m*f+d[1]*a+b[1];n[2]=h*g+j*f+d[2]*a+b[2];f=a*a;g=6*b[0]-6*c[0]+3*d[0]+3*e[0];k=6*b[1]-6*c[1]+3*d[1]+3*e[1];i=6*b[2]-6*c[2]+3*d[2]+3*e[2];h=-6*b[0]+6*c[0]-4*d[0]-2*e[0];l=-6*b[1]+6*c[1]-4*d[1]-2*e[1];b=-6*b[2]+6*c[2]-4*d[2]-2*e[2];c=x();c[0]=g*f+h*a+d[0];c[1]=k*f+l*a+d[1];c[2]=i*f+b*a+d[2];this.Ia(n,c)}else this.index==this.d.length-1?this.Ia(this.d[this.index].position,
this.d[this.index].I):this.stop()};function cb(a){this.c=a;this.Qa=[];for(var a=eb,b=0;b<a.length;b++)this.Qa.push({Na:a[b].Na,Ma:a[b].Ma,za:q})}var eb=[];cb.prototype.o=function(a,b){for(var c=a.geometry.type,d=0;d<this.Qa.length;d++){var e=this.Qa[d];e.Ma(c,b)&&(e.za||(e.za=e.Na(this.c),this.c.j.Q.push(e.za)),e.za.o(a,b))}};cb.prototype.F=function(a){for(var b=0;b<this.Qa.length;b++){var c=this.Qa[b];c.za&&c.za.F(a)}};var fb,X=q;fb={zc:function(a,b){X||(X=document.createElement("canvas"),X.width=512,X.height=20);b||(b="#fff");var c=X.getContext("2d");c.clearRect(0,0,X.width,X.height);c.fillStyle=b;c.font="18px sans-serif";c.textBaseline="top";c.shadowColor="#000";c.shadowOffsetX=1;c.shadowOffsetY=1;c.shadowBlur=2;c.fillText(a,1,1);var d=c.measureText(a);return c.getImageData(0,0,Math.floor(d.width)+2,X.height)}};
function gb(a){this.a=a.a;this.C=a.C;this.l=[];this.ic=0;this.e=new Ma(this.a);Na(this.e,"\tattribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n\tuniform mat4 viewProjectionMatrix; \n\tuniform vec3 poiPosition; // world position \n\tuniform vec2 poiScale; // x,y scale \n\tuniform vec2 tst; \n\t\n\tvarying vec2 texCoord; \n\t\n\tvoid main(void)  \n\t{ \n\t\t// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n\t\ttexCoord = vertex.xy + vec2(0.5) + tst; \n\t\t// Invert y \n\t\ttexCoord.y = 1.0 - texCoord.y; \n\t\t\n\t\t// Compute poi position in clip coordinate \n\t\tgl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n\t\tgl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n\t} \n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\t\n\tvarying vec2 texCoord; \n\tuniform sampler2D texture; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = texture2D(texture, texCoord); \n\t} \n\t");
this.Ba=new Ja(this.a);Ka(this.Ba,[-0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0,0.5,-0.5,0]);La(this.Ba,[0,3,1,1,3,2])}function hb(a,b,c){b.G=Ia(a.a,c);b.nc=c.width;b.Mb=c.height}gb.prototype.o=function(a,b){if(b){var c=this.zb(b);if(b.label){var d=fb.zc(a.properties.name,a.properties.textColor);hb(this,c,d)}var d=K.ca(a.geometry.coordinates),e=x();F(d,e);c.fa.push({Rc:d,kd:e,hb:a})}};
gb.prototype.F=function(a){for(var b=0;b<this.l.length;b++)for(var c=this.l[b],d=0;d<c.fa.length;d++)if(c.fa[d].hb==a){c.fa.splice(d,1);return}};gb.prototype.zb=function(a){if(!a.label)for(var b=0;b<this.l.length;b++){var c=this.l[b];if(c.style.Cb==a.Cb&&c.style.Bb==a.Bb&&c.style.label==c.style.label)return c}c={G:q,fa:[],style:a};if(a.iconUrl){var d=new Image,e=this;d.onload=function(){hb(e,c,d)};d.src=a.Cb}else a.icon&&hb(this,c,a.Bb);this.l.push(c);return c};
gb.prototype.A=function(){if(0!=this.l.length){this.ic=0;var a=this.a,b=this.a.f;b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.e.apply();I(a.R,a.u,a.M);b.uniformMatrix4fv(this.e.k.viewProjectionMatrix,u,a.M);b.uniform1i(this.e.k.texture,0);H(a.u,a.M);var c=[a.M[8],a.M[9],a.M[10]];F(c);E(c,this.C.fb,c);for(var d=Ga(a),e=0;e<this.l.length;e++){var f=this.l[e];if(!(f.G==q||0==f.fa.length)){b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,f.G);
var g=[2*f.nc/a.canvas.width,2*f.Mb/a.canvas.height];b.uniform2fv(this.e.k.poiScale,g);b.uniform2fv(this.e.k.tst,[0.5/f.nc,0.5/f.Mb]);for(var k=0;k<f.fa.length;++k){var i=f.fa[k].Rc,h=f.fa[k].kd,g=f.Mb*(d[0]*i[0]+d[1]*i[1]+d[2]*i[2]+d[3]),g=g*this.C.fb,l;if(l=!(0.001*(g/K.ib)>f.style.Qc))if(l=0<ha(h,c)){a:{l=a.Nb;for(var m=1,j=0;j<l.D.length;j++){var n=l.D[j].m,n=i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+l.D[j].va;if(n<=g){if(n<-g){l=-1;break a}m=0}}l=m}l=0<=l}l&&(b.uniform3f(this.e.k.poiPosition,h[0]*g+i[0],
h[1]*g+i[1],h[2]*g+i[2]),this.Ba.A(this.e.attributes),this.ic++)}}}b.disable(b.BLEND)}};eb.push({Na:function(a){return new gb(a.j)},Ma:function(a){return"Point"==a}});function ib(a){this.strokeColor=[1,0,0,1];this.fillColor=[1,0,0,1];this.pb=1;this.Cb="hotspot.png";this.label=this.Bb=q;this.fill=u;this.Qc=40;if(a)for(var b in a)this[b]=a[b]};function jb(a,b){this.f=b;this.style=a;this.r=this.i=q;this.b=[];this.s=[];this.L=[];this.gb=this.wa=o;this.ba=this.v=q;this.Ab=-1}v=jb.prototype;v.Rb=function(){this.ba=[[],[],[],[]];this.v=[q,q,q,q]};
v.F=function(a){for(var b=-1,c=0;c<this.L.length;c++){var d=this.L[c];if(d.hb==a){this.b.splice(d.ob,d.cb);this.s.splice(d.Za,d.Eb);a=d.cb/3;for(d=d.Za;d<this.s.length;d++)this.s[d]-=a;b=c;break}}if(0<=b){this.gb=this.wa=o;for(c=b+1;c<this.L.length;c++)d=this.L[c],d.ob-=this.L[b].cb,d.Za-=this.L[b].Eb;this.L.splice(b,1);kb(this);this.ba=q;return o}return u};
v.o=function(a,b){var c=q,d=u;a._crossDateLine&&0>b.da.ia&&(d=o);var e=a.geometry;"Polygon"==e.type?(c=d?e._negCoordinates[0]:e.coordinates[0],(c[0][0]!=c[c.length-1][0]||c[0][1]!=c[c.length-1][1])&&c.push(c[0])):"LineString"==e.type&&(c=d?e._negCoordinates:e.coordinates);if(c!=q){for(var d={hb:a,ob:this.b.length,Za:this.s.length,cb:0,Eb:0},e=b.da.Oa-b.da.ia,f=b.da.Ya-b.da.ra,g=b.g.B,k=b.g.T,i=0;i<c.length-1;i++){for(var h=(g-1)*(c[i][0]-b.da.ia)/e,l=(g-1)*(c[i][1]-b.da.ra)/f,m=(g-1)*(c[i+1][0]-b.da.ia)/
e,j=(g-1)*(c[i+1][1]-b.da.ra)/f,n=Math.max(-1,Math.min(h,m)),p=Math.min(g-1,Math.max(h,m)),r=Math.max(-1,Math.min(l,j)),t=Math.min(g-1,Math.max(l,j)),s=[],n=Math.floor(n)+1;n<Math.floor(p)+1;n++){var w=n,z=ua(h,l,m,j,w,0,w,g-1);if(0<z[0]&&1>z[0]&&0<z[1]&&1>z[1]){var D=z[1]*(g-1),w=Math.floor(D),B=D-w,A=k*(w*g+n),w=(1-B)*b.b[A]+B*b.b[A+k*g],D=(1-B)*b.b[A+1]+B*b.b[A+k*g+1],B=(1-B)*b.b[A+2]+B*b.b[A+k*g+2];s.push([z[0],w,D,B])}}for(n=Math.floor(r)+1;n<Math.floor(t)+1;n++)D=n,z=ua(h,l,m,j,0,D,g-1,D),0<
z[0]&&(1>z[0]&&0<z[1]&&1>z[1])&&(w=z[1]*(g-1),r=Math.floor(w),p=w-r,A=k*(n*g+r),w=(1-p)*b.b[A]+p*b.b[A+k],D=(1-p)*b.b[A+1]+p*b.b[A+k+1],B=(1-p)*b.b[A+2]+p*b.b[A+k+2],s.push([z[0],w,D,B]));s.sort(function(a,b){return a[0]>b[0]});t=this.b.length/3;0<h&&(h<g-1&&0<l&&l<g-1)&&(h=Qa(b,h,l),this.b.push(h[0]),this.b.push(h[1]),this.b.push(h[2]));for(n=0;n<s.length;n++)this.b.push(s[n][1]),this.b.push(s[n][2]),this.b.push(s[n][3]);0<m&&(m<g-1&&0<j&&j<g-1)&&(h=Qa(b,m,j),this.b.push(h[0]),this.b.push(h[1]),
this.b.push(h[2]));m=this.b.length/3;for(n=t;n<m-1;n++)this.s.push(n),this.s.push(n+1)}d.cb=this.b.length-d.ob;d.Eb=this.s.length-d.Za;return 0<d.cb?(this.L.push(d),this.gb=this.wa=o,kb(this),this.ba=q,o):u}};function kb(a){var b=a.f;a.v&&(a.v[0]&&b.deleteBuffer(a.v[0]),a.v[1]&&b.deleteBuffer(a.v[1]),a.v[2]&&b.deleteBuffer(a.v[2]),a.v[3]&&b.deleteBuffer(a.v[3]));a.v=q}v.K=function(){var a=this.f;this.r&&a.deleteBuffer(this.r);this.i&&a.deleteBuffer(this.i);kb(this);this.i=this.r=q};
v.A=function(a){var b=this.f;this.i==q&&(this.i=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.i);this.wa&&(b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.b),b.STATIC_DRAW),this.wa=u);b.vertexAttribPointer(a.vertex,3,b.FLOAT,u,0,0);this.r==q&&(this.r=b.createBuffer());b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.r);this.gb&&(b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.s),b.STATIC_DRAW),this.gb=u);b.drawElements(this.Ab,this.s.length,b.UNSIGNED_SHORT,0)};function lb(a,b){jb.prototype.constructor.call(this,a,b);this.Ab=b.LINES}na(jb,lb);lb.prototype.Rb=function(){this.ba=[[],[],[],[]];this.v=[q,q,q,q];for(var a=0;a<this.s.length/2;a++){var b=3*this.s[2*a],c=3*this.s[2*a+1],d=this.b[b],e=this.b[c],f=0;if(0<d||0==d&&0<e)f=1;b=this.b[b+1];c=this.b[c+1];d=1;if(0<b||0==b&&0<c)d=0;this.ba[2*d+f].push(this.s[2*a]);this.ba[2*d+f].push(this.s[2*a+1])}};
eb.push({Na:function(a){a=new mb(a.j);a.id="lineString";a.lc=function(a,c){return a.strokeColor[0]==c.strokeColor[0]&&a.strokeColor[1]==c.strokeColor[1]&&a.strokeColor[2]==c.strokeColor[2]&&a.strokeColor[3]==c.strokeColor[3]&&a.pb==c.pb};a.nb=lb;return a},Ma:function(a,b){return"LineString"==a||"Polygon"==a&&!b.fill}});function mb(a){this.j=a;this.l=[{style:new ib,w:[]}];this.e=new Ma(this.j.a);Na(this.e,"\tattribute vec3 vertex; \n\tuniform float zOffset; \n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 projectionMatrix;\n\t\n\tvoid main(void)  \n\t{ \n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z + zOffset, 1.0); \n\t} \n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\tuniform vec4 color; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = color; \n\t} \n\t");
this.nb=this.lc=q;this.id="empty"}mb.prototype.zb=function(a){for(var b=0;b<this.l.length;b++)if(this.lc(a,this.l[b].style))return this.l[b];a={style:a,w:[]};this.l.push(a);return a};function nb(a,b,c,d){if(d.p[a.id])for(var e=d.p[a.id].Y,f=0;f<e.length;f++)if(e[f].style==b&&e[f].F(c)&&d.children)for(f=0;4>f;f++)3==d.children[f].state&&nb(a,b,c,d.children[f])}
mb.prototype.F=function(a){for(var b=q,c=0;c<this.l.length;c++){var d=this.l[c].w.indexOf(a);-1!=d&&(b=this.l[c].Fd,this.l[c].w.splice(d,1))}if(b)for(c=0;c<this.j.z.length;c++)nb(this,b,a,this.j.z[c])};mb.prototype.o=function(a,b){var c=this.zb(b);c.w.push(a);for(var d=0;d<this.j.z.length;d++){var e=this.j.z[d];3==e.state&&ob(this,c.style,a,e)}};
function ob(a,b,c,d){var e=u,f;a:{if(d.p[a.id]){f=d.p[a.id].Y;for(var g=0;g<f.length;g++)if(f[g].style==b){f=f[g];break a}}f=q}f||(f=new a.nb(b,a.j.a.f),e=o);if(f.o(c,d)&&d.children)for(g=0;4>g;g++)3==d.children[g].state&&ob(a,b,c,d.children[g]);e&&pb(a,d,f)}function qb(){this.Y=[]}qb.prototype.K=function(){for(var a=0;a<this.Y.length;a++)this.Y[a].K()};function pb(a,b,c){0<c.b.length&&(b.p[a.id]||(b.p[a.id]=new qb),b.p[a.id].Y.push(c))}
mb.prototype.ya=function(a){if(a.parent)for(var b=a.parent.p[this.id],c=b?b.Y.length:0,d=0;d<c;d++){for(var e=b.Y[d],f=new this.nb(e.style,this.j.a.f),g=0;g<e.L.length;g++)f.o(e.L[g].hb,a);pb(this,a,f)}else for(d=0;d<this.l.length;d++){b=this.l[d];f=new this.nb(b.style,this.j.a.f);for(g=0;g<b.w.length;g++)f.o(b.w[g],a);pb(this,a,f)}};
mb.prototype.A=function(a){var b=this.j.a,c=b.f,d=G();this.e.apply();c.depthFunc(c.LEQUAL);c.uniformMatrix4fv(this.e.k.projectionMatrix,u,b.R);for(var e=q,f=0;f<a.length;++f){var g=a[f];if(g.p[this.id]){I(b.u,g.V,d);c.uniformMatrix4fv(this.e.k.modelViewMatrix,u,d);c.uniform1f(this.e.k.zOffset,7E-4*g.t);for(var k=g.p[this.id].Y,i=0;i<k.length;i++){var h=k[i];h.style!=e&&(e=h.style,c.lineWidth(e.pb),c.uniform4f(this.e.k.color,e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeColor[3]));k[i].A(this.e.attributes)}}else if(3!=
g.state&&g.parent.p[this.id]){I(b.u,g.parent.V,d);c.uniformMatrix4fv(this.e.k.modelViewMatrix,u,d);c.uniform1f(this.e.k.zOffset,7E-4*g.parent.t);k=g.parent.p[this.id].Y;for(i=0;i<k.length;i++){h=k[i];h.style!=e&&(e=h.style,c.lineWidth(e.pb),c.uniform4f(this.e.k.color,e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeColor[3]));var h=k[i],l=this.e.attributes,m=g.Ua;h.ba==q&&h.Rb();var j=h.ba[m];if(0!=j.length){var n=h.f;h.i==q&&(h.i=n.createBuffer());n.bindBuffer(n.ARRAY_BUFFER,h.i);h.wa&&
(n.bufferData(n.ARRAY_BUFFER,new Float32Array(h.b),n.STATIC_DRAW),h.wa=u);n.vertexAttribPointer(l.vertex,3,n.FLOAT,u,0,0);(l=h.v[m])?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,l):(n=h.f,l=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,l),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),n.STATIC_DRAW),h.v[m]=l);n.drawElements(h.Ab,j.length,n.UNSIGNED_SHORT,0)}}}}c.depthFunc(c.LESS)};function Y(a){this.style=a&&a.style?a.style:new ib;this.w=[];this.c=q;this.type="Vector"}v=Y.prototype;v.ta=function(a){this.c=a;for(a=0;a<this.w.length;a++)rb(this,this.w[a])};v.Ob=function(){for(var a=0;a<this.w.length;a++)this.c.Ja.F(this.w[a]);this.c=q};v.sc=function(a){if(a=a.features)for(var b=0;b<a.length;b++)this.o(a[b])};v.Vc=function(a){if(a=a.features)for(var b=0;b<a.length;b++)this.F(a[b])};
function rb(a,b){var c=b.geometry,d=a.style,e=b.properties;e&&e.style&&(d=e.style);if(e="LineString"==c.type)a:{for(var e=c.coordinates[0],f=e[0][0],g=1;g<e.length;g++){if(180<Math.abs(e[g][0]-f)){e=o;break a}coord=e[g]}e=u}if(e){b._crossDateLine=o;e=c.coordinates[0];for(f=0;f<e.length;f++)0>e[f][0]&&(e[f][0]+=360);g=[];for(f=0;f<e.length;f++)g[f]=[e[f][0]-360,e[f][1]];c._negCoordinates=[g]}if("GeometryCollection"==c.type){c=c.geometries;for(e=0;e<c.length;e++)f={type:"Feature",properties:b.properties,
geometry:c[e]},f.properties.style=d,a.c.Ja.o(f,d)}else a.c.Ja.o(b,d)}v.o=function(a){var b=a.geometry;b&&b.type&&(this.w.push(a),this.c&&(rb(this,a),M(this.c.a)))};v.F=function(a){this.w.splice(this.w.indexOf(a),1);this.c&&(this.c.Ja.F(a),M(this.c.a))};v.Jc=function(a,b){this.c.Ja.F(a);this.c.Ja.o(a,b)};function sb(a){bb.prototype.constructor.call(this,a);this.rb=a.rb||512;this.oc=new tb(a.nd||3);this.Gb=a.Gb||10;this.type="ImageryRaster";this.Qb=a.baseUrl;this.pa=new Image;var b=this;this.pa.crossOrigin="";this.pa.onload=function(){b.Hb=o;a.jc&&a.jc instanceof Function&&a.jc(b);b.c&&M(b.c.a)};this.pa.onerror=function(){console.log("Cannot load "+b.pa.src)};this.Hb=u;this.pa.src=this.Qb+"/Norder3/Allsky.jpg"}na(bb,sb);
function ab(a,b){var c=a.Qb,c=c+"/Norder"+b.O,c=c+"/Dir"+1E4*Math.floor(b.P/1E4),c=c+"/Npix"+b.P;return c+".jpg"};function tb(a){this.O=a;this.Ca=Math.pow(2,this.O)}function $a(a,b,c){Pa.prototype.constructor.call(this);this.O=a;this.Ca=Math.pow(2,this.O);this.P=b;this.face=c;this.mc=[64/1728,64/1856,this.P%27/27,Math.floor(this.P/27)/29]}$a.prototype=new Pa;function ub(a){this.a=a.a;this.Da=[];this.e=new Ma(this.a);Na(this.e,"\tattribute vec3 vertex;\n\tuniform mat4 viewProjectionMatrix;\n\t\n\tvoid main(void)\n\t{\n\t\tgl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n\t}\n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\tuniform vec4 color; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = color; \n\t} \n\t")}
ub.prototype.o=function(a){for(var b={Ba:q,name:a.properties.name},c=[],d=0;d<a.geometry.coordinates.length/3-1;d++)c.push(d),c.push(d+1);c.push(d);c.push(0);for(var e=[],d=0;d<a.geometry.coordinates.length;d+=3)e=e.concat([a.geometry.coordinates[d],a.geometry.coordinates[d+1],a.geometry.coordinates[d+2]]);a=new Ja(this.a);La(a,c);Ka(a,e);a.mode=this.a.f.LINES;b.Ba=a;this.Da.push(b)};ub.prototype.F=function(a){for(var b=0;b<this.Da.length;b++)this.Da[b].name==a.properties.name&&this.Da.splice(b,1)};
ub.prototype.A=function(){var a=this.a,b=a.f;b.disable(b.DEPTH_TEST);this.e.apply();I(a.R,a.u,a.M);b.uniformMatrix4fv(this.e.k.viewProjectionMatrix,u,a.M);b.uniform4f(this.e.k.color,0.03125,0.23046875,0.65625,1);for(a=0;a<this.Da.length;a++)this.Da[a].Ba.A(this.e.attributes);b.enable(b.DEPTH_TEST)};eb.push({Na:function(a){return new ub(a.j)},Ma:function(a){return"SimpleLineCollection"==a}});function Z(a){this.c=a;this.Va=this.kb=this.jb=this.Tc=this.Sc=-1;this.yd=G();this.fc=5E-4;this.ec=1;this.rd=[0,0,0];this.J=[1,0,0];this.h=1;this.heading=0;this.bb=90;this.pc=[0,0,1];this.aa={};this.ua()}v=Z.prototype;
v.cd=function(a){var b=this,c=this.c.a.canvas;c.addEventListener("mousedown",function(a){a=a||window.event;b.Va=a.button;if(0==a.button||1==a.button)b.Sc=a.clientX,b.Tc=a.clientY,b.jb=a.clientX,b.kb=a.clientY,vb(b,"start")},u);document.addEventListener("mouseup",function(a){a=a||window.event;b.Va=-1;(0==a.button||1==a.button)&&vb(b,"end")},u);c.addEventListener("mousemove",function(a){a=a||window.event;if(!(0>b.Va)){var c=a.clientX-b.jb,f=a.clientY-b.kb;if(0==b.Va){var f=a.clientX,g=a.clientY,c=Ha(b.c.a,
b.jb,b.kb),f=Ha(b.c.a,f,g),g=[];y(f,c,g);x();y(b.J,g,b.J);b.ua();b.jb=a.clientX;b.kb=a.clientY;M(b.c.a)}else 1==b.Va&&(b.rotate(c,f),M(b.c.a))}},u);a&&c.addEventListener("dblclick",function(a){var c=a||window.event;if(0==c.button){var f=b.c.a,a=[];c.pageX||c.pageY?(a[0]=c.pageX,a[1]=c.pageY):(a[0]=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a[1]=c.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(c=f.canvas;c;)a[0]-=c.offsetLeft,a[1]-=c.offsetTop,c=
c.offsetParent;(a=b.c.cc(a[0],a[1]))&&b.qc(a,0,5E3,b.bb)}},u);c.addEventListener("DOMMouseScroll",function(a){wb(b,a||window.event)},u);c.addEventListener("mousewheel",function(a){wb(b,a||window.event)},u)};v.fd=function(a,b){this.aa[a]?this.aa[a].push(b):this.aa[a]=[b]};v.hd=function(a,b){if(this.aa[a]){var c=this.aa[a].indexOf(b);-1!=c&&this.aa[a].splice(c,1)}};function vb(a,b){if(a.aa[b])for(var c=a.aa[b],d=0;d<c.length;d++)c[d]()}
v.qc=function(a,b,c,d){var e=this,b=d||90,d=[];K.xa(this.J,d);var d=[d[0],d[1],this.h,this.bb],f=[a[0],a[1],0.1,b],c=new ya(c,function(a){var b=K.ca(a);e.J[0]=b[0];e.J[1]=b[1];e.J[2]=b[2];e.h=a[2];e.bb=a[3];e.ua()}),g=this.J,a=K.ca(a),a=y(g,a),a=ga(a),g=this.c.a.canvas,g=Math.min(45*Math.PI/180,45*g.width/g.height*Math.PI/180),a=0.5*(a/2/Math.tan(g/2));a>this.h?(b=[0.5*d[0]+0.5*f[0],0.5*d[1]+0.5*f[1],a,b],Aa(c,0,d,0.5,b,function(a,b,c){var d=a*a;return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-
b[2])*sa(a),b[3]+(c[3]-b[3])*a]}),Aa(c,0.5,b,1,f,function(a,b,c){var d=sa(a);return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*a*a,b[3]+(c[3]-b[3])*a]})):Aa(c,0,d,1,f,function(a,b,c){var d=sa(a);return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*a*a,b[3]+(c[3]-b[3])*a]});c.kc=function(){vb(e,"end")};c.c=this.c;c.start();vb(this,"start")};v.ua=function(){var a=[];F(this.J);var b=[];y(this.J,[0,0,0],b);E(b,1-this.h,a);b=this.c.a.u;la(a,this.J,this.pc,b);this.pc=[b[1],b[5],b[9]]};
function wb(a,b){vb(a,"start");a.h=void 0===b.wheelDelta?a.h*(1+0.1*b.detail):a.h*(1+0.1*(-b.wheelDelta/120));a.h>a.ec&&(a.h=a.ec);a.h<a.fc&&(a.h=a.fc);a.ua();b.preventDefault&&b.preventDefault();b.returnValue=u;vb(a,"end");M(a.c.a)}v.rotate=function(a,b){this.heading+=0.1*a;this.bb+=0.1*b;this.ua()};var xb=[0,1,256,257,2,3,258,259,512,513,768,769,514,515,770,771,4,5,260,261,6,7,262,263,516,517,772,773,518,519,774,775,1024,1025,1280,1281,1026,1027,1282,1283,1536,1537,1792,1793,1538,1539,1794,1795,1028,1029,1284,1285,1030,1031,1286,1287,1540,1541,1796,1797,1542,1543,1798,1799,8,9,264,265,10,11,266,267,520,521,776,777,522,523,778,779,12,13,268,269,14,15,270,271,524,525,780,781,526,527,782,783,1032,1033,1288,1289,1034,1035,1290,1291,1544,1545,1800,1801,1546,1547,1802,1803,1036,1037,1292,1293,1038,
1039,1294,1295,1548,1549,1804,1805,1550,1551,1806,1807,2048,2049,2304,2305,2050,2051,2306,2307,2560,2561,2816,2817,2562,2563,2818,2819,2052,2053,2308,2309,2054,2055,2310,2311,2564,2565,2820,2821,2566,2567,2822,2823,3072,3073,3328,3329,3074,3075,3330,3331,3584,3585,3840,3841,3586,3587,3842,3843,3076,3077,3332,3333,3078,3079,3334,3335,3588,3589,3844,3845,3590,3591,3846,3847,2056,2057,2312,2313,2058,2059,2314,2315,2568,2569,2824,2825,2570,2571,2826,2827,2060,2061,2316,2317,2062,2063,2318,2319,2572,2573,
2828,2829,2574,2575,2830,2831,3080,3081,3336,3337,3082,3083,3338,3339,3592,3593,3848,3849,3594,3595,3850,3851,3084,3085,3340,3341,3086,3087,3342,3343,3596,3597,3852,3853,3598,3599,3854,3855],yb=[2,2,2,2,3,3,3,3,4,4,4,4],zb=[1,3,5,7,0,2,4,6,1,3,5,7];var Va={Vb:function(a){var b=Ab(Bb(a),Bb(0x5555555555555)),b=new Cb(b.qa|Db(b,15).qa,b.Ra|Db(b,15).Ra),a=Ab(b,Bb(65535)).qa,b=Ab(Db(b,32),Bb(65535)).qa;return xb[a&255]|xb[a>>>8]<<4|xb[b&255]<<16|xb[b>>>8]<<20},yc:function(a,b,c){var d=yb[c]-a-b,e=0,f=0,g=0,k=u;1>d?(f=d,d=f*f/3,e=1-d,0.99<e&&(g=Math.sqrt(d*(2-d)),k=o)):3<d?(f=4-d,d=f*f/3,e=d-1,-0.99>e&&(g=Math.sqrt(d*(2-d)),k=o)):(f=1,e=2*(2-d)/3);d=zb[c]*f+a-b;0>d&&(d+=8);8<=d&&(d-=8);f=1E-15>f?0:0.7853981625*d/f;a=k?g:Math.sqrt((1-e)*(1+e));return[a*
Math.cos(f),a*Math.sin(f),e]},zd:function(a){for(var b=0;65535<a;)b+=16,a>>>=16;255<a&&(b|=8,a>>>=8);15<a&&(b|=4,a>>>=4);3<a&&(b|=2,a>>>=2);1<a&&(b|=1);return b}};function Cb(a,b){this.qa=a|0;this.Ra=b|0}var Eb=new Cb(0,0);function Bb(a){return isNaN(a)||!isFinite(a)?Eb:new Cb(a%4294967296|0,a/4294967296|0)}function Ab(a,b){return new Cb(a.qa&b.qa,a.Ra&b.Ra)}function Db(a,b){b&=63;if(0==b)return a;var c=a.Ra;return 32>b?new Cb(a.qa>>>b|c<<32-b,c>>>b):32==b?new Cb(c,0):new Cb(c>>>b-32,0)};window.GlobWeb={};window.GlobWeb.Globe=O;window.GlobWeb.Stats=ma;window.GlobWeb.AstroNavigator=Z;O.prototype.addLayer=O.prototype.tc;O.prototype.removeLayer=O.prototype.Wc;O.prototype.dispose=O.prototype.K;O.prototype.getFrameNumber=O.prototype.sd;O.prototype.getLonLatFromPixel=O.prototype.cc;O.prototype.getViewportGeoBound=O.prototype.Dc;O.prototype.setBaseImagery=O.prototype.Zc;O.prototype.setBaseElevation=O.prototype.Yc;O.prototype.setOption=O.prototype.ad;window.GlobWeb.HEALPixLayer=sb;
window.GlobWeb.CoordinateSystem=K;window.GlobWeb.CoordinateSystem.fromEquatorialToGeo=K.$b;window.GlobWeb.CoordinateSystem.fromGeoTo3D=K.ca;window.GlobWeb.CoordinateSystem.from3DToGeo=K.xa;window.GlobWeb.CoordinateSystem.fromGeoToEquatorial=K.ac;window.GlobWeb.FeatureStyle=ib;ib.prototype._attach=ib.ta;window.GlobWeb.VectorRendererManager=cb;cb.prototype.addFeature=cb.prototype.o;window.GlobWeb.VectorLayer=Y;Y.prototype.addFeature=Y.prototype.o;Y.prototype.addFeatureCollection=Y.prototype.sc;
Y.prototype.modifyFeatureStyle=Y.prototype.Jc;Y.prototype.removeFeature=Y.prototype.F;Y.prototype.removeFeatureCollection=Y.prototype.Vc;Y.prototype._attach=Y.prototype.ta;Z.prototype.zoomTo=Z.prototype.qc;Z.prototype.subscribe=Z.prototype.fd;Z.prototype.unsubscribe=Z.prototype.hd;Z.prototype.setupDefaultEventHandlers=Z.prototype.cd;Z.prototype.computeViewMatrix=Z.prototype.ua;window.GlobWeb.PathAnimation=W;W.prototype.stop=W.prototype.stop;W.prototype.start=W.prototype.start;
W.prototype.setAltitudeOffset=W.prototype.Xc;W.prototype.setDirectionAngle=W.prototype.$c;W.prototype.setSpeed=W.prototype.bd;window.GlobWeb.GeoBound=J;J.prototype.getSouth=J.prototype.Cc;J.prototype.getNorth=J.prototype.Bc;J.prototype.getEast=J.prototype.Ac;J.prototype.getWest=J.prototype.Ec;
