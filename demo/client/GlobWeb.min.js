var p=!0,q=null,v=!1;function aa(a){return function(){return this[a]}}var x,y=y||{};var ba=Array;function B(a){var b=new ba(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b}function ca(a,b,c){if(!c||a==c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c}function D(a,b,c){if(!c||a==c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c}function E(a,b,c){if(!c||a==c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c}
function F(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(!f)return b[0]=0,b[1]=0,b[2]=0,b;if(1==f)return b[0]=c,b[1]=d,b[2]=e,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b}function da(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f}function ea(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)}function fa(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function G(){return new ba(16)}
function H(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],i=a[7],m=a[8],n=a[9],j=a[10],l=a[11],o=a[12],s=a[13],r=a[14],t=a[15],u=c*h-d*g,w=c*k-e*g,z=c*i-f*g,A=d*k-e*h,I=d*i-f*h,J=e*i-f*k,K=m*s-n*o,L=m*r-j*o,M=m*t-l*o,R=n*r-j*s,S=n*t-l*s,T=j*t-l*r,C=1/(u*T-w*S+z*R+A*M-I*L+J*K);b[0]=(h*T-k*S+i*R)*C;b[1]=(-d*T+e*S-f*R)*C;b[2]=(s*J-r*I+t*A)*C;b[3]=(-n*J+j*I-l*A)*C;b[4]=(-g*T+k*M-i*L)*C;b[5]=(c*T-e*M+f*L)*C;b[6]=(-o*J+r*z-t*w)*C;b[7]=(m*J-j*z+l*w)*C;b[8]=(g*S-h*M+i*K)*C;b[9]=(-c*S+
d*M-f*K)*C;b[10]=(o*I-s*z+t*u)*C;b[11]=(-m*I+n*z-l*u)*C;b[12]=(-g*R+h*L-k*K)*C;b[13]=(c*R-d*L+e*K)*C;b[14]=(-o*A+s*w-r*u)*C;b[15]=(m*A-n*w+j*u)*C}
function ga(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],k=a[5],i=a[6],m=a[7],n=a[8],j=a[9],l=a[10],o=a[11],s=a[12],r=a[13],t=a[14],a=a[15],u=b[0],w=b[1],z=b[2],A=b[3],I=b[4],J=b[5],K=b[6],L=b[7],M=b[8],R=b[9],S=b[10],T=b[11],C=b[12],ua=b[13],va=b[14],b=b[15];c[0]=u*d+w*h+z*n+A*s;c[1]=u*e+w*k+z*j+A*r;c[2]=u*f+w*i+z*l+A*t;c[3]=u*g+w*m+z*o+A*a;c[4]=I*d+J*h+K*n+L*s;c[5]=I*e+J*k+K*j+L*r;c[6]=I*f+J*i+K*l+L*t;c[7]=I*g+J*m+K*o+L*a;c[8]=M*d+R*h+S*n+T*s;c[9]=M*e+R*k+S*j+T*r;c[10]=M*f+R*i+S*l+T*t;
c[11]=M*g+R*m+S*o+T*a;c[12]=C*d+ua*h+va*n+b*s;c[13]=C*e+ua*k+va*j+b*r;c[14]=C*f+ua*i+va*l+b*t;c[15]=C*g+ua*m+va*o+b*a}function ha(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14]}function ia(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b}
function ja(a,b,c){var d,e=c[0],f=c[1],c=c[2],g=Math.sqrt(e*e+f*f+c*c);if(g){1!=g&&(g=1/g,e*=g,f*=g,c*=g);var h=Math.sin(b),k=Math.cos(b),i=1-k,b=a[0],g=a[1],m=a[2],n=a[3],j=a[4],l=a[5],o=a[6],s=a[7],r=a[8],t=a[9],u=a[10],w=a[11],z=e*e*i+k,A=f*e*i+c*h,I=c*e*i-f*h,J=e*f*i-c*h,K=f*f*i+k,L=c*f*i+e*h,M=e*c*i+f*h,e=f*c*i-e*h,f=c*c*i+k;d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*z+j*A+r*I;d[1]=g*z+l*A+t*I;d[2]=m*z+o*A+u*I;d[3]=n*z+s*A+w*I;d[4]=b*J+j*K+r*L;d[5]=g*J+l*K+t*L;d[6]=
m*J+o*K+u*L;d[7]=n*J+s*K+w*L;d[8]=b*M+j*e+r*f;d[9]=g*M+l*e+t*f;d[10]=m*M+o*e+u*f;d[11]=n*M+s*e+w*f}}function ka(a,b,c,d,e){var a=c*Math.tan(a*Math.PI/360),b=a*b,f=-b,g=-a;e||(e=G());var h=b-f,k=a-g,i=d-c;e[0]=2*c/h;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*c/k;e[6]=0;e[7]=0;e[8]=(b+f)/h;e[9]=(a+g)/k;e[10]=-(d+c)/i;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(2*d*c)/i;e[15]=0}
function la(a,b,c,d){d||(d=G());var e=a[0],f=a[1],a=a[2],g=c[0],h=c[1],k=c[2],c=b[1],i=b[2];if(e==b[0]&&f==c&&a==i)d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0;else{var m,n,j,l,c=e-b[0],i=f-b[1],b=a-b[2];l=1/Math.sqrt(c*c+i*i+b*b);c*=l;i*=l;b*=l;m=h*b-k*i;k=k*c-g*b;g=g*i-h*c;(l=Math.sqrt(m*m+k*k+g*g))?(l=1/l,m*=l,k*=l,g*=l):g=k=m=0;h=i*g-b*k;n=b*m-c*g;j=c*k-i*m;(l=Math.sqrt(h*h+n*n+j*j))?(l=1/l,h*=l,n*=l,j*=l):j=n=h=0;d[0]=m;d[1]=h;
d[2]=c;d[3]=0;d[4]=k;d[5]=n;d[6]=i;d[7]=0;d[8]=g;d[9]=j;d[10]=b;d[11]=0;d[12]=-(m*e+k*f+g*a);d[13]=-(h*e+n*f+j*a);d[14]=-(c*e+i*f+b*a)}d[15]=1};y.ja=function(a,b){function c(){}c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b};function N(a,b,c,d){this.L=b;this.t=a;this.u=d;this.J=c}x=N.prototype;x.Gb=function(){return[0.5*(this.J+this.t),0.5*(this.L+this.u),0]};x.Tc=aa("u");x.Vc=aa("L");x.Yc=aa("t");x.Pc=aa("J");function ma(a,b){a&&(this.min=B(a));b&&(this.max=B(b))}ma.prototype.extend=function(a,b,c){this.min?(a<this.min[0]&&(this.min[0]=a),b<this.min[1]&&(this.min[1]=b),c<this.min[2]&&(this.min[2]=c),a>this.max[0]&&(this.max[0]=a),b>this.max[1]&&(this.max[1]=b),c>this.max[2]&&(this.max[2]=c)):(this.min=B(),this.max=B(),this.min[0]=a,this.min[1]=b,this.min[2]=c,this.max[0]=a,this.max[1]=b,this.max[2]=c)};
ma.prototype.Ab=function(a,b){this.min||(this.min=B(),this.max=B());this.min[0]=a[0];this.min[1]=a[1];this.min[2]=a[2];this.max[0]=a[0];this.max[1]=a[1];this.max[2]=a[2];for(var c=b||a.length,d=3;d<c;d+=3)for(var e=0;3>e;e++)a[d+e]<this.min[e]&&(this.min[e]=a[d+e]),a[d+e]>this.max[e]&&(this.max[e]=a[d+e])};ma.prototype.Gb=function(){return[0.5*(this.max[0]+this.min[0]),0.5*(this.max[1]+this.min[1]),0.5*(this.max[2]+this.min[2])]};function na(a){var b=B();D(a.max,a.min,b);return 0.5*ea(b)};function oa(a,b,c){return b!=c?(a-b)/(c-b):0}function pa(a){a-=1;return 1-a*a}function qa(a,b,c,d){d||(d=B());E(b,c,d);ca(d,a,d);return d}function ra(a,b,c,d,e,f,g,h){var k=(h-f)*(c-a)-(g-e)*(d-b);return 0==k?[-1,-1]:[((g-e)*(b-f)-(h-f)*(a-e))/k,((c-a)*(b-f)-(d-b)*(a-e))/k]}function sa(a,b,c){var d=y.b.o,a=D(a,c,B()),b=2*fa(b,a),a=b*b-4*(fa(a,a)-d*d);if(0>a)return-1;a=Math.sqrt(a);d=(-b-a)/2;b=(-b+a)/2;d>b&&(a=d,d=b,b=a);return 0>b?-1:0>d?b:d}
function ta(a,b,c){c||(c=G());var d=c;d||(d=G());var e=b[0],f=b[1],g=b[2],h=b[3],k=e+e,i=f+f,m=g+g,b=e*k,n=e*i,e=e*m,j=f*i,f=f*m,g=g*m,k=h*k,i=h*i,h=h*m;d[0]=1-(j+g);d[1]=n+h;d[2]=e-i;d[3]=0;d[4]=n-h;d[5]=1-(b+g);d[6]=f+k;d[7]=0;d[8]=e+i;d[9]=f-k;d[10]=1-(b+j);d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;c[12]=a[0];c[13]=a[1];c[14]=a[2]};y.H={qa:[]};y.H.Cc=function(a){y.H.qa.push(a)};y.H.rd=function(a){for(var b=0;b<y.H.qa.length;b++)if(a==y.H.qa[b]){y.H.qa.splice(b,1);break}};y.H.update=function(){for(var a=(new Date).getTime(),b=y.H.qa.length,c=0;c<b;c++)y.H.qa[c].update(a)};function O(){this.kd=this.startTime=-1;this.state=wa}var wa=0;O.prototype.start=function(){if(1!=this.state){var a=new Date;this.startTime=2==this.state?this.startTime+(a-this.kd):a.getTime();this.state=1;y.H.Cc(this)}};
O.prototype.stop=function(){this.state=wa;this.sc&&this.sc();y.H.rd(this)};function xa(a,b,c,d,e){O.prototype.constructor.call(this);this.Ra=[[0,b],[1,c]];this.duration=a;this.Zc=d;this.Vb=e}y.ja(O,xa);xa.prototype.start=function(){O.prototype.start.call(this);this.Vb(this.Yb)};xa.prototype.stop=function(){O.prototype.stop.call(this);this.Vb(this.Cb)};
xa.prototype.update=function(a){a=oa(a,this.startTime,this.startTime+this.duration);if(1<=a)this.stop();else{for(var b=this.Ra.length,c=0;c<b&&this.Ra[c][0]<a;)c++;c=Math.min(c,b-1);b=Math.max(0,c-1);a=oa(a,this.Ra[b][0],this.Ra[c][0]);a=this.Zc(a,this.Ra[b][1],this.Ra[c][1]);this.Vb(a)}};function ya(a,b){O.prototype.constructor.call(this);this.K=[];this.duration=a;this.Qa=b}y.ja(O,ya);function za(a,b,c,d,e){this.start=a;this.Yb=b;this.end=c;this.Cb=d;this.$c=e}function Aa(a,b,c,d,e,f){for(var g=a.K.length,h=0;h<g&&a.K[h].end<=b;)h++;a.K.splice(h,0,new za(b,c,d,e,f))}ya.prototype.start=function(){O.prototype.start.call(this);this.Qa(this.K[0].Yb)};ya.prototype.stop=function(){O.prototype.stop.call(this);this.Qa(this.K[this.K.length-1].Cb)};
ya.prototype.update=function(a){a=oa(a,this.startTime,this.startTime+this.duration);if(1<=a)this.stop();else{for(var b=this.K.length,c=0;c<b&&this.K[c].end<a;)c++;c=Math.min(c,b-1);a=oa(a,this.K[c].start,this.K[c].end);a=this.K[c].$c(a,this.K[c].Yb,this.K[c].Cb);this.Qa(a)}};y.b={o:1,U:1/6356752.3142,tc:6356752.3142};y.b.ga=function(a,b){b||(b=Array(3));var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,e=Math.cos(d),f=y.b.o+(2<a.length?y.b.U*a[2]:0);b[0]=f*Math.cos(c)*e;b[1]=f*Math.sin(c)*e;b[2]=f*Math.sin(d);return b};y.b.ta=function(a,b){b||(b=Array(3));var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=Math.asin(a[2]/c);b[0]=180*Math.atan2(a[1]/c,a[0]/c)/Math.PI;b[1]=180*d/Math.PI;b[2]=y.b.tc*Math.abs(c-y.b.o);return b};
y.b.Kd=function(a,b){b||(b=Array(3));var c=[];y.b.ta(a,c);y.b.Mc(c,b);return b};y.b.Ld=function(a,b){b||(b=Array(3));var c=[];y.b.Lc(a,c);y.b.ga(c,b);return b};y.b.Lc=function(a,b){b||(b=[]);var c=a[0].split(" "),d=parseFloat(c[0]),e=parseFloat(c[1]),c=parseFloat(c[2]);b[0]=15*(d+e/60+c/3600);180<b[0]&&(b[0]-=360);var f=a[1].split(" "),d=parseFloat(f[0]),e=parseFloat(f[1]),c=parseFloat(f[2]);b[1]=("-"==f[0][0]?-1:1)*(Math.abs(d)+e/60+c/3600)};
y.b.Mc=function(a,b){b||(b=[]);var c=a[0];0>c&&(c+=360);var d=Math.abs(c/15),c=Math.floor(d),d=60*(d-c),e=Math.floor(d);b[0]=c+" "+e+" "+60*(d-e);d=Math.abs(a[1]);c=Math.floor(d);d=60*(d-c);e=Math.floor(d);b[1]=(0<=a[1]?"":"-")+""+c+" "+e+" "+60*(d-e)};
y.b.mc=function(a,b){b||(b=G());var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,d=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],c=[-Math.sin(c),Math.cos(c),0],e=B();da(d,c,e);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=0;b[4]=e[0];b[5]=e[1];b[6]=e[2];b[7]=0;b[8]=d[0];b[9]=d[1];b[10]=d[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1};
y.b.Hb=function(a,b){b||(b=G());var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,d=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],c=[-Math.sin(c),Math.cos(c),0],e=B();da(d,c,e);var f=y.b.ga(a);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=0;b[4]=e[0];b[5]=e[1];b[6]=e[2];b[7]=0;b[8]=d[0];b[9]=d[1];b[10]=d[2];b[11]=0;b[12]=f[0];b[13]=f[1];b[14]=f[2];b[15]=1;return b};y.b.Uc=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};y.b.Rc=function(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6]};
y.b.Wc=function(a,b){b[0]=a[8];b[1]=a[9];b[2]=a[10]};function P(a,b,c,d){O.prototype.constructor.call(this);this.speed=b*y.b.U/1E3;this.e=[];for(b=0;b<a.length;b++){var e={position:y.b.ga(a[b]),R:q,j:0};this.e.push(e);if(0<b){var e=this.e[b].position[0]-this.e[b-1].position[0],f=this.e[b].position[1]-this.e[b-1].position[1],g=this.e[b].position[2]-this.e[b-1].position[2];this.e[b-1].j=Math.sqrt(e*e+f*f+g*g)}}for(b=1;b<a.length-1;b++)e=D(this.e[b+1].position,this.e[b].position,B()),f=D(this.e[b-1].position,this.e[b].position,B()),F(e),F(f),this.e[b].R=
D(e,f,B()),F(this.e[b].R);e=D(this.e[1].position,this.e[0].position,B());E(e,3/this.e[0].j);this.e[0].R=D(e,this.e[1].R,B());E(this.e[0].R,0.5);b=a.length-1;e=D(this.e[b].position,this.e[b-1].position,B());E(e,3/this.e[b-1].j);this.e[b].R=D(e,this.e[b-1].R,B());E(this.e[b].R,0.5);this.c=d;this.ra=this.index=0;this.eb=-1;this.Jd=[];this.fc=-0.2;this.cc=1E3;var h=this;this.Qa=c?c:function(a,b){var c=F(a,B()),d=y.b.ta(a);d[2]=h.c.Da(d[0],d[1])+h.cc;var d=y.b.ga(d),e=F(b,B()),e=ca(d,e,B());ca(e,E(c,h.fc,
B()));la(d,e,c,Ba.s)}}y.ja(O,P);x=P.prototype;x.wd=function(a){this.speed=parseFloat(a)*y.b.U/1E3};x.ud=function(a){this.cc=parseFloat(a)};x.vd=function(a){this.fc=Math.tan(parseFloat(a)*Math.PI/180)};x.start=function(){var a=-1;2==this.state&&(a=this.startTime);O.prototype.start.call(this);this.eb=-1!=a?this.eb+(this.startTime-a):-1};
x.update=function(a){-1==this.eb?this.ra=this.index=0:this.ra+=(a-this.eb)*this.speed;for(this.eb=a;this.ra>=this.e[this.index].j&&this.index<this.e.length-1;)this.ra-=this.e[this.index].j,this.index+=1;if(this.index<this.e.length-1){var a=this.ra/this.e[this.index].j,b=this.e[this.index].position,c=this.e[this.index+1].position,d=E(this.e[this.index].R,this.e[this.index].j,B()),e=E(this.e[this.index+1].R,this.e[this.index].j,B()),f=a*a,g=f*a,h=2*b[0]-2*c[0]+d[0]+e[0],k=2*b[1]-2*c[1]+d[1]+e[1],i=
2*b[2]-2*c[2]+d[2]+e[2],m=-3*b[0]+3*c[0]-2*d[0]-e[0],n=-3*b[1]+3*c[1]-2*d[1]-e[1],j=-3*b[2]+3*c[2]-2*d[2]-e[2],l=B();l[0]=h*g+m*f+d[0]*a+b[0];l[1]=k*g+n*f+d[1]*a+b[1];l[2]=i*g+j*f+d[2]*a+b[2];f=a*a;g=6*b[0]-6*c[0]+3*d[0]+3*e[0];h=6*b[1]-6*c[1]+3*d[1]+3*e[1];k=6*b[2]-6*c[2]+3*d[2]+3*e[2];i=-6*b[0]+6*c[0]-4*d[0]-2*e[0];m=-6*b[1]+6*c[1]-4*d[1]-2*e[1];b=-6*b[2]+6*c[2]-4*d[2]-2*e[2];c=B();c[0]=g*f+i*a+d[0];c[1]=h*f+m*a+d[1];c[2]=k*f+b*a+d[2];this.Qa(l,c)}else this.index==this.e.length-1?this.Qa(this.e[this.index].position,
this.e[this.index].R):this.stop()};function Ca(a,b,c){O.prototype.constructor.call(this);this.v=a;this.I=[];this.duration=b;this.Jc=c;this.oc=0}y.ja(O,Ca);Ca.prototype.start=function(){O.prototype.start.call(this);ta(this.I[0][1],this.I[0][2],this.v)};Ca.prototype.stop=function(){O.prototype.stop.call(this);var a=this.I.length-1;ta(this.I[a][1],this.I[a][2],this.v);this.Jc()};
Ca.prototype.update=function(a){var b=oa(a,this.startTime,this.startTime+this.duration);if(1<=b)this.stop();else{for(var c=this.I.length,a=this.oc;a<c&&this.I[a][0]<b;)a++;var d=Math.max(0,a-1),b=map01(b,this.I[d][0],this.I[a][0]),c=B(),e=this.I[d][1],f=this.I[a][1],g=b,h=c;h||(h=e);h[0]=e[0]+g*(f[0]-e[0]);h[1]=e[1]+g*(f[1]-e[1]);h[2]=e[2]+g*(f[2]-e[2]);e=new ba(4);d=this.I[d][2];g=this.I[a][2];f=b;b=e;h=d[0]*g[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3];b||(b=new ba(4));0>h?(h=-h,b[0]=-g[0],b[1]=-g[1],b[2]=
-g[2],b[3]=-g[3]):(b[0]=g[0],b[1]=g[1],b[2]=g[2],b[3]=g[3]);if(0.9999>Math.abs(h)){var k=Math.sqrt(1-h*h),h=Math.atan2(k,h),g=Math.sin((1-f)*h)/k,k=Math.sin(f*h)/k;b[0]=d[0]*g+k*b[0];b[1]=d[1]*g+k*b[1];b[2]=d[2]*g+k*b[2];b[3]=d[3]*g+k*b[3]}else b[0]=d[0]+(g[0]-d[0])*f,b[1]=d[1]+(g[1]-d[1])*f,b[2]=d[2]+(g[2]-d[2])*f,b[3]=d[3]+(g[3]-d[3])*f,k||(k=b),d=b[0],f=b[1],g=b[2],b=b[3],h=Math.sqrt(d*d+f*f+g*g+b*b),0==h?(k[0]=0,k[1]=0,k[2]=0,k[3]=0):(h=1/h,k[0]=d*h,k[1]=f*h,k[2]=g*h,k[3]=b*h);ta(c,e,this.v);
this.oc=a}};function Da(){this.r=B([0,0,0]);this.Ba=0}function Ea(a,b,c){var d=[0,0,0],e=[],f=[];D(b,d,e);D(c,d,f);da(e,f,a.r);F(a.r);a.Ba=-fa(d,a.r)}Da.prototype.j=function(a){return a[0]*this.r[0]+a[1]*this.r[1]+a[2]*this.r[2]+this.Ba};function Fa(){this.aa=[new Da,new Da,new Da,new Da]}
Fa.prototype.Ab=function(a){function b(a,b){ia(a,b);b[0]/=b[3];b[1]/=b[3];b[2]/=b[3];return b}var c=G();H(a,c);var a=b(c,[-1,-1,-1,1]),d=b(c,[-1,1,-1,1]),e=b(c,[1,1,-1,1]),c=b(c,[1,-1,-1,1]);Ea(this.aa[0],a,d);Ea(this.aa[1],d,e);Ea(this.aa[2],e,c);Ea(this.aa[3],c,a)};
function Ga(a,b,c){for(var d=0;4>d;d++){var e=b.aa[d],f=e.r[0],g=e.r[1],h=e.r[2],k=e.Ba,e=a.aa[d];e.r[0]=c[0]*f+c[1]*g+c[2]*h+c[3]*k;e.r[1]=c[4]*f+c[5]*g+c[6]*h+c[7]*k;e.r[2]=c[8]*f+c[9]*g+c[10]*h+c[11]*k;e.Ba=c[12]*f+c[13]*g+c[14]*h+c[15]*k}};function Q(a,b){this.c=a;this.cb=this.Qb=this.Pb=this.pd=this.od=-1;this.va=G();this.wb=1;this.vb=3*y.b.tc;this.N=[0,0,0];this.j=3*y.b.o;this.heading=0;this.pa=90;for(var c in b)this[c]=b[c];this.wb*=y.b.U;this.vb*=y.b.U;this.ea={};Ha(this)}x=Q.prototype;
x.xd=function(a){var b=this,c=this.c.a.canvas;c.addEventListener("mousedown",function(a){a=a||window.event;b.cb=a.button;if(0==a.button||1==a.button)b.od=a.clientX,b.pd=a.clientY,b.Pb=a.clientX,b.Qb=a.clientY,Ia(b,"start")},v);document.addEventListener("mouseup",function(a){a=a||window.event;b.cb=-1;(0==a.button||1==a.button)&&Ia(b,"end")},v);c.addEventListener("mousemove",function(a){a=a||window.event;if(!(0>b.cb)){var c=a.clientX-b.Pb,f=a.clientY-b.Qb;b.Pb=a.clientX;b.Qb=a.clientY;if(0==b.cb){var a=
c,c=f,f=B(),g=b.N;f[0]=g[0];f[1]=g[1];f[2]=g[2];g=G();y.b.mc(b.N,g);var h=B(),k=B([0,1,0]);y.b.Wc(g,h);ha(g,k,k);Ja(b,g);var i=B(),m=B();y.b.Uc(g,i);y.b.Rc(g,m);da(h,i,m);da(m,h,i);F(i,i);F(m,m);a/=b.c.a.canvas.width;c/=b.c.a.canvas.height;h=B();y.b.ga(b.N,h);E(i,a*b.j,i);E(m,c*b.j,m);D(h,i,h);ca(h,m,h);F(h);E(h,y.b.o);y.b.ta(h,b.N);a=B([0,1,0]);y.b.mc(b.N,g);ha(g,a,a);0>fa(k,a)&&(b.heading=(b.heading+180)%360);Ha(b);Ka(b)&&(b.N=f,Ha(b));U(b.c.a)}else 1==b.cb&&(b.rotate(c,f),U(b.c.a))}},v);a&&c.addEventListener("dblclick",
function(a){var c=a||window.event;if(0==c.button){var f=b.c.a,a=[];c.pageX||c.pageY?(a[0]=c.pageX,a[1]=c.pageY):(a[0]=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a[1]=c.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(c=f.canvas;c;)a[0]-=c.offsetLeft,a[1]-=c.offsetTop,c=c.offsetParent;(a=b.c.nc(a[0],a[1]))&&b.Ac(a,b.j/(4*y.b.U),5E3,b.pa)}},v);c.addEventListener("DOMMouseScroll",function(a){La(b,a||window.event)},v);c.addEventListener("mousewheel",
function(a){La(b,a||window.event)},v)};x.Ad=function(a,b){this.ea[a]?this.ea[a].push(b):this.ea[a]=[b]};x.Cd=function(a,b){if(this.ea[a]){var c=this.ea[a].indexOf(b);-1!=c&&this.ea[a].splice(c,1)}};function Ia(a,b){if(a.ea[b])for(var c=a.ea[b],d=0;d<c.length;d++)c[d]()}
x.Ac=function(a,b,c,d){var e=this,f=d||90,d=[this.N[0],this.N[1],this.j,this.pa],b=[a[0],a[1],b*y.b.U,f],c=new ya(c,function(a){e.N[0]=a[0];e.N[1]=a[1];e.j=a[2];e.pa=a[3];Ha(e)}),g=y.b.ga(this.N),a=y.b.ga(a),a=D(g,a),a=ea(a),g=this.c.a.canvas,g=Math.min(45*Math.PI/180,45*g.width/g.height*Math.PI/180),a=1.1*(a/2/Math.tan(g/2));a>this.j?(f=[0.5*d[0]+0.5*b[0],0.5*d[1]+0.5*b[1],a,f],Aa(c,0,d,0.5,f,function(a,b,c){var d=a*a;return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*pa(a),b[3]+(c[3]-
b[3])*a]}),Aa(c,0.5,f,1,b,function(a,b,c){var d=pa(a);return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*a*a,b[3]+(c[3]-b[3])*a]})):Aa(c,0,d,1,b,function(a,b,c){var d=pa(a);return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*a*a,b[3]+(c[3]-b[3])*a]});c.sc=function(){Ia(e,"end")};c.start();U(this.c.a);Ia(this,"start")};function Ja(a,b){ja(b,a.heading*Math.PI/180,[0,0,1]);ja(b,(90-a.pa)*Math.PI/180,[1,0,0])}
function Ha(a){y.b.Hb(a.N,a.va);Ja(a,a.va);var b=a.va,c=[0,0,a.j],d=c[0],e=c[1],c=c[2];b[12]=b[0]*d+b[4]*e+b[8]*c+b[12];b[13]=b[1]*d+b[5]*e+b[9]*c+b[13];b[14]=b[2]*d+b[6]*e+b[10]*c+b[14];b[15]=b[3]*d+b[7]*e+b[11]*c+b[15];H(a.va,a.c.a.s)}function La(a,b){Ia(a,"start");var c=a.j;a.j=void 0===b.wheelDelta?a.j*(1+0.1*b.detail):a.j*(1+0.1*(-b.wheelDelta/120));a.j>a.vb&&(a.j=a.vb);a.j<a.wb&&(a.j=a.wb);Ha(a);Ka(a)&&(a.j=c,Ha(a));b.preventDefault&&b.preventDefault();b.returnValue=v;Ia(a,"end");U(a.c.a)}
function Ka(a){var b=[a.va[12],a.va[13],a.va[14]],c=B();y.b.ta(b,c);a=a.c.Da(c[0],c[1]);return c[2]<a+50}x.rotate=function(a,b){var c=this.heading,d=this.pa;this.heading+=0.1*a;this.pa+=0.1*b;Ha(this);Ka(this)&&(this.heading=c,this.pa=d,Ha(this))};function Ba(a){this.vc=a.shadersPath||"../shaders/";this.Ub=0;this.Sd=4;var b=q;if(!a.canvas)throw"GlobWeb : no canvas in options";b="string"==typeof a.canvas?document.getElementById(a.canvas):a.canvas;if(!b instanceof HTMLCanvasElement)throw"GlobWeb : invalid canvas";for(var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=q,e=0;e<c.length&&d==q;++e)try{d=b.getContext(c[e],a.contextAttribs)}catch(f){}if(d==q)throw"GlobWeb : WebGL context cannot be initialized";a.backgroundColor?(a=a.backgroundColor,
d.clearColor(a[0],a[1],a[2],a[3])):d.clearColor(0,0,0,1);d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE);d.enable(d.DEPTH_TEST);d.enable(d.CULL_FACE);d.viewport(0,0,b.width,b.height);a=G();c=G();la([0,0,3],[0,0,0],[0,1,0],c);a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];e=G();ka(60,b.width/b.height,1E-5,6,e);var g=new Fa;g.Ab(e);this.s=c;this.Ha=a;this.na=e;this.h=
d;this.canvas=b;this.Nc=g;this.bc=new Fa;this.cd=new Fa;this.Db=[0,0,0];this.Ub=0;this.Tb=1E-5;this.$a=Ba.Tb;this.sa=6;this.V=0;this.Fb=v;window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)})}function U(a){a.Fb||(window.requestAnimationFrame(a.frame),a.Fb=p)}
function Ma(a){var b=a.canvas.width,c=a.canvas.height,d=a.na,a=a.s,e=0.5*d[0]*b,b=0.5*d[8]*b+0.5*d[11]*b,b=[a[0]*e+a[2]*b,a[4]*e+a[6]*b,a[8]*e+a[10]*b],e=0.5*d[5]*c,c=0.5*d[9]*c+0.5*d[11]*c,c=[a[1]*e+a[2]*c,a[5]*e+a[6]*c,a[9]*e+a[10]*c],e=d[11],d=[a[2]*e,a[6]*e,a[10]*e,a[14]*e+a[15]*d[15]],a=0.7071067811/Math.sqrt(fa(b,b)+fa(c,c));d[0]*=a;d[1]*=a;d[2]*=a;d[3]*=a;return d}
function Na(a,b){var c=a.h,d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);return d};function Oa(a){this.a=a;this.ob=this.A=this.X=this.m=q;this.qc=0;this.mode=a.h.TRIANGLES}function Pa(a,b){var c=a.a.h;a.m==q&&(a.m=c.createBuffer());c.bindBuffer(c.ARRAY_BUFFER,a.m);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW);a.qc=b.length}function Qa(a,b){var c=a.a.h;a.A==q&&(a.A=c.createBuffer());c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a.A);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),c.STATIC_DRAW);a.$=b.length}
Oa.prototype.w=function(a){var b=this.a.h;b.bindBuffer(b.ARRAY_BUFFER,this.m);b.vertexAttribPointer(a.vertex,3,b.FLOAT,v,0,0);a.hasOwnProperty("tcoord")&&(b.bindBuffer(b.ARRAY_BUFFER,this.X),b.vertexAttribPointer(a.tcoord,2,b.FLOAT,v,0,0));a.hasOwnProperty("color")&&(b.bindBuffer(b.ARRAY_BUFFER,this.ob),b.vertexAttribPointer(a.color,4,b.FLOAT,v,0,0));this.A?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.A),b.drawElements(this.mode,this.$,b.UNSIGNED_SHORT,0)):b.drawArrays(this.mode,0,this.qc/3)};
Oa.prototype.S=function(){var a=this.a.h;this.A&&a.deleteBuffer(this.A);this.m&&a.deleteBuffer(this.m);this.X&&a.deleteBuffer(this.X);this.ob&&a.deleteBuffer(this.ob);this.ob=this.X=this.m=this.A=q};function V(a){this.a=a;this.q=q;this.attributes={};this.i={};this.V=0}V.prototype.createShader=function(a,b){var c=this.a.h,d=c.createShader(a);c.shaderSource(d,b);c.compileShader(d);return!c.getShaderParameter(d,c.COMPILE_STATUS)?(console.log("Shader compilation error: "+c.getShaderInfoLog(d)),c.deleteShader(d),q):d};
function Ra(a,b,c){var d=a.a.h,b=a.createShader(d.VERTEX_SHADER,b),c=a.createShader(d.FRAGMENT_SHADER,c);if(!(b==q||c==q))if(a.q=d.createProgram(),d.attachShader(a.q,b),d.attachShader(a.q,c),d.linkProgram(a.q),d.getProgramParameter(a.q,d.LINK_STATUS)){b=d.getProgramParameter(a.q,d.ACTIVE_ATTRIBUTES);for(c=a.V=0;c<b;++c){var e=d.getActiveAttrib(a.q,c),f=d.getAttribLocation(a.q,e.name);a.attributes[e.name]=f;f+1>a.V&&(a.V=f+1)}b=d.getProgramParameter(a.q,d.ACTIVE_UNIFORMS);for(c=0;c<b;++c)e=d.getActiveUniform(a.q,
c),a.i[e.name]=d.getUniformLocation(a.q,e.name)}else console.log("Program link error: "+d.getProgramInfoLog(a.q)),d.deleteShader(b),d.deleteShader(c),d.deleteProgram(a.q),a.q=q}function Sa(a,b,c){var d=new XMLHttpRequest;d.open("get",a.a.vc+b,v);d.send(q);b=d.responseText;d.open("get",a.a.vc+c,v);d.send(q);Ra(a,b,d.responseText)}
V.prototype.apply=function(){var a=this.a,b=a.h;b.useProgram(this.q);for(var c=a.V;c<this.V;c++)b.enableVertexAttribArray(c);for(c=this.V;c<a.V;c++)b.disableVertexAttribArray(c);a.V=this.V};function Ta(a){this.a=a;this.Ob=0.0025;this.ad=0.0015;this.xc=15;this.Kc=2;this.ac=[0.65,0.57,0.475];this.Ea=y.b.o;this.W=1.025*this.Ea;this.ha=this.ca=q;this.tb=v;this.hb=new V(a);Sa(this.hb,"SkyFromSpaceVert.glsl","SkyFrag.glsl");this.gb=new V(a);Sa(this.gb,"SkyFromAtmosphereVert.glsl","SkyFrag.glsl");this.Za=new V(a);Sa(this.Za,"GroundFromSpaceVert.glsl","GroundFrag.glsl");this.Ya=new V(a);Sa(this.Ya,"GroundFromAtmosphereVert.glsl","GroundFrag.glsl");if(this.tb=this.hb.q!=q&&this.gb.q!=q&&this.Za.q!=
q&&this.Ya.q!=q){this.hb.apply();Ua(this,this.hb.i);this.gb.apply();Ua(this,this.gb.i);this.Za.apply();Ua(this,this.Za.i);this.Ya.apply();Ua(this,this.Ya.i);for(var b=[],c=[],d=-72;72>=d;d++)for(var e=d*0.5*Math.PI/72,f=-144;144>=f;f++){var g=f*Math.PI/144,h=this.W*Math.sin(g)*Math.cos(e),k=this.W*Math.sin(e);b.push(this.W*Math.cos(g)*Math.cos(e));b.push(h);b.push(k)}for(d=0;144>d;d++)for(f=0;288>f;f++)c.push(289*d+f),c.push(289*(d+1)+f+1),c.push(289*d+f+1),c.push(289*(d+1)+f+1),c.push(289*d+f),c.push(289*
(d+1)+f);this.xa=new Oa(a);Pa(this.xa,b);Qa(this.xa,c)}}
function Ua(a,b){var c=a.a.h,d=[1,1,1];F(d);c.uniform1f(b.fKrESun,a.Ob*a.xc);c.uniform1f(b.fKmESun,a.Ob*a.xc);c.uniform1f(b.fKr4PI,4*a.Ob*Math.PI);c.uniform1f(b.fKm4PI,4*a.ad*Math.PI);c.uniform1f(b.fExposure,a.Kc);var e=[Math.pow(a.ac[0],4),Math.pow(a.ac[1],4),Math.pow(a.ac[2],4)];c.uniform3f(b.v3InvWavelength,1/e[0],1/e[1],1/e[2]);c.uniform3f(b.v3LightPos,d[0],d[1],d[2]);c.uniform1f(b.fInnerRadius,a.Ea);c.uniform1f(b.fInnerRadius2,a.Ea*a.Ea);c.uniform1f(b.fOuterRadius,a.W);c.uniform1f(b.fOuterRadius2,
a.W*a.W);c.uniform1f(b.fScale,1/(a.W-a.Ea));c.uniform1f(b.fScaleDepth,0.25);c.uniform1f(b.fScaleOverScaleDepth,1/(a.W-a.Ea)/0.25);c.uniform1f(b.g,-0.95);c.uniform1f(b.g2,0.9025)}Ta.prototype.w=function(){if(this.tb){var a=this.a.h;a.enable(a.CULL_FACE);this.ca.apply();a.uniformMatrix4fv(this.ca.i.projectionMatrix,v,this.a.na);a.uniformMatrix4fv(this.ca.i.viewMatrix,v,this.a.s);this.xa.w(this.ca.attributes)}};function Va(a,b){this.a=a;this.n=b;this.ya=q;this.Ma=[q,q,q,q];this.Sa=q;this.Na=[q,q,q,q];this.zd=[q,q,q,q]}Va.prototype.reset=function(){for(var a=this.a.h,b=0;4>b;b++)this.Ma[b]&&(a.deleteBuffer(this.Ma[b]),this.Ma[b]=q);this.ya&&(a.deleteBuffer(this.ya),this.ya=q);for(b=0;4>b;b++)this.Na[b]&&(a.deleteBuffer(this.Na[b]),this.Na[b]=q);this.Sa&&(a.deleteBuffer(this.Sa),this.Sa=q)};function Wa(){this.parent=q;this.bb=-1;this.Fa=this.v=this.m=this.Q=this.d=this.children=q;this.O=new ma;this.j=this.o=0;this.gc=[0,0,0];this.z={};this.state=Xa;this.n=q;this.Bd=[1,1,0,0]}var Xa=0;function Ya(a,b,c){for(var d=Math.floor(c),c=c-d,e=Math.floor(b),b=b-e,f=a.n.C,d=3*(d*f+e),e=[0,0,0],g=0;3>g;g++)e[g]=(1-c)*(1-b)*a.d[d+g]+c*(1-b)*a.d[d+3*f+g]+c*b*a.d[d+3*f+3+g]+(1-c)*b*a.d[d+3+g];return e}
function Za(a,b,c,d){a.parent=b;a.bb=2*d+c;a.v=b.v;a.Fa=b.Fa;a.Q=b.Q;a.n=b.n;a.m=b.m;for(var e=a.n.C,f=(e-1)/2,g=0;g<=f;g++)for(var h=3*((g+d*f)*e+c*f),k=0;k<=f;k++)a.O.extend(b.d[h],b.d[h+1],b.d[h+2]),h+=3;a.o=na(a.O)}
function $a(a,b){var c=a.Fa,d=b.Db,e=c[0]*d[0]+c[4]*d[1]+c[8]*d[2]+c[12],f=c[1]*d[0]+c[5]*d[1]+c[9]*d[2]+c[13],g=c[2]*d[0]+c[6]*d[1]+c[10]*d[2]+c[14],c=Math.sqrt(e*e+f*f+g*g);if(c<a.o)return a.j=0,b.$a=b.Tb,b.sa=Math.max(b.sa,2*a.o),v;d=a.gc;d[0]=Math.min(Math.max(e,a.O.min[0]),a.O.max[0]);d[1]=Math.min(Math.max(f,a.O.min[1]),a.O.max[1]);d[2]=Math.min(Math.max(g,a.O.min[2]),a.O.max[2]);var e=e-d[0],f=f-d[1],g=g-d[2],h=d[0],k=d[1],i=d[2]+y.b.o,d=Math.sqrt(e*e+f*f+g*g),e=(e*h+f*k+g*i)/(Math.sqrt(h*
h+k*k+i*i)*d);a.j=d;e*=a.n.Va;if(-0.05>e)return p;e=b.cd;Ga(e,b.bc,a.v);a:{d=a.O;for(f=0;4>f;f++)if(g=e.aa[f],0>(0<=g.r[0]?d.max[0]:d.min[0])*g.r[0]+(0<=g.r[1]?d.max[1]:d.min[1])*g.r[1]+(0<=g.r[2]?d.max[2]:d.min[2])*g.r[2]+g.Ba){e=v;break a}e=p}return e?(b.$a=Math.max(b.Tb,Math.min(b.$a,c-2*a.o)),b.sa=Math.max(b.sa,c+2*a.o),v):p}Wa.prototype.S=function(a){if(3==this.state){a.ic(this.m);a.Ic(this.Q);for(var b in this.z)this.z[b].S&&this.z[b].S()}this.parent=this.Q=this.m=q};
function ab(a,b){if(a.children){for(var c=0;4>c;c++)a.children[c].S(b),ab(a.children[c],b);a.children=q}}function bb(a,b,c,d,e){for(var f=a.d,g=0.05*a.o,a=a.n.C,h=0;h<a;h++){var k=f[c]-b[0],i=f[c+1]-b[1],m=f[c+2]-b[2],n=g/Math.sqrt(k*k+i*i+m*m),k=k*n,i=i*n,m=m*n;f[e]=f[c]-k;f[e+1]=f[c+1]-i;f[e+2]=f[c+2]-m;e+=3;c+=d}}
Wa.prototype.Xa=function(a,b,c){var d=this.n.C;this.d=this.lc(c);this.O.Ab(this.d,3*d*d);this.o=na(this.O);if(1==this.n.La){c=[0,0,0];ha(this.Fa,c);var e=3*d*d;bb(this,c,0,3,e);e+=3*d;bb(this,c,3*d*(d-1),3,e);e+=3*d;bb(this,c,0,3*d,e);e+=3*d;bb(this,c,3*(d-1),3*d,e);e+=3*d;bb(this,c,3*(d*(d-1)/2),3,e);bb(this,c,3*((d-1)/2),3*d,e+3*d)}this.m!=q&&this.parent==q&&a.ic(this.m);this.m=a.Fc(this.d);b&&(this.Q=a.Gc(b));this.state=3};function cb(a){function b(a){var b=e.pop();d.bindTexture(d.TEXTURE_2D,b);d.texImage2D(d.TEXTURE_2D,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,a);d.generateMipmap(d.TEXTURE_2D);this.gd++;return b}function c(a){var b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b);d.texImage2D(d.TEXTURE_2D,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,a);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.generateMipmap(d.TEXTURE_2D);this.fd++;return b}var d=a.h,e=[],f=[];this.gd=this.fd=0;this.Gc=function(a){return 0<e.length?b(a):c(a)};this.Fc=function(a){var b;b=0<f.length?f.pop():d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,b);d.bufferData(d.ARRAY_BUFFER,a,d.STATIC_DRAW);return b};this.Ic=function(a){e.push(a)};this.ic=function(a){f.push(a)};this.Hc=function(){for(var a=0;a<e.length;a++)d.deleteTexture(e[a]);for(a=e.length=0;a<f.length;a++)d.deleteBuffer(f[a]);
f.length=0}};function db(a,b){this.ub=a;this.Sb=b}db.prototype.jc=function(a){a.La=1;a.Va=1;for(var b=[],c=180/this.Sb,d=360/this.ub,e=0;e<this.Sb;e++)for(var f=0;f<this.ub;f++){var g=new W(new N(-180+f*d,-90+e*c,-180+(f+1)*d,-90+(e+1)*c));g.n=a;b.push(g)}return b};db.prototype.pc=function(a,b){return Math.floor((b+90)*this.Sb/180)*this.ub+Math.floor((a+180)*this.ub/360)};function W(a){Wa.prototype.constructor.call(this);this.f=a}W.prototype=new Wa;
W.prototype.Da=function(a,b){var c=(a-this.f.t)/(this.f.J-this.f.t),d=(b-this.f.u)/(this.f.L-this.f.u),e=2*(1<=d?1:Math.floor(2*d))+Math.floor(2*c);if(this.children&&3==this.children[e].state)return this.children[e].Da(a,b);e=this.n.C;c=3*(Math.floor(d*e)*e+Math.floor(c*e));c=[this.d[c],this.d[c+1],this.d[c+2]];ha(this.v,c);return y.b.ta(c)[2]};
W.prototype.hc=function(){var a=0.5*(this.f.J+this.f.t),b=0.5*(this.f.u+this.f.L),c=new W(new N(this.f.t,b,a,this.f.u)),d=new W(new N(a,b,this.f.J,this.f.u)),e=new W(new N(this.f.t,this.f.L,a,b)),a=new W(new N(a,this.f.L,this.f.J,b));Za(c,this,0,0);Za(d,this,1,0);Za(e,this,0,1);Za(a,this,1,1);this.children=[c,d,e,a]};
W.prototype.lc=function(a){this.v=y.b.Hb(this.f.Gb());var b=G();H(this.v,b);this.Fa=b;for(var c=this.n.C,d=new Float32Array(3*c*(c+6)),e=(this.f.J-this.f.t)/(c-1),f=(this.f.L-this.f.u)/(c-1),g=y.b.o,h=y.b.U,k=0,i=this.f.u*Math.PI/180,f=f*Math.PI/180,e=e*Math.PI/180,m=0;m<c;m++){for(var n=Math.cos(i),j=Math.sin(i),l=this.f.t*Math.PI/180,o=0;o<c;o++){var s=a?h*a[k]:0,r=(g+s)*Math.cos(l)*n,t=(g+s)*Math.sin(l)*n,s=(g+s)*j,u=3*k;d[u]=b[0]*r+b[4]*t+b[8]*s+b[12];d[u+1]=b[1]*r+b[5]*t+b[9]*s+b[13];d[u+2]=
b[2]*r+b[6]*t+b[10]*s+b[14];k++;l+=e}i+=f}return d};function eb(a){this.Xb=a}eb.prototype.jc=function(a){a.La=1;a.Va=1;for(var b=[],c=Math.pow(2,this.Xb),d=Math.pow(2,this.Xb),e=0;e<d;e++)for(var f=0;f<c;f++){var g=new X(this.Xb,f,e);g.n=a;b.push(g)}return b};eb.prototype.pc=function(){return 0};function fb(a,b){var c=Math.PI-2*Math.PI*a/Math.pow(2,b);return 180/Math.PI*Math.atan(0.5*(Math.exp(c)-Math.exp(-c)))}
function X(a,b,c){Wa.prototype.constructor.call(this);this.Ga=a;this.x=b;this.y=c;this.f=new N(360*(b/Math.pow(2,a))-180,fb(c+1,a),360*((b+1)/Math.pow(2,a))-180,fb(c,a))}X.prototype=new Wa;X.prototype.Da=function(){return 0};X.prototype.hc=function(){var a=new X(this.Ga+1,2*this.x,2*this.y),b=new X(this.Ga+1,2*this.x+1,2*this.y),c=new X(this.Ga+1,2*this.x,2*this.y+1),d=new X(this.Ga+1,2*this.x+1,2*this.y+1);Za(a,this,0,0);Za(b,this,1,0);Za(c,this,0,1);Za(d,this,1,1);this.children=[a,b,c,d]};
X.prototype.lc=function(a){this.v=y.b.Hb(this.f.Gb());var b=G();H(this.v,b);this.Fa=b;for(var c=this.n.C,d=new Float32Array(3*c*(c+6)),e=1/(c-1),f=y.b.o,g=y.b.U,h=0,k=Math.pow(2,this.Ga),i=this.y,m=0;m<c;m++){for(var n=Math.PI*(1-2*i/k),j=Math.atan(0.5*(Math.exp(n)-Math.exp(-n))),n=Math.cos(j),j=Math.sin(j),l=this.x,o=0;o<c;o++){var s=Math.PI*(2*l/k-1),r=a?g*a[h]:0,t=(f+r)*Math.cos(s)*n,s=(f+r)*Math.sin(s)*n,r=(f+r)*j,u=3*h;d[u]=b[0]*t+b[4]*s+b[8]*r+b[12];d[u+1]=b[1]*t+b[5]*s+b[9]*r+b[13];d[u+2]=
b[2]*t+b[6]*s+b[10]*r+b[14];h++;l+=e}i+=e}return d};function gb(a){function b(){U(a)}this.a=a;this.za=new cb(a);this.Wa=this.ia=q;this.Aa=[];this.Pa=[];this.P=[];this.G=[];this.wa=q;this.Oa=[];for(var c=0;4>c;c++)this.Oa[c]=new hb(b);this.ka=v;this.Y={C:9,La:1,Va:1};this.X=q;this.kb=new Va(this.a,this.Y);this.freeze=this.wc=v;this.Od=this.kc=this.uc=this.zc=this.Z=this.hd=0;this.k=new V(this.a);Ra(this.k,"\tattribute vec3 vertex;\n\tattribute vec2 tcoord;\n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 projectionMatrix;\n\tuniform vec4 texTransform;\n\t\tvarying vec2 texCoord;\n\t\tvoid main(void) \n\t{\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n\t\ttexCoord = vec2(tcoord.s * texTransform.x + texTransform.z, tcoord.t * texTransform.y + texTransform.w);\n\t}\n\t",
"\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\t\n\tvarying vec2 texCoord;\n\t//uniform vec3 color;\n\tuniform sampler2D colorTexture;\n\tuniform int wireframe;\n\t\n\tvoid main(void)\n\t{\n\t\tif(wireframe == 1)\n\t\t\tgl_FragColor.rgb = vec3(1.0,1.0,1.0);\n\t\telse\n\t\t\tgl_FragColor.rgb = texture2D(colorTexture, texCoord).rgb;\n // * color;\n\t\tgl_FragColor.a = 1.0;\n\t}\n\t")}function ib(a,b){a.ia=b;a.reset();b&&(a.G=b.lb.jc(a.Y,a.za),a.ka=v)}
gb.prototype.reset=function(){for(var a=0;a<this.G.length;a++)ab(this.G[a],this.za),this.G[a].state=Xa,this.G[a].S();a=this.a.h;this.kb.reset();a.deleteBuffer(this.X);this.X=q;this.ka=v};
function jb(a,b,c){a.jd++;b.Z=a.Z;b.state==Xa&&(b.state=1,a.Pa.push(b));var d;if(d=3==b.state)if(d=c+1<a.ia.ab)if(d=a.a,b.j<b.o)d=p;else{var e=b.v,f=b.gc,g=d.ld;d=b.o/256/((e[0]*f[0]+e[4]*f[1]+e[8]*f[2]+e[12])*g[0]+(e[1]*f[0]+e[5]*f[1]+e[9]*f[2]+e[13])*g[1]+(e[2]*f[0]+e[6]*f[1]+e[10]*f[2]+e[14])*g[2]+g[3])>d.Rd}if(d){b.children==q&&b.hc();for(d=0;4>d;d++)$a(b.children[d],a.a)?ab(b.children[d],a.za):jb(a,b.children[d],c+1)}else a.Aa.push(b)}
gb.prototype.w=function(){if(this.ia!=q&&this.ia.qd){this.wa==q&&this.ia.bd&&(this.wa=Na(this.a,this.ia.bd));if(!this.freeze){var a=Date.now();this.Aa.length=0;this.jd=this.Pa.length=0;this.a.$a=1E10;this.a.sa=-1;if(!this.ka&&!this.wa){this.ka=p;for(var b=0;b<this.G.length;b++){var c=this.G[b],d=3==c.state;c.Z=this.Z;this.ka=this.ka&&d;!d&&c.state==Xa&&(c.state=1,this.Pa.push(c))}}if(this.ka||this.wa)for(b=0;b<this.G.length;b++)c=this.G[b],$a(c,this.a)?(this.wa&&(c.state=Xa,this.a.h.deleteTexture(c.Q)),
ab(c,this.za)):jb(this,c,0);b=Date.now();this.zc+=b-a}if(this.ka||this.wa){a=Date.now();b=this.a;c=this.a.h;c.enable(c.POLYGON_OFFSET_FILL);c.polygonOffset(0,4);c.disable(c.CULL_FACE);this.k.apply();var d=this.k.attributes,e=G();ka(45,b.canvas.width/b.canvas.height,b.$a,b.sa,b.na);c.activeTexture(c.TEXTURE0);c.uniformMatrix4fv(this.k.i.projectionMatrix,v,b.na);c.uniform1i(this.k.i.colorTexture,0);if(!this.X){for(var f=this.Y.C,g=this.Y.La,h=new Float32Array(2*f*(f+6*g)),k=1/(f-1),i=0,m=0,n=0;n<f;n++){for(var j=
0,l=0;l<f;l++)h[i]=j,h[i+1]=m,i+=2,j+=k;m+=k}if(1==g){for(l=m=j=0;l<f;l++)h[i]=j,h[i+1]=m,j+=k,i+=2;j=0;m=1;for(l=0;l<f;l++)h[i]=j,h[i+1]=m,j+=k,i+=2;for(l=m=j=0;l<f;l++)h[i]=j,h[i+1]=m,m+=k,i+=2;j=1;for(l=m=0;l<f;l++)h[i]=j,h[i+1]=m,m+=k,i+=2;j=0;m=0.5;for(l=0;l<f;l++)h[i]=j,h[i+1]=m,j+=k,i+=2;j=0.5;for(l=m=0;l<f;l++)h[i]=j,h[i+1]=m,m+=k,i+=2}f=this.a.h;g=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,g);f.bufferData(f.ARRAY_BUFFER,h,f.STATIC_DRAW);this.X=g}c.bindBuffer(c.ARRAY_BUFFER,this.X);c.vertexAttribPointer(d.tcoord,
2,c.FLOAT,v,0,0);h=q;f=[1,1,0,0];g=q;for(k=0;k<this.Aa.length;k++){i=this.Aa[k];m=3==i.state;n=-1==i.bb;!m&&n?(c.bindTexture(c.TEXTURE_2D,this.wa),j=i.Bd):(c.bindTexture(c.TEXTURE_2D,i.Q),j=f);g!=j&&(c.uniform4f(this.k.i.texTransform,j[0],j[1],j[2],j[3]),g=j);ga(b.s,i.v,e);c.uniformMatrix4fv(this.k.i.modelViewMatrix,v,e);c.bindBuffer(c.ARRAY_BUFFER,i.m);c.vertexAttribPointer(d.vertex,3,c.FLOAT,v,0,0);if(this.wc){if(m||n){j=this.kb;if(j.Sa==q){for(var o=j.n.C,l=[],s=0;s<o;s++)for(var r=0;r<o-1;r++)l.push(s*
o+r),l.push(s*o+r+1);for(s=0;s<o;s++)for(r=0;r<o-1;r++)l.push(r*o+s),l.push((r+1)*o+s);o=j.a.h;s=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s);o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),o.STATIC_DRAW);j.$=l.length;s.$=l.length;j.Sa=s}j=j.Sa}else{j=this.kb;l=i.bb;if(j.Na[l]==q){for(var s=l%2,r=Math.floor(l/2),t=j.n.C,u=(t-1)/2,o=[],w=u*r;w<u*(r+1)+1;w++)for(var z=u*s;z<u*(s+1);z++)o.push(w*t+z),o.push(w*t+z+1);for(w=u*s;w<u*(s+1)+1;w++)for(z=u*r;z<u*(r+1);z++)o.push(z*t+w),o.push((z+
1)*t+w);s=j.a.h;r=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r);s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),s.STATIC_DRAW);r.$=o.length;j.Na[l]=r}j=j.Na[l]}h!=j&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,j),h=j);c.uniform1i(this.k.i.wireframe,1);c.drawElements(c.LINES,h.$,c.UNSIGNED_SHORT,0);c.uniform1i(this.k.i.wireframe,0)}if(m||n){i=this.kb;if(i.ya==q){n=i.n.C;m=[];for(j=0;j<n-1;j++)for(l=0;l<n-1;l++)m.push(j*n+l),m.push((j+1)*n+l),m.push(j*n+l+1),m.push(j*n+l+1),m.push((j+1)*n+
l),m.push((j+1)*n+l+1);if(1==i.n.La){o=n*n;for(l=0;l<n-1;l++)m.push(o+l),m.push(l),m.push(o+l+1),m.push(o+l+1),m.push(l),m.push(l+1);o+=n;for(l=0;l<n-1;l++)m.push((n-1)*n+l),m.push(o+l),m.push((n-1)*n+l+1),m.push((n-1)*n+l+1),m.push(o+l),m.push(o+l+1);o+=n;for(j=0;j<n-1;j++)m.push(o+j),m.push(o+j+1),m.push(j*n),m.push(j*n),m.push(o+j+1),m.push((j+1)*n);o+=n;for(j=0;j<n-1;j++)m.push(j*n+n-1),m.push((j+1)*n+n-1),m.push(o+j),m.push(o+j),m.push((j+1)*n+n-1),m.push(o+j+1)}n=i.a.h;j=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,
j);n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),n.STATIC_DRAW);i.$=m.length;i.ya=j;i.ya.$=m.length}i=i.ya}else{m=this.kb;i=i.bb;if(m.Ma[i]==q){j=i%2;l=Math.floor(i/2);o=m.n.C;s=(o-1)/2;n=[];for(r=s*l;r<s*(l+1);r++)for(t=s*j;t<s*(j+1);t++)n.push(r*o+t),n.push((r+1)*o+t),n.push(r*o+t+1),n.push(r*o+t+1),n.push((r+1)*o+t),n.push((r+1)*o+t+1);m.zd[i]=n;if(1==m.n.La){u=0==l?o*o:o*o+4*o;w=0==l?0:s*o;for(r=s*j;r<s*(j+1);r++)n.push(u+r),n.push(w+r),n.push(u+r+1),n.push(u+r+1),n.push(w+r),n.push(w+
r+1);u=0==l?o*o+4*o:o*o+o;w=0==l?s*o:(o-1)*o;for(r=s*j;r<s*(j+1);r++)n.push(w+r),n.push(u+r),n.push(w+r+1),n.push(w+r+1),n.push(u+r),n.push(u+r+1);u=0==j?o*o+2*o:o*o+5*o;w=0==j?0:s;for(t=s*l;t<s*(l+1);t++)n.push(u+t),n.push(u+t+1),n.push(w+t*o),n.push(w+t*o),n.push(u+t+1),n.push(w+(t+1)*o);u=0==j?o*o+5*o:o*o+3*o;w=0==j?s:o-1;for(t=s*l;t<s*(l+1);t++)n.push(t*o+w),n.push((t+1)*o+w),n.push(u+t),n.push(u+t),n.push((t+1)*o+w),n.push(u+t+1)}j=m.a.h;l=j.createBuffer();j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,
l);j.bufferData(j.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),j.STATIC_DRAW);l.$=n.length;m.Ma[i]=l}i=m.Ma[i]}j=i;h!=j&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,j),h=j);c.drawElements(c.TRIANGLES,h.$,c.UNSIGNED_SHORT,0)}for(k=0;k<this.P.length;k++)this.P[k].ed&&this.P[k].w(this.Aa);c.disable(c.POLYGON_OFFSET_FILL);for(k=0;k<this.P.length;k++)this.P[k].ed||this.P[k].w(this.Aa);b=Date.now();this.uc+=b-a}a=Date.now();for(b=0;b<this.Oa.length;b++)if(c=this.Oa[b],(d=c.jb)&&c.zb){if(d.Z==this.Z){this.Wa?d.Xa(this.za,
c.ua,c.qb):d.Xa(this.za,c.ua);for(b=0;b<this.P.length;b++)this.P[b].Xa&&this.P[b].Xa(d);this.hd++;U(this.a)}else d.state=Xa;c.jb=q}else d&&c.Eb&&(d.state=-10,c.jb=q);b=Date.now();this.kc+=b-a;a=Date.now();this.Pa.sort(function(a,b){return a.j-b.j});b=this.Pa.length;for(c=0;c<b;c++)if(d=this.Pa[c],d.Z==this.Z){h=q;for(e=0;e<this.Oa.length;e++)if(!this.Oa[e].jb){h=this.Oa[e];break}h?(h.jb=d,e=q,this.Wa&&(e=this.Wa.sb(d)),f=this.ia.sb(d),h.zb=v,h.Eb=v,h.Mb=v,h.ua.src=f,e&&(h.Bb=v,h.Ta.open("GET",e),
h.Ta.send()),d.state=2):d.state=Xa}else d.state=Xa;b=Date.now();this.td+=b-a;this.Z++}};function kb(a){this.da=-1;this.lb=q;this.ab=-1;this.name=a&&a.hasOwnProperty("name")?a.name:"";this.Md=a&&a.hasOwnProperty("overlay")?a.overlay:v;this.qd=p;this.c=q}kb.prototype.Wb=function(a){if(this.c&&("ImageryRaster"==this.type&&ib(this.c.l,q),"ElevationRaster"==this.type)){var b=this.c.l;b.reset();b.Wa=q;b.Y.C=9}a&&("ImageryRaster"==this.type&&ib(a.l,this),"ElevationRaster"==this.type&&(b=a.l,b.reset(),b.Wa=this,b.Y.C=this?this.da:9));this.c=a};function lb(a){kb.prototype.constructor.call(this,a);this.Ua=a.baseUrl;this.da=a.tilePixelSize||256;this.lb=new db(4,2);this.ab=a.numberOfLevels||21;this.type="ImageryRaster";var b=this.Ua,b=-1==b.indexOf("?",0)?b+"?service=wms":b+"&service=wms",b=b+"&version="+(a.hasOwnProperty("version")?a.version:"1.1.1"),b=b+"&request=GetMap&srs="+(a.hasOwnProperty("srs")?a.srs:"EPSG:4326"),b=b+("&layers="+a.layers);a.hasOwnProperty("styles")&&(b+="&styles="+a.yd);this.Sc=b=b+"&format="+(a.hasOwnProperty("format")?
a.format:"image/jpeg")}y.ja(kb,lb);lb.prototype.sb=function(a){var a=a.f,b=this.Sc,b=b+"&width="+this.da,b=b+"&height="+this.da,b=b+"&bbox="+a.t,b=b+","+a.L,b=b+","+a.J;return b=b+","+a.u};function mb(a){kb.prototype.constructor.call(this,a);this.da=a.da||256;this.lb=new eb(a.Id||2);this.ab=a.ab||21;this.type="ImageryRaster";this.Ua=a.Ua}y.ja(kb,mb);mb.prototype.sb=function(a){return this.Qd+"/"+a.Ga+"/"+a.x+"/"+a.y+".png"};function nb(a){kb.prototype.constructor.call(this,a);this.da=a.tilePixelSize||33;this.lb=new db(4,2);this.ab=a.numberOfLevels||21;this.type="ElevationRaster";this.Ua=a.baseUrl}y.ja(kb,nb);nb.prototype.sb=function(a){var a=a.f,b=this.Ua,b=b+"?extent="+a.t,b=b+","+a.L,b=b+","+a.J,b=b+","+a.u,b=b+"&size="+this.da;return b=b+","+this.da};function hb(a){this.Eb=this.zb=v;this.jb=q;this.Mb=v;this.Bb=p;this.ec=a;var b=this;this.ua=new Image;this.ua.crossOrigin="";this.ua.onload=function(){b.Mb=p;b.Bb&&(b.zb=p,b.ec())};this.ua.onerror=function(){console.log("Error while loading "+b.ua.src);b.Eb=p};this.Ta=new XMLHttpRequest;this.Ta.onreadystatechange=function(){if(4==b.Ta.readyState&&200==b.Ta.status){b.qb=JSON.parse(b.Ta.responseText);for(var a=0;a<b.qb.length;a++)0>b.qb[a]&&(b.qb[a]=0);b.Bb=p;b.Mb&&(b.zb=p,b.ec())}}};function Y(a){this.a=new Ba(a);this.l=new gb(this.a);this.l.wc=a.showWireframe;this.Rb=[];var b=this;this.a.frame=function(){b.a.Fb=v;y.H.update();b.w();b.a.Ub++;0<y.H.qa.length&&U(b.a)};U(this.a);a.atmosphere&&(this.nb=new Ta(this.a))}x=Y.prototype;x.S=function(){this.l.za.Hc();this.l.Pd()};x.Ec=function(a){this.Rb.push(a);a.Wb(this);U(this.a)};x.sd=function(a){var b=this.Rb.indexOf(a);-1!=b&&(this.Rb.splice(b,1),a.Wb(q))};
x.Da=function(a,b){var c=this.l.G[this.l.ia.lb.pc(a,b)];return 3==c.state?c.Da(a,b):0};x.Qc=function(){return this.a.Ub};
x.Xc=function(){var a=this.a,b=G();H(a.s,b);var c=[b[12],b[13],b[14]];ga(a.na,a.s,b);H(b);for(var a=[[-1,-1,1,1],[1,-1,1,1],[-1,1,1,1],[1,1,1,1]],d=B(),e=[0,0,0],f=0;4>f;f++){ia(b,a[f]);E(a[f],1/a[f][3]);D(a[f],c,a[f]);F(a[f]);var g=sa(c,a[f],e);if(0>g)return q;a[f]=y.b.ta(qa(c,a[f],g,d))}b=new N;b.t=a[0][0];b.J=a[0][0];b.L=a[0][1];b.u=a[0][1];for(c=1;c<a.length;c++)b.t=Math.min(b.t,a[c][0]),b.J=Math.max(b.J,a[c][0]),b.L=Math.min(b.L,a[c][1]),b.u=Math.max(b.u,a[c][1]);return b};
x.nc=function(a,b){var c,d=this.a,e=2*(a/d.canvas.width)-1,f=-(2*(b/d.canvas.height)-1),g=G();ga(d.na,d.s,g);H(g);c=[];ia(g,[e,f,0,1],c);c[0]/=c[3];c[1]/=c[3];c[2]/=c[3];H(d.s,g);d=[g[12],g[13],g[14]];e=B();D(c,d,e);F(e);c=sa(d,e,[0,0,0]);c=0<=c?qa(d,e,c):q;if(c==q)return q;d=[];y.b.ta(c,d);return d};
x.w=function(){var a=this.a,b=a.h;b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.viewport(0,0,a.canvas.width,a.canvas.height);b=G();H(a.s,b);a.Db=[0,0,0];ha(b,a.Db);a.ld=Ma(a);Ga(a.bc,a.Nc,a.s);if(this.nb&&(a=this.nb,b=this.l,a.tb)){var c=a.a.h,d=a.a.s,e=d[12],f=d[13],g=d[14],d=[-(d[0]*e+d[1]*f+d[2]*g),-(d[4]*e+d[5]*f+d[6]*g),-(d[8]*e+d[9]*f+d[10]*g)],h=ea(d);a.ca=h<a.W?a.gb:a.hb;a.ha=h<a.W?a.Ya:a.Za;a.ca.apply();c.uniform3f(a.ca.i.v3CameraPos,d[0],d[1],d[2]);c.uniform1f(a.ca.i.fCameraHeight2,h*
h);c.uniform1f(a.ca.i.fCameraHeight,h);a.ha.apply();e=[0,0,0];ha(a.a.s,e);c.uniform3f(a.ha.i.earthCenter,e[0],e[1],e[2]);var k=[1,1,1];F(k);var e=k[0],f=k[1],g=k[2],i=a.a.s;k[0]=i[0]*e+i[4]*f+i[8]*g;k[1]=i[1]*e+i[5]*f+i[9]*g;k[2]=i[2]*e+i[6]*f+i[10]*g;c.uniform3f(a.ha.i.lightDir,k[0],k[1],k[2]);c.uniform3f(a.ha.i.v3CameraPos,d[0],d[1],d[2]);c.uniform1f(a.ha.i.fCameraHeight2,h*h);c.uniform1f(a.ha.i.fCameraHeight,h);b.k=a.ha;a.a.sa=3}this.l.w();0!=this.l.Aa.length&&(this.nb&&this.nb.w(),this.Ia&&this.Ia.w(),
this.Ka&&this.Ka.w())};var ob=q;y.Bc={Oc:function(a,b){ob||(ob=document.createElement("canvas"),ob.width=512,ob.height=20);b||(b="#fff");var c=ob.getContext("2d");c.clearRect(0,0,ob.width,ob.height);c.fillStyle=b;c.font="18px sans-serif";c.textBaseline="top";c.shadowColor="#000";c.shadowOffsetX=1;c.shadowOffsetY=1;c.shadowBlur=2;c.fillText(a,1,1);var d=c.measureText(a);return c.getImageData(0,0,Math.floor(d.width)+2,ob.height)}};
function pb(a){this.a=a.a;this.Y=a.Y;this.p=[];this.rc=0;this.k=new V(this.a);Ra(this.k,"\tattribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n\tuniform mat4 viewProjectionMatrix; \n\tuniform vec3 poiPosition; // world position \n\tuniform vec2 poiScale; // x,y scale \n\tuniform vec2 tst; \n\t\n\tvarying vec2 texCoord; \n\t\n\tvoid main(void)  \n\t{ \n\t\t// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n\t\ttexCoord = vertex.xy + vec2(0.5) + tst; \n\t\t// Invert y \n\t\ttexCoord.y = 1.0 - texCoord.y; \n\t\t\n\t\t// Compute poi position in clip coordinate \n\t\tgl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n\t\tgl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n\t} \n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\t\n\tvarying vec2 texCoord; \n\tuniform sampler2D texture; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = texture2D(texture, texCoord); \n\t} \n\t");
this.xa=new Oa(this.a);Pa(this.xa,[-0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0,0.5,-0.5,0]);Qa(this.xa,[0,3,1,1,3,2])}function qb(a,b,c){b.Q=Na(a.a,c);b.yc=c.width;b.$b=c.height}pb.prototype.M=function(a,b){if(b){var c=this.Ib(b);if(b.label){var d=y.Bc.Oc(a.properties.name,a.properties.textColor);qb(this,c,d)}var d=y.b.ga(a.geometry.coordinates),e=B();F(d,e);c.ma.push({nd:d,Dd:e,rb:a})}};
pb.prototype.oa=function(a){for(var b=0;b<this.p.length;b++)for(var c=this.p[b],d=0;d<c.ma.length;d++)if(c.ma[d].rb==a){c.ma.splice(d,1);return}};pb.prototype.Ib=function(a){if(!a.label)for(var b=0;b<this.p.length;b++){var c=this.p[b];if(c.style.Lb==a.Lb&&c.style.Kb==a.Kb&&c.style.label==c.style.label)return c}c={Q:q,ma:[],style:a};if(a.iconUrl){var d=new Image,e=this;d.onload=function(){qb(e,c,d)};d.src=a.Lb}else a.icon&&qb(this,c,a.Kb);this.p.push(c);return c};
pb.prototype.w=function(){if(0!=this.p.length){this.rc=0;var a=this.a,b=this.a.h;b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.k.apply();ga(a.na,a.s,a.Ha);b.uniformMatrix4fv(this.k.i.viewProjectionMatrix,v,a.Ha);b.uniform1i(this.k.i.texture,0);H(a.s,a.Ha);var c=[a.Ha[8],a.Ha[9],a.Ha[10]];F(c);E(c,this.Y.Va,c);for(var d=Ma(a),e=0;e<this.p.length;e++){var f=this.p[e];if(!(f.Q==q||0==f.ma.length)){b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,
f.Q);var g=[2*f.yc/a.canvas.width,2*f.$b/a.canvas.height];b.uniform2fv(this.k.i.poiScale,g);b.uniform2fv(this.k.i.tst,[0.5/f.yc,0.5/f.$b]);for(var h=0;h<f.ma.length;++h){var k=f.ma[h].nd,i=f.ma[h].Dd,g=f.$b*(d[0]*k[0]+d[1]*k[1]+d[2]*k[2]+d[3]),g=g*this.Y.Va,m;if(m=!(0.001*(g/y.b.U)>f.style.md))if(m=0<fa(i,c)){a:{m=a.bc;for(var n=1,j=0;4>j;j++){var l=m.aa[j].r,l=k[0]*l[0]+k[1]*l[1]+k[2]*l[2]+m.aa[j].Ba;if(l<=g){if(l<-g){m=-1;break a}n=0}}m=n}m=0<=m}m&&(b.uniform3f(this.k.i.poiPosition,i[0]*g+k[0],
i[1]*g+k[1],i[2]*g+k[2]),this.xa.w(this.k.attributes),this.rc++)}}}b.disable(b.BLEND)}};function rb(){this.strokeColor=[1,0,0,1];this.fillColor=[1,0,0,1];this.yb=1;this.Lb="hotspot.png";this.label=this.Kb=q;this.fill=v;this.md=40};function sb(a,b){this.h=b;this.style=a;this.A=this.m=q;this.d=[];this.B=[];this.T=[];this.pb=this.Ca=p;this.fa=this.D=q;this.Jb=-1}x=sb.prototype;x.dc=function(){this.fa=[[],[],[],[]];this.D=[q,q,q,q]};
x.oa=function(a){for(var b=-1,c=0;c<this.T.length;c++){var d=this.T[c];if(d.rb==a){this.d.splice(d.xb,d.mb);this.B.splice(d.ib,d.Nb);a=d.mb/3;for(d=d.ib;d<this.B.length;d++)this.B[d]-=a;b=c;break}}if(0<=b){this.pb=this.Ca=p;for(c=b+1;c<this.T.length;c++)d=this.T[c],d.xb-=this.T[b].mb,d.ib-=this.T[b].Nb;this.T.splice(b,1);tb(this);this.fa=q;return p}return v};
x.M=function(a,b){var c=q,d=v;a._crossDateLine&&0>b.f.t&&(d=p);var e=a.geometry;"Polygon"==e.type?(c=d?e._negCoordinates[0]:e.coordinates[0],(c[0][0]!=c[c.length-1][0]||c[0][1]!=c[c.length-1][1])&&c.push(c[0])):"LineString"==e.type&&(c=d?e._negCoordinates:e.coordinates);if(c!=q){for(var d={rb:a,xb:this.d.length,ib:this.B.length,mb:0,Nb:0},e=b.f.J-b.f.t,f=b.f.L-b.f.u,g=b.n.C,h=0;h<c.length-1;h++){for(var k=(g-1)*(c[h][0]-b.f.t)/e,i=(g-1)*(c[h][1]-b.f.u)/f,m=(g-1)*(c[h+1][0]-b.f.t)/e,n=(g-1)*(c[h+1][1]-
b.f.u)/f,j=Math.max(-1,Math.min(k,m)),l=Math.min(g-1,Math.max(k,m)),o=Math.max(-1,Math.min(i,n)),s=Math.min(g-1,Math.max(i,n)),r=[],j=Math.floor(j)+1;j<Math.floor(l)+1;j++){var t=j,u=ra(k,i,m,n,t,0,t,g-1);if(0<u[0]&&1>u[0]&&0<u[1]&&1>u[1]){var w=u[1]*(g-1),t=Math.floor(w),z=w-t,A=3*(t*g+j),t=(1-z)*b.d[A]+z*b.d[A+3*g],w=(1-z)*b.d[A+1]+z*b.d[A+3*g+1],z=(1-z)*b.d[A+2]+z*b.d[A+3*g+2];r.push([u[0],t,w,z])}}for(j=Math.floor(o)+1;j<Math.floor(s)+1;j++)w=j,u=ra(k,i,m,n,0,w,g-1,w),0<u[0]&&(1>u[0]&&0<u[1]&&
1>u[1])&&(t=u[1]*(g-1),o=Math.floor(t),l=t-o,A=3*(j*g+o),t=(1-l)*b.d[A]+l*b.d[A+3],w=(1-l)*b.d[A+1]+l*b.d[A+4],z=(1-l)*b.d[A+2]+l*b.d[A+5],r.push([u[0],t,w,z]));r.sort(function(a,b){return a[0]>b[0]});s=this.d.length/3;0<k&&(k<g-1&&0<i&&i<g-1)&&(k=Ya(b,k,i),this.d.push(k[0]),this.d.push(k[1]),this.d.push(k[2]));for(j=0;j<r.length;j++)this.d.push(r[j][1]),this.d.push(r[j][2]),this.d.push(r[j][3]);0<m&&(m<g-1&&0<n&&n<g-1)&&(k=Ya(b,m,n),this.d.push(k[0]),this.d.push(k[1]),this.d.push(k[2]));m=this.d.length/
3;for(j=s;j<m-1;j++)this.B.push(j),this.B.push(j+1)}d.mb=this.d.length-d.xb;d.Nb=this.B.length-d.ib;return 0<d.mb?(this.T.push(d),this.pb=this.Ca=p,tb(this),this.fa=q,p):v}};function tb(a){var b=a.h;a.D&&(a.D[0]&&b.deleteBuffer(a.D[0]),a.D[1]&&b.deleteBuffer(a.D[1]),a.D[2]&&b.deleteBuffer(a.D[2]),a.D[3]&&b.deleteBuffer(a.D[3]));a.D=q}x.S=function(){var a=this.h;this.A&&a.deleteBuffer(this.A);this.m&&a.deleteBuffer(this.m);tb(this);this.m=this.A=q};
x.w=function(a){var b=this.h;this.m==q&&(this.m=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.m);this.Ca&&(b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.d),b.STATIC_DRAW),this.Ca=v);b.vertexAttribPointer(a.vertex,3,b.FLOAT,v,0,0);this.A==q&&(this.A=b.createBuffer());b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.A);this.pb&&(b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.B),b.STATIC_DRAW),this.pb=v);b.drawElements(this.Jb,this.B.length,b.UNSIGNED_SHORT,0)};function ub(a,b){sb.prototype.constructor.call(this,a,b);this.Jb=b.LINES}y.ja(sb,ub);ub.prototype.dc=function(){this.fa=[[],[],[],[]];this.D=[q,q,q,q];for(var a=0;a<this.B.length/2;a++){var b=3*this.B[2*a],c=3*this.B[2*a+1],d=this.d[b],e=this.d[c],f=0;if(0<d||0==d&&0<e)f=1;b=this.d[b+1];c=this.d[c+1];d=1;if(0<b||0==b&&0<c)d=0;this.fa[2*d+f].push(this.B[2*a]);this.fa[2*d+f].push(this.B[2*a+1])}};function vb(a){this.l=a;this.p=[{style:new rb,F:[]}];this.k=new V(this.l.a);Ra(this.k,"\tattribute vec3 vertex; \n\tuniform float zOffset; \n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 projectionMatrix;\n\t\n\tvoid main(void)  \n\t{ \n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z + zOffset, 1.0); \n\t} \n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\tuniform vec4 color; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = color; \n\t} \n\t");
this.fb=this.Zb=q;this.id="empty"}vb.prototype.Ib=function(a){for(var b=0;b<this.p.length;b++)if(this.Zb(a,this.p[b].style))return this.p[b];a={style:a,F:[]};this.p.push(a);return a};function wb(a,b,c,d){if(d.z[a.id])for(var e=d.z[a.id].ba,f=0;f<e.length;f++)if(e[f].style==b&&e[f].oa(c)&&d.children)for(f=0;4>f;f++)3==d.children[f].state&&wb(a,b,c,d.children[f])}
vb.prototype.oa=function(a){for(var b=q,c=0;c<this.p.length;c++){var d=this.p[c].F.indexOf(a);-1!=d&&(b=this.p[c].yd,this.p[c].F.splice(d,1))}if(b)for(c=0;c<this.l.G.length;c++)wb(this,b,a,this.l.G[c])};vb.prototype.M=function(a,b){var c=this.Ib(b);c.F.push(a);for(var d=0;d<this.l.G.length;d++){var e=this.l.G[d];3==e.state&&xb(this,c.style,a,e)}};
function xb(a,b,c,d){var e=v,f;a:{if(d.z[a.id]){f=d.z[a.id].ba;for(var g=0;g<f.length;g++)if(f[g].style==b){f=f[g];break a}}f=q}f||(f=new a.fb(b,a.l.a.h),e=p);if(f.M(c,d)&&d.children)for(g=0;4>g;g++)3==d.children[g].state&&xb(a,b,c,d.children[g]);e&&yb(a,d,f)}function zb(){this.ba=[]}zb.prototype.S=function(){for(var a=0;a<this.ba.length;a++)this.ba[a].S()};function yb(a,b,c){0<c.d.length&&(b.z[a.id]||(b.z[a.id]=new zb),b.z[a.id].ba.push(c))}
vb.prototype.Xa=function(a){if(a.parent)for(var b=a.parent.z[this.id],c=b?b.ba.length:0,d=0;d<c;d++){for(var e=b.ba[d],f=new this.fb(e.style,this.l.a.h),g=0;g<e.T.length;g++)f.M(e.T[g].rb,a);yb(this,a,f)}else for(d=0;d<this.p.length;d++){b=this.p[d];f=new this.fb(b.style,this.l.a.h);for(g=0;g<b.F.length;g++)f.M(b.F[g],a);yb(this,a,f)}};
vb.prototype.w=function(a){var b=this.l.a,c=b.h,d=G();this.k.apply();c.depthFunc(c.LEQUAL);c.uniformMatrix4fv(this.k.i.projectionMatrix,v,b.na);for(var e=q,f=0;f<a.length;++f){var g=a[f];if(g.z[this.id]){ga(b.s,g.v,d);c.uniformMatrix4fv(this.k.i.modelViewMatrix,v,d);c.uniform1f(this.k.i.zOffset,7E-4*g.o);for(var h=g.z[this.id].ba,k=0;k<h.length;k++){var i=h[k];i.style!=e&&(e=i.style,c.lineWidth(e.yb),c.uniform4f(this.k.i.color,e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeColor[3]));
h[k].w(this.k.attributes)}}else if(3!=g.state&&g.parent.z[this.id]){ga(b.s,g.parent.v,d);c.uniformMatrix4fv(this.k.i.modelViewMatrix,v,d);c.uniform1f(this.k.i.zOffset,7E-4*g.parent.o);h=g.parent.z[this.id].ba;for(k=0;k<h.length;k++){i=h[k];i.style!=e&&(e=i.style,c.lineWidth(e.yb),c.uniform4f(this.k.i.color,e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeColor[3]));var i=h[k],m=this.k.attributes,n=g.bb;i.fa==q&&i.dc();var j=i.fa[n];if(0!=j.length){var l=i.h;i.m==q&&(i.m=l.createBuffer());
l.bindBuffer(l.ARRAY_BUFFER,i.m);i.Ca&&(l.bufferData(l.ARRAY_BUFFER,new Float32Array(i.d),l.STATIC_DRAW),i.Ca=v);l.vertexAttribPointer(m.vertex,3,l.FLOAT,v,0,0);(m=i.D[n])?l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,m):(l=i.h,m=l.createBuffer(),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,m),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),l.STATIC_DRAW),i.D[n]=m);l.drawElements(i.Jb,j.length,l.UNSIGNED_SHORT,0)}}}}c.depthFunc(c.LESS)};function Z(){this.style=new rb;this.type="Vector";this.F=[];this.c=q}x=Z.prototype;x.Wb=function(a){if(this.c)for(var b=0;b<this.F.length;b++)Ab(this,this.F[b]);if(this.c=a)for(b=0;b<this.F.length;b++)Bb(this,this.F[b])};x.Dc=function(a){if(a=a.features)for(var b=0;b<a.length;b++)this.M(a[b])};x.M=function(a){this.F.push(a);this.c&&Bb(this,a)};x.oa=function(a){this.F.splice(this.F.indexOf(a),1);this.c&&Ab(this,a)};x.dd=function(a,b){this.Nd(a);this.Hd(a,b)};
function Cb(a,b,c){a.c.la||(a.c.la=new vb(a.c.l),a.c.la.id="lineString",a.c.la.Zb=function(a,b){return a.strokeColor[0]==b.strokeColor[0]&&a.strokeColor[1]==b.strokeColor[1]&&a.strokeColor[2]==b.strokeColor[2]&&a.strokeColor[3]==b.strokeColor[3]&&a.yb==b.yb},a.c.la.fb=ub,a.c.l.P.push(a.c.la));var d=b.geometry,e;a:{e=d.coordinates[0];for(var f=e[0][0],g=1;g<e.length;g++){if(180<Math.abs(e[g][0]-f)){e=p;break a}coord=e[g]}e=v}if(e){b._crossDateLine=p;e=d.coordinates[0];for(f=0;f<e.length;f++)0>e[f][0]&&
(e[f][0]+=360);g=[];for(f=0;f<e.length;f++)g[f]=[e[f][0]-360,e[f][1]];d._negCoordinates=[g]}a.c.la.M(b,c)}
function Bb(a,b){var c=b.geometry;if(c){var d=a.style,e=b.properties;e&&e.style&&(d=e.style);switch(c.type){case "Point":a.c.Ia||(a.c.Ia=new pb(a.c.l));a.c.Ia.M(b,d);break;case "Polygon":d.fill?(a.c.Ja||(a.c.Ja=new vb(a.c.l),a.c.Ja.id="polygon",a.c.Ja.Zb=function(a,b){return a.fill==b.fill},a.c.Ja.fb=y.Fd,a.c.l.P.push(a.c.Ja)),a.c.Ja.M(b,d)):Cb(a,b,d);break;case "LineString":Cb(a,b,d);break;case "GeometryCollection":c=c.geometries;for(e=0;e<c.length;e++){var f={type:"Feature",properties:b.properties,
geometry:c[e]};f.properties.style=d;Bb(a,f)}break;case "SimpleLineCollection":a.c.Ka||(a.c.Ka=new y.Gd(a.c.l)),a.c.Ka.M(b,d)}}}function Ab(a,b){var c=b.geometry;if(c)switch(c.type){case "Point":a.c.Ia&&a.c.Ia.oa(b);break;case "Polygon":case "LineString":a.c.la&&a.c.la.oa(b);break;case "SimpleLineCollection":a.c.Ka&&a.c.Ka.oa(b)}};window.GlobWeb=y;window.GlobWeb.Globe=Y;window.GlobWeb.Navigator=Q;window.GlobWeb.WMSLayer=lb;window.GlobWeb.OSMLayer=mb;window.GlobWeb.BasicElevationLayer=nb;window.GlobWeb.VectorLayer=Z;window.GlobWeb.GroundOverlayLayer=y.Ed;Y.prototype.addLayer=Y.prototype.Ec;Y.prototype.removeLayer=Y.prototype.sd;Y.prototype.dispose=Y.prototype.S;Y.prototype.getFrameNumber=Y.prototype.Qc;Y.prototype.getLonLatFromPixel=Y.prototype.nc;Y.prototype.getViewportGeoBound=Y.prototype.Xc;
Z.prototype.addFeatureCollection=Z.prototype.Dc;Z.prototype.addFeature=Z.prototype.M;Z.prototype.modifyFeatureStyle=Z.prototype.dd;Z.prototype.removeFeature=Z.prototype.oa;Q.prototype.zoomTo=Q.prototype.Ac;Q.prototype.subscribe=Q.prototype.Ad;Q.prototype.unsubscribe=Q.prototype.Cd;Q.prototype.setupDefaultEventHandlers=Q.prototype.xd;window.GlobWeb.PathAnimation=P;P.prototype.stop=P.prototype.stop;P.prototype.start=P.prototype.start;P.prototype.setAltitudeOffset=P.prototype.ud;
P.prototype.setDirectionAngle=P.prototype.vd;P.prototype.setSpeed=P.prototype.wd;window.GlobWeb.GeoBound=N;N.prototype.getSouth=N.prototype.Vc;N.prototype.getNorth=N.prototype.Tc;N.prototype.getEast=N.prototype.Pc;N.prototype.getWest=N.prototype.Yc;
