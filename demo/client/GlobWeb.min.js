/***************************************
 * Copyright 2011, 2012 GlobWeb contributors.
 *
 * This file is part of GlobWeb.
 *
 * GlobWeb is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, version 3 of the License, or
 * (at your option) any later version.
 *
 * GlobWeb is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GlobWeb. If not, see <http://www.gnu.org/licenses/>.
 ***************************************/
var o=!0,t=null,v=!1;function aa(a){return function(){return this[a]}}var w,ba=ba||{};var ca=Array;function C(a){var b=new ca(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b}function da(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]}function ea(a,b,c){if(!c||a==c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c}function E(a,b,c){if(!c||a==c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c}function F(a,b,c){if(!c||a==c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c}
function G(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(!f)return b[0]=0,b[1]=0,b[2]=0,b;if(1==f)return b[0]=c,b[1]=d,b[2]=e,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b}function fa(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f;return c}function ga(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)}function ha(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function H(){return new ca(16)}
function I(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],i=a[5],j=a[6],h=a[7],l=a[8],m=a[9],k=a[10],n=a[11],p=a[12],q=a[13],r=a[14],s=a[15],u=c*i-d*g,x=c*j-e*g,z=c*h-f*g,A=d*j-e*i,y=d*h-f*i,B=e*h-f*j,L=l*q-m*p,M=l*r-k*p,N=l*s-n*p,R=m*r-k*q,S=m*s-n*q,T=k*s-n*r,D=1/(u*T-x*S+z*R+A*N-y*M+B*L);b[0]=(i*T-j*S+h*R)*D;b[1]=(-d*T+e*S-f*R)*D;b[2]=(q*B-r*y+s*A)*D;b[3]=(-m*B+k*y-n*A)*D;b[4]=(-g*T+j*N-h*M)*D;b[5]=(c*T-e*N+f*M)*D;b[6]=(-p*B+r*z-s*x)*D;b[7]=(l*B-k*z+n*x)*D;b[8]=(g*S-i*N+h*L)*D;b[9]=(-c*S+
d*N-f*L)*D;b[10]=(p*y-q*z+s*u)*D;b[11]=(-l*y+m*z-n*u)*D;b[12]=(-g*R+i*M-j*L)*D;b[13]=(c*R-d*M+e*L)*D;b[14]=(-p*A+q*x-r*u)*D;b[15]=(l*A-m*x+k*u)*D}
function ia(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],i=a[4],j=a[5],h=a[6],l=a[7],m=a[8],k=a[9],n=a[10],p=a[11],q=a[12],r=a[13],s=a[14],a=a[15],u=b[0],x=b[1],z=b[2],A=b[3],y=b[4],B=b[5],L=b[6],M=b[7],N=b[8],R=b[9],S=b[10],T=b[11],D=b[12],za=b[13],Aa=b[14],b=b[15];c[0]=u*d+x*i+z*m+A*q;c[1]=u*e+x*j+z*k+A*r;c[2]=u*f+x*h+z*n+A*s;c[3]=u*g+x*l+z*p+A*a;c[4]=y*d+B*i+L*m+M*q;c[5]=y*e+B*j+L*k+M*r;c[6]=y*f+B*h+L*n+M*s;c[7]=y*g+B*l+L*p+M*a;c[8]=N*d+R*i+S*m+T*q;c[9]=N*e+R*j+S*k+T*r;c[10]=N*f+R*h+S*n+T*s;
c[11]=N*g+R*l+S*p+T*a;c[12]=D*d+za*i+Aa*m+b*q;c[13]=D*e+za*j+Aa*k+b*r;c[14]=D*f+za*h+Aa*n+b*s;c[15]=D*g+za*l+Aa*p+b*a}function ja(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14]}function ka(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b}
function la(a,b,c){var d,e=c[0],f=c[1],c=c[2],g=Math.sqrt(e*e+f*f+c*c);if(g){1!=g&&(g=1/g,e*=g,f*=g,c*=g);var i=Math.sin(b),j=Math.cos(b),h=1-j,b=a[0],g=a[1],l=a[2],m=a[3],k=a[4],n=a[5],p=a[6],q=a[7],r=a[8],s=a[9],u=a[10],x=a[11],z=e*e*h+j,A=f*e*h+c*i,y=c*e*h-f*i,B=e*f*h-c*i,L=f*f*h+j,M=c*f*h+e*i,N=e*c*h+f*i,e=f*c*h-e*i,f=c*c*h+j;d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*z+k*A+r*y;d[1]=g*z+n*A+s*y;d[2]=l*z+p*A+u*y;d[3]=m*z+q*A+x*y;d[4]=b*B+k*L+r*M;d[5]=g*B+n*L+s*M;d[6]=
l*B+p*L+u*M;d[7]=m*B+q*L+x*M;d[8]=b*N+k*e+r*f;d[9]=g*N+n*e+s*f;d[10]=l*N+p*e+u*f;d[11]=m*N+q*e+x*f}}function ma(a,b,c,d,e){var a=c*Math.tan(a*Math.PI/360),b=a*b,f=-b,g=-a;e||(e=H());var i=b-f,j=a-g,h=d-c;e[0]=2*c/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*c/j;e[6]=0;e[7]=0;e[8]=(b+f)/i;e[9]=(a+g)/j;e[10]=-(d+c)/h;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(2*d*c)/h;e[15]=0};function na(a,b){a.a.ac=this;this.c=a;var c=b?b.element:void 0;c&&(this.element="string"==typeof c?document.getElementById(c):c);this.yd=a.a.jc;this.Gd=b&&b.verbose?b.verbose:v;this.ea=0;var d=this;window.setInterval(function(){d.print()},1E3)}na.prototype.start=function(a){this[a]=Date.now()};na.prototype.end=function(a){var b=Date.now()-this[a],c=this["max_"+a]||-1;c<b&&(c=b);var d=this["sum_"+a]||0;this[a]=b;this["max_"+a]=c;this["sum_"+a]=d+b;"globalRenderTime"==a&&this.ea++};
na.prototype.print=function(){if(0<this.ea){var a="";this.yd&&(a+="FPS : "+this.ea+"<br>");a+="Average render time : "+(this.sum_globalRenderTime/this.ea).toFixed(2)+" ms";a+="<br># rendered tiles : "+this.c.l.pa.length;this.Gd&&(a+="<br>Average traverse tiles time : "+(this.sum_traverseTime/this.ea).toFixed(2)+" ms",a+="<br>Average render tiles time : "+(this.sum_renderTime/this.ea).toFixed(2)+" ms",a+="<br>Average generate tiles time : "+(this.sum_generateTime/this.ea).toFixed(2)+" ms",a+="<br>Average request tiles time : "+
(this.sum_requestTime/this.ea).toFixed(2)+" ms",a+="<br>Max render time : "+this.max_globalRenderTime+" ms",a+="<br>Max traverse tiles time : "+this.max_traverseTime+" ms",a+="<br>Max render tiles time : "+this.max_renderTime+" ms",a+="<br>Max generate tiles time : "+this.max_generateTime+" ms",a+="<br>Max request tiles time : "+this.max_requestTime+" ms");this.element.innerHTML=a;this.ea=this.max_requestTime=this.max_generateTime=this.max_renderTime=this.max_traverseTime=this.max_globalRenderTime=
this.sum_requestTime=this.sum_generateTime=this.sum_renderTime=this.sum_traverseTime=this.sum_globalRenderTime=0}};function J(a,b){function c(){}c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b};function K(a,b,c,d){this.J=b;this.r=a;this.s=d;this.G=c}w=K.prototype;w.Lb=function(){return[0.5*(this.G+this.r),0.5*(this.J+this.s),0]};w.Vc=aa("s");w.Wc=aa("J");w.Yc=aa("r");w.Tc=aa("G");function oa(a,b){a&&(this.min=C(a));b&&(this.max=C(b))}oa.prototype.extend=function(a,b,c){this.min?(a<this.min[0]&&(this.min[0]=a),b<this.min[1]&&(this.min[1]=b),c<this.min[2]&&(this.min[2]=c),a>this.max[0]&&(this.max[0]=a),b>this.max[1]&&(this.max[1]=b),c>this.max[2]&&(this.max[2]=c)):(this.min=C(),this.max=C(),this.min[0]=a,this.min[1]=b,this.min[2]=c,this.max[0]=a,this.max[1]=b,this.max[2]=c)};
oa.prototype.Db=function(a,b,c){this.min||(this.min=C(),this.max=C());this.min[0]=a[0];this.min[1]=a[1];this.min[2]=a[2];this.max[0]=a[0];this.max[1]=a[1];this.max[2]=a[2];for(var d=c||3,b=b||a.length;c<b;c+=d)for(var e=0;3>e;e++)a[c+e]<this.min[e]&&(this.min[e]=a[c+e]),a[c+e]>this.max[e]&&(this.max[e]=a[c+e])};oa.prototype.Lb=function(){return[0.5*(this.max[0]+this.min[0]),0.5*(this.max[1]+this.min[1]),0.5*(this.max[2]+this.min[2])]};function pa(a){var b=C();E(a.max,a.min,b);return 0.5*ga(b)};function qa(a,b,c){return b!=c?(a-b)/(c-b):0}function ra(a){a-=1;return 1-a*a}function sa(a,b,c,d){d||(d=C());F(b,c,d);ea(d,a,d);return d}function ta(a,b,c,d,e,f,g,i){var j=(i-f)*(c-a)-(g-e)*(d-b);return 0==j?[-1,-1]:[((g-e)*(b-f)-(i-f)*(a-e))/j,((c-a)*(b-f)-(d-b)*(a-e))/j]}function ua(a,b,c){c=E(a,c,C());a=2*ha(b,c);c=a*a-4*(ha(c,c)-1);if(0>c)return-1;c=Math.sqrt(c);b=(-a-c)/2;a=(-a+c)/2;b>a&&(c=b,b=a,a=c);return 0>a?-1:0>b?a:b}
function va(a,b){var c;c||(c=b);ka(a,b,c);var d=1/c[3];c[0]*=d;c[1]*=d;c[2]*=d;return c}function wa(a,b,c){c||(c=H());var d=c;d||(d=H());var e=b[0],f=b[1],g=b[2],i=b[3],j=e+e,h=f+f,l=g+g,b=e*j,m=e*h,e=e*l,k=f*h,f=f*l,g=g*l,j=i*j,h=i*h,i=i*l;d[0]=1-(k+g);d[1]=m+i;d[2]=e-h;d[3]=0;d[4]=m-i;d[5]=1-(b+g);d[6]=f+j;d[7]=0;d[8]=e+h;d[9]=f-j;d[10]=1-(b+k);d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;c[12]=a[0];c[13]=a[1];c[14]=a[2]};function O(){this.yb=this.startTime=-1;this.c=t}O.prototype.start=function(){if(this.c&&(-1==this.startTime||-1!=this.yb)){var a=Date.now();-1==this.startTime?this.startTime=a:(this.startTime=a-this.yb,this.yb=-1);this.c.qa.push(this);P(this.c.a)}};O.prototype.stop=function(){this.yb=this.startTime=-1;this.Bc&&this.Bc();this.c.qa.splice(this.c.qa.indexOf(this),1)};function xa(a,b,c,d,e){O.prototype.constructor.call(this);this.Pa=[[0,b],[1,c]];this.duration=a;this.$c=d;this.Yb=e}J(O,xa);xa.prototype.start=function(){O.prototype.start.call(this);this.Yb(this.$b)};xa.prototype.stop=function(){O.prototype.stop.call(this);this.Yb(this.Fb)};
xa.prototype.update=function(a){a=qa(a,this.startTime,this.startTime+this.duration);if(1<=a)this.stop();else{for(var b=this.Pa.length,c=0;c<b&&this.Pa[c][0]<a;)c++;c=Math.min(c,b-1);b=Math.max(0,c-1);a=qa(a,this.Pa[b][0],this.Pa[c][0]);a=this.$c(a,this.Pa[b][1],this.Pa[c][1]);this.Yb(a)}};function ya(a,b){O.prototype.constructor.call(this);this.I=[];this.duration=a;this.Oa=b}J(O,ya);function Ba(a,b,c,d,e){this.start=a;this.$b=b;this.end=c;this.Fb=d;this.ad=e}function Ca(a,b,c,d,e,f){for(var g=a.I.length,i=0;i<g&&a.I[i].end<=b;)i++;a.I.splice(i,0,new Ba(b,c,d,e,f))}ya.prototype.start=function(){O.prototype.start.call(this);this.Oa(this.I[0].$b)};ya.prototype.stop=function(){O.prototype.stop.call(this);this.Oa(this.I[this.I.length-1].Fb)};
ya.prototype.update=function(a){a=qa(a,this.startTime,this.startTime+this.duration);if(1<=a)this.stop();else{for(var b=this.I.length,c=0;c<b&&this.I[c].end<a;)c++;c=Math.min(c,b-1);a=qa(a,this.I[c].start,this.I[c].end);a=this.I[c].ad(a,this.I[c].$b,this.I[c].Fb);this.Oa(a)}};var Q=1/6356752.3142;function Da(a,b){b||(b=Array(3));var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,e=Math.cos(d),f=1+(2<a.length?Q*a[2]:0);b[0]=f*Math.cos(c)*e;b[1]=f*Math.sin(c)*e;b[2]=f*Math.sin(d);return b}function Ea(a,b){b||(b=Array(3));var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=Math.asin(a[2]/c);b[0]=180*Math.atan2(a[1]/c,a[0]/c)/Math.PI;b[1]=180*d/Math.PI;b[2]=6356752.3142*Math.abs(c-1);return b}
function Fa(a,b){b||(b=H());var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,d=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],c=[-Math.sin(c),Math.cos(c),0],e=C();fa(d,c,e);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=0;b[4]=e[0];b[5]=e[1];b[6]=e[2];b[7]=0;b[8]=d[0];b[9]=d[1];b[10]=d[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1}
function Ga(a,b){b||(b=H());var c=a[0]*Math.PI/180,d=a[1]*Math.PI/180,d=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],c=[-Math.sin(c),Math.cos(c),0],e=C();fa(d,c,e);var f=Da(a);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=0;b[4]=e[0];b[5]=e[1];b[6]=e[2];b[7]=0;b[8]=d[0];b[9]=d[1];b[10]=d[2];b[11]=0;b[12]=f[0];b[13]=f[1];b[14]=f[2];b[15]=1;return b};function Ha(){this.p=C([0,0,0]);this.za=0}function Ia(a,b,c){var d=[0,0,0],e=[],f=[];E(b,d,e);E(c,d,f);fa(e,f,a.p);G(a.p);a.za=-ha(d,a.p)}Ha.prototype.j=function(a){return a[0]*this.p[0]+a[1]*this.p[1]+a[2]*this.p[2]+this.za};function Ja(){this.M=[new Ha,new Ha,new Ha,new Ha]}Ja.prototype.Db=function(a){var b=H();I(a,b);var a=va(b,[-1,-1,-1,1]),c=va(b,[-1,1,-1,1]),d=va(b,[1,1,-1,1]),b=va(b,[1,-1,-1,1]);Ia(this.M[0],a,c);Ia(this.M[1],c,d);Ia(this.M[2],d,b);Ia(this.M[3],b,a)};
function Ka(a,b,c){for(var d=0;d<b.M.length;d++){var e=b.M[d],f=e.p[0],g=e.p[1],i=e.p[2],j=e.za,e=a.M[d];e.p[0]=c[0]*f+c[1]*g+c[2]*i+c[3]*j;e.p[1]=c[4]*f+c[5]*g+c[6]*i+c[7]*j;e.p[2]=c[8]*f+c[9]*g+c[10]*i+c[11]*j;e.za=c[12]*f+c[13]*g+c[14]*i+c[15]*j}};function La(a){this.Dc=a.shadersPath||"../shaders/";this.Dd=a.tileErrorTreshold||4;this.Ga=a.lighting||v;this.jc=a.continuousRendering||v;var b=this.ac=t;if(!a.canvas)throw"GlobWeb : no canvas in options";b="string"==typeof a.canvas?document.getElementById(a.canvas):a.canvas;if(!b instanceof HTMLCanvasElement)throw"GlobWeb : invalid canvas";for(var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=t,e=0;e<c.length&&d==t;++e)try{d=b.getContext(c[e],a.contextAttribs)}catch(f){}if(d==t)throw"GlobWeb : WebGL context cannot be initialized";
a.backgroundColor?(a=a.backgroundColor,d.clearColor(a[0],a[1],a[2],a[3])):d.clearColor(0,0,0,1);d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE);d.enable(d.DEPTH_TEST);d.enable(d.CULL_FACE);this.q=H();this.na=H();this.Y=H();this.h=d;this.canvas=b;this.pc=new Ja;this.dc=new Ja;this.dd=new Ja;this.Hb=C();this.Gb=C();this.xb=1E-5;this.Za=La.xb;this.ka=6;this.V=0;this.Jb=v;this.oc=45;window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)})}function P(a){a.Jb||(window.requestAnimationFrame(a.frame),a.Jb=o)}
function Ma(a){var b=a.canvas.width,c=a.canvas.height,d=a.Y,a=a.q,e=0.5*d[0]*b,b=0.5*d[8]*b+0.5*d[11]*b,b=[a[0]*e+a[2]*b,a[4]*e+a[6]*b,a[8]*e+a[10]*b],e=0.5*d[5]*c,c=0.5*d[9]*c+0.5*d[11]*c,c=[a[1]*e+a[2]*c,a[5]*e+a[6]*c,a[9]*e+a[10]*c],e=d[11],d=[a[2]*e,a[6]*e,a[10]*e,a[14]*e+a[15]*d[15]],a=0.7071067811/Math.sqrt(ha(b,b)+ha(c,c));d[0]*=a;d[1]*=a;d[2]*=a;d[3]*=a;return d}
function Na(a,b){var c=a.h,d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);return d};function Oa(a){this.a=a;this.ob=this.w=this.ba=this.m=t;this.yc=0;this.mode=a.h.TRIANGLES}function Pa(a,b){var c=a.a.h;a.m==t&&(a.m=c.createBuffer());c.bindBuffer(c.ARRAY_BUFFER,a.m);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW);a.yc=b.length}function Qa(a,b){var c=a.a.h;a.w==t&&(a.w=c.createBuffer());c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a.w);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),c.STATIC_DRAW);a.fa=b.length}
Oa.prototype.C=function(a){var b=this.a.h;b.bindBuffer(b.ARRAY_BUFFER,this.m);b.vertexAttribPointer(a.vertex,3,b.FLOAT,v,0,0);a.hasOwnProperty("tcoord")&&(b.bindBuffer(b.ARRAY_BUFFER,this.ba),b.vertexAttribPointer(a.tcoord,2,b.FLOAT,v,0,0));a.hasOwnProperty("color")&&(b.bindBuffer(b.ARRAY_BUFFER,this.ob),b.vertexAttribPointer(a.color,4,b.FLOAT,v,0,0));this.w?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.w),b.drawElements(this.mode,this.fa,b.UNSIGNED_SHORT,0)):b.drawArrays(this.mode,0,this.yc/3)};
Oa.prototype.T=function(){var a=this.a.h;this.w&&a.deleteBuffer(this.w);this.m&&a.deleteBuffer(this.m);this.ba&&a.deleteBuffer(this.ba);this.ob&&a.deleteBuffer(this.ob);this.ob=this.ba=this.m=this.w=t};function U(a){this.a=a;this.o=t;this.attributes={};this.i={};this.V=0}U.prototype.createShader=function(a,b){var c=this.a.h,d=c.createShader(a);c.shaderSource(d,b);c.compileShader(d);return!c.getShaderParameter(d,c.COMPILE_STATUS)?(console.log("Shader compilation error: "+c.getShaderInfoLog(d)),c.deleteShader(d),t):d};
function Ra(a,b,c){var d=a.a.h,b=a.createShader(d.VERTEX_SHADER,b),c=a.createShader(d.FRAGMENT_SHADER,c);if(!(b==t||c==t))if(a.o=d.createProgram(),d.attachShader(a.o,b),d.attachShader(a.o,c),d.linkProgram(a.o),d.getProgramParameter(a.o,d.LINK_STATUS)){b=d.getProgramParameter(a.o,d.ACTIVE_ATTRIBUTES);for(c=a.V=0;c<b;++c){var e=d.getActiveAttrib(a.o,c),f=d.getAttribLocation(a.o,e.name);a.attributes[e.name]=f;f+1>a.V&&(a.V=f+1)}b=d.getProgramParameter(a.o,d.ACTIVE_UNIFORMS);for(c=0;c<b;++c)e=d.getActiveUniform(a.o,
c),a.i[e.name]=d.getUniformLocation(a.o,e.name)}else console.log("Program link error: "+d.getProgramInfoLog(a.o)),d.deleteShader(b),d.deleteShader(c),d.deleteProgram(a.o),a.o=t}function Sa(a,b,c){var d=new XMLHttpRequest;d.open("get",a.a.Dc+b,v);d.send(t);b=d.responseText;d.open("get",a.a.Dc+c,v);d.send(t);Ra(a,b,d.responseText)}
U.prototype.apply=function(){var a=this.a,b=a.h;b.useProgram(this.o);for(var c=a.V;c<this.V;c++)b.enableVertexAttribArray(c);for(c=this.V;c<a.V;c++)b.disableVertexAttribArray(c);a.V=this.V};function Ta(a,b){this.a=a;this.f=b;this.xa=t;this.Ja=[t,t,t,t];this.Ra=t;this.Ka=[t,t,t,t];this.Ad=[t,t,t,t]}Ta.prototype.reset=function(){for(var a=this.a.h,b=0;4>b;b++)this.Ja[b]&&(a.deleteBuffer(this.Ja[b]),this.Ja[b]=t);this.xa&&(a.deleteBuffer(this.xa),this.xa=t);for(b=0;4>b;b++)this.Ka[b]&&(a.deleteBuffer(this.Ka[b]),this.Ka[b]=t);this.Ra&&(a.deleteBuffer(this.Ra),this.Ra=t)};function Ua(){this.parent=t;this.$a=-1;this.m=this.N=this.b=this.children=t;this.Cd=[1,1,0,0];this.Fa=this.u=t;this.P=new oa;this.j=this.Z=0;this.ic=[0,0,0];this.v={};this.state=Va;this.f=t}var Va=0;function Wa(a,b,c){for(var d=Math.floor(c),c=c-d,e=Math.floor(b),b=b-e,f=a.f.A,g=a.f.O,d=g*(d*f+e),e=[0,0,0],i=0;3>i;i++)e[i]=(1-c)*(1-b)*a.b[d+i]+c*(1-b)*a.b[d+g*f+i]+c*b*a.b[d+g*f+g+i]+(1-c)*b*a.b[d+g+i];return e}
function Xa(a,b,c,d){a.parent=b;a.$a=2*d+c;a.u=b.u;a.Fa=b.Fa;a.N=b.N;a.f=b.f;a.m=b.m;for(var e=a.f.A,f=(e-1)/2,g=0;g<=f;g++)for(var i=a.f.O*((g+d*f)*e+c*f),j=0;j<=f;j++)a.P.extend(b.b[i],b.b[i+1],b.b[i+2]),i+=a.f.O;a.Z=pa(a.P)}
function Ya(a,b){var c=a.Fa,d=b.Hb,e=c[0]*d[0]+c[4]*d[1]+c[8]*d[2]+c[12],f=c[1]*d[0]+c[5]*d[1]+c[9]*d[2]+c[13],d=c[2]*d[0]+c[6]*d[1]+c[10]*d[2]+c[14],g=Math.sqrt(e*e+f*f+d*d);if(g<a.Z)return a.j=0,b.Za=b.xb,b.ka=Math.max(b.ka,2*a.Z),v;var i=a.ic;i[0]=Math.min(Math.max(e,a.P.min[0]),a.P.max[0]);i[1]=Math.min(Math.max(f,a.P.min[1]),a.P.max[1]);i[2]=Math.min(Math.max(d,a.P.min[2]),a.P.max[2]);var j=b.Gb,h=-(c[0]*j[0]+c[4]*j[1]+c[8]*j[2]),l=-(c[1]*j[0]+c[5]*j[1]+c[9]*j[2]),c=-(c[2]*j[0]+c[6]*j[1]+c[10]*
j[2]),j=i[0],m=i[1],k=i[2]+1,j=(h*j+l*m+c*k)/Math.sqrt(j*j+m*m+k*k);a.j=g;j*=a.f.Ta;if(-0.05>j)return o;g=b.dd;Ka(g,b.dc,a.u);a:{j=a.P;for(m=0;m<g.M.length;m++)if(k=g.M[m],0>(0<=k.p[0]?j.max[0]:j.min[0])*k.p[0]+(0<=k.p[1]?j.max[1]:j.min[1])*k.p[1]+(0<=k.p[2]?j.max[2]:j.min[2])*k.p[2]+k.za){g=v;break a}g=o}return g?(e=-(h*i[0]+l*i[1]+c*i[2]-(h*e+l*f+c*d)),b.Za=Math.max(b.xb,Math.min(b.Za,e)),b.ka=Math.max(b.ka,e+2*a.Z),v):o}
Ua.prototype.T=function(a){if(3==this.state){a.mc(this.m);a.nc(this.N);for(var b in this.v)this.v[b].T&&this.v[b].T();this.parent=this.N=this.m=t;this.state=Va}};function Za(a,b){if(a.children){for(var c=0;4>c;c++)a.children[c].T(b),Za(a.children[c],b);a.children=t}}
function $a(a,b,c,d,e){for(var f=a.b,g=0.05*a.Z,i=a.f.A,j=0;j<i;j++){var h=f[c]-b[0],l=f[c+1]-b[1],m=f[c+2]-b[2],k=g/Math.sqrt(h*h+l*l+m*m),h=h*k,l=l*k,m=m*k;f[e]=f[c]-h;f[e+1]=f[c+1]-l;f[e+2]=f[c+2]-m;for(h=3;h<a.f.O;h++)f[e+h]=f[c+h];e+=a.f.O;c+=d}}
Ua.prototype.Va=function(a,b,c){this.b=this.rc(c);var c=this.f.A,d=this.f.O;this.P.Db(this.b,d*c*c,d);this.Z=pa(this.P);if(this.f.xc)for(var e=this.f.A,f=this.f.O,g=f*e,i=0,j=0;j<e;j++)for(var h=j==e-1?0:g,l=0==j?0:-g,m=0;m<e;m++){var k=m==e-1?0:f,n=0==m?0:-f,k=fa([this.b[i+k]-this.b[i+n],this.b[i+k+1]-this.b[i+n+1],this.b[i+k+2]-this.b[i+n+2]],[this.b[i+h]-this.b[i+l],this.b[i+h+1]-this.b[i+l+1],this.b[i+h+2]-this.b[i+l+2]],[]);G(k);this.b[i+3]=k[0];this.b[i+4]=k[1];this.b[i+5]=k[2];i+=f}this.f.Ia&&
(e=[0,0,0],ja(this.Fa,e),f=d*c*c,$a(this,e,0,d,f),f+=d*c,$a(this,e,d*c*(c-1),d,f),f+=d*c,$a(this,e,0,d*c,f),f+=d*c,$a(this,e,d*(c-1),d*c,f),f+=d*c,$a(this,e,d*(c*(c-1)/2),d,f),$a(this,e,d*((c-1)/2),d*c,f+d*c));this.m!=t&&this.parent==t&&a.mc(this.m);this.m=a.Mc(this.b);b&&(this.N=a.Nc(b));this.state=3};function ab(a){var b=a.h,c=[],d=[],e=this;this.hd=this.gd=0;this.Nc=function(a){if(0<c.length){var d=c.pop();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.RGB,b.RGB,b.UNSIGNED_BYTE,a);b.generateMipmap(b.TEXTURE_2D);e.hd++}else d=b.createTexture(),b.bindTexture(b.TEXTURE_2D,d),b.texImage2D(b.TEXTURE_2D,0,b.RGB,b.RGB,b.UNSIGNED_BYTE,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.generateMipmap(b.TEXTURE_2D),e.gd++;return a=d};this.Mc=function(a){var c;c=0<d.length?d.pop():b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,a,b.STATIC_DRAW);return c};this.nc=function(a){c.push(a)};this.mc=function(a){d.push(a)};this.Oc=function(){for(var a=0;a<c.length;a++)b.deleteTexture(c[a]);for(a=c.length=0;a<d.length;a++)b.deleteBuffer(d[a]);d.length=0}};function bb(a){function b(){P(a)}this.a=a;this.ha=new ab(a);this.Ba=this.Q=t;this.pa=[];this.Ma=[];this.X=[];this.H=[];this.ma=t;this.La=[];for(var c=0;4>c;c++)this.La[c]=new cb(b);this.va=v;this.K={A:9,Ia:o,Ta:1,uc:256,O:a.Ga?6:3,xc:a.Ga};this.ba=t;this.ib=new Ta(this.a,this.K);this.Zc=[1,1,0,0];this.freeze=this.Ec=v;this.da=this.jd=0;c="\tattribute vec3 vertex;\n\tattribute vec2 tcoord;\n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 projectionMatrix;\n\tuniform vec4 texTransform;\n\tvarying vec2 texCoord;\n";
a.Ga&&(c+="attribute vec3 normal;\nvarying vec3 color;\n");c+="\tvoid main(void) \n\t{\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n";a.Ga&&(c+="vec4 vn = modelViewMatrix * vec4(normal,0);\ncolor = max( vec3(-vn[2],-vn[2],-vn[2]), 0.0 );\n");var d="\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\t\n\tvarying vec2 texCoord;\n";a.Ga&&(d+="varying vec3 color;\n");d+="\tuniform sampler2D colorTexture;\n\tuniform int wireframe;\n\t\n\tvoid main(void)\n\t{\n\t\tif(wireframe == 1)\n\t\t\tgl_FragColor.rgb = vec3(1.0,1.0,1.0);\n\t\telse {\n\t\t\tgl_FragColor.rgb = texture2D(colorTexture, texCoord).rgb;\n";
a.Ga&&(d+="gl_FragColor.rgb *= color;\n");this.k=new U(this.a);Ra(this.k,c+"\t\ttexCoord = vec2(tcoord.s * texTransform.x + texTransform.z, tcoord.t * texTransform.y + texTransform.w);\n\t}\n\t",d+"\t\t}\n\t\tgl_FragColor.a = 1.0;\n\t}\n\t")}bb.prototype.reset=function(){for(var a=0;a<this.H.length;a++)Za(this.H[a],this.ha),this.H[a].T(this.ha);a=this.a.h;this.ib.reset();a.deleteBuffer(this.ba);this.ma=this.ba=t;this.va=v};
function db(a,b,c){a.kd++;b.da=a.da;b.state==Va&&(b.state=1,a.Ma.push(b));var d;if(d=3==b.state)if(d=c+1<a.Q.Ha)if(d=a.a,b.j<b.Z)d=o;else{var e=b.u,f=b.ic,g=d.ld;d=b.Z/b.f.uc/((e[0]*f[0]+e[4]*f[1]+e[8]*f[2]+e[12])*g[0]+(e[1]*f[0]+e[5]*f[1]+e[9]*f[2]+e[13])*g[1]+(e[2]*f[0]+e[6]*f[1]+e[10]*f[2]+e[14])*g[2]+g[3])>d.Dd}if(d){b.children==t&&b.lc();for(d=0;4>d;d++)Ya(b.children[d],a.a)?Za(b.children[d],a.ha):db(a,b.children[d],c+1)}else a.pa.push(b)}
bb.prototype.C=function(){if(this.Q!=t&&this.Q.Xb){this.ma==t&&this.Q.cd&&(this.ma=Na(this.a,this.Q.cd));var a=this.a.ac;if(!this.freeze){a&&a.start("traverseTime");this.pa.length=0;this.kd=this.Ma.length=0;this.a.Za=1E10;this.a.ka=-1;if(!this.va&&!this.ma){this.va=o;for(var b=0;b<this.H.length;b++){var c=this.H[b],d=3==c.state;c.da=this.da;this.va=this.va&&d;!d&&c.state==Va&&(c.state=1,this.Ma.push(c))}}if(this.va||this.ma)for(b=0;b<this.H.length;b++)c=this.H[b],Ya(c,this.a)?(d=3==c.state,this.ma&&
d&&(this.ha.nc(c.N),c.N=t,c.state=Va),Za(c,this.ha)):db(this,c,0);a&&a.end("traverseTime")}if(this.va||this.ma){a&&a.start("renderTime");b=this.a;c=this.a.h;c.enable(c.POLYGON_OFFSET_FILL);c.polygonOffset(0,4);c.disable(c.CULL_FACE);this.k.apply();d=this.k.attributes;ma(b.oc,b.canvas.width/b.canvas.height,b.Za,b.ka,b.Y);c.activeTexture(c.TEXTURE0);c.uniformMatrix4fv(this.k.i.projectionMatrix,v,b.Y);c.uniform1i(this.k.i.colorTexture,0);if(!this.ba){var e=this.K.A,f=this.K.Ia,g=2*e*e;f&&(g+=12*e);for(var g=
new Float32Array(g),i=1/(e-1),j=0,h=0,l=0;l<e;l++){for(var m=0,k=0;k<e;k++)g[j]=m,g[j+1]=h,j+=2,m+=i;h+=i}if(f){for(k=h=m=0;k<e;k++)g[j]=m,g[j+1]=h,m+=i,j+=2;m=0;h=1;for(k=0;k<e;k++)g[j]=m,g[j+1]=h,m+=i,j+=2;for(k=h=m=0;k<e;k++)g[j]=m,g[j+1]=h,h+=i,j+=2;m=1;for(k=h=0;k<e;k++)g[j]=m,g[j+1]=h,h+=i,j+=2;m=0;h=0.5;for(k=0;k<e;k++)g[j]=m,g[j+1]=h,m+=i,j+=2;m=0.5;for(k=h=0;k<e;k++)g[j]=m,g[j+1]=h,h+=i,j+=2}e=this.a.h;f=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,f);e.bufferData(e.ARRAY_BUFFER,g,e.STATIC_DRAW);
this.ba=f}c.bindBuffer(c.ARRAY_BUFFER,this.ba);c.vertexAttribPointer(d.tcoord,2,c.FLOAT,v,0,0);e=g=t;for(f=0;f<this.pa.length;f++){i=this.pa[f];j=3==i.state;h=-1==i.$a;!j&&h?(c.bindTexture(c.TEXTURE_2D,this.ma),l=i.Cd):(c.bindTexture(c.TEXTURE_2D,i.N),l=this.Zc);e!=l&&(c.uniform4f(this.k.i.texTransform,l[0],l[1],l[2],l[3]),e=l);ia(b.q,i.u,b.na);c.uniformMatrix4fv(this.k.i.modelViewMatrix,v,b.na);c.bindBuffer(c.ARRAY_BUFFER,i.m);c.vertexAttribPointer(d.vertex,3,c.FLOAT,v,4*this.K.O,0);this.K.xc&&c.vertexAttribPointer(d.normal,
3,c.FLOAT,v,4*this.K.O,12);if(this.Ec){if(j||h){l=this.ib;if(l.Ra==t){for(var k=l.f.A,m=[],n=0;n<k;n++)for(var p=0;p<k-1;p++)m.push(n*k+p),m.push(n*k+p+1);for(n=0;n<k;n++)for(p=0;p<k-1;p++)m.push(p*k+n),m.push((p+1)*k+n);k=l.a.h;n=k.createBuffer();k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n);k.bufferData(k.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),k.STATIC_DRAW);l.fa=m.length;n.fa=m.length;l.Ra=n}l=l.Ra}else{l=this.ib;m=i.$a;if(l.Ka[m]==t){for(var n=m%2,p=Math.floor(m/2),q=l.f.A,r=(q-1)/2,k=[],s=r*p;s<r*
(p+1)+1;s++)for(var u=r*n;u<r*(n+1);u++)k.push(s*q+u),k.push(s*q+u+1);for(s=r*n;s<r*(n+1)+1;s++)for(u=r*p;u<r*(p+1);u++)k.push(u*q+s),k.push((u+1)*q+s);n=l.a.h;p=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,p);n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(k),n.STATIC_DRAW);p.fa=k.length;l.Ka[m]=p}l=l.Ka[m]}g!=l&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,l),g=l);c.uniform1i(this.k.i.wireframe,1);c.drawElements(c.LINES,g.fa,c.UNSIGNED_SHORT,0);c.uniform1i(this.k.i.wireframe,0)}if(j||h){i=this.ib;
if(i.xa==t){h=i.f.A;j=[];for(l=0;l<h-1;l++)for(m=0;m<h-1;m++)j.push(l*h+m),j.push((l+1)*h+m),j.push(l*h+m+1),j.push(l*h+m+1),j.push((l+1)*h+m),j.push((l+1)*h+m+1);if(i.f.Ia){k=h*h;for(m=0;m<h-1;m++)j.push(k+m),j.push(m),j.push(k+m+1),j.push(k+m+1),j.push(m),j.push(m+1);k+=h;for(m=0;m<h-1;m++)j.push((h-1)*h+m),j.push(k+m),j.push((h-1)*h+m+1),j.push((h-1)*h+m+1),j.push(k+m),j.push(k+m+1);k+=h;for(l=0;l<h-1;l++)j.push(k+l),j.push(k+l+1),j.push(l*h),j.push(l*h),j.push(k+l+1),j.push((l+1)*h);k+=h;for(l=
0;l<h-1;l++)j.push(l*h+h-1),j.push((l+1)*h+h-1),j.push(k+l),j.push(k+l),j.push((l+1)*h+h-1),j.push(k+l+1)}h=i.a.h;l=h.createBuffer();h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l);h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),h.STATIC_DRAW);i.fa=j.length;i.xa=l;i.xa.fa=j.length}i=i.xa}else{j=this.ib;i=i.$a;if(j.Ja[i]==t){l=i%2;m=Math.floor(i/2);k=j.f.A;n=(k-1)/2;h=[];for(p=n*m;p<n*(m+1);p++)for(q=n*l;q<n*(l+1);q++)h.push(p*k+q),h.push((p+1)*k+q),h.push(p*k+q+1),h.push(p*k+q+1),h.push((p+1)*k+q),
h.push((p+1)*k+q+1);j.Ad[i]=h;if(j.f.Ia){r=0==m?k*k:k*k+4*k;s=0==m?0:n*k;for(p=n*l;p<n*(l+1);p++)h.push(r+p),h.push(s+p),h.push(r+p+1),h.push(r+p+1),h.push(s+p),h.push(s+p+1);r=0==m?k*k+4*k:k*k+k;s=0==m?n*k:(k-1)*k;for(p=n*l;p<n*(l+1);p++)h.push(s+p),h.push(r+p),h.push(s+p+1),h.push(s+p+1),h.push(r+p),h.push(r+p+1);r=0==l?k*k+2*k:k*k+5*k;s=0==l?0:n;for(q=n*m;q<n*(m+1);q++)h.push(r+q),h.push(r+q+1),h.push(s+q*k),h.push(s+q*k),h.push(r+q+1),h.push(s+(q+1)*k);r=0==l?k*k+5*k:k*k+3*k;s=0==l?n:k-1;for(q=
n*m;q<n*(m+1);q++)h.push(q*k+s),h.push((q+1)*k+s),h.push(r+q),h.push(r+q),h.push((q+1)*k+s),h.push(r+q+1)}l=j.a.h;m=l.createBuffer();l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,m);l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),l.STATIC_DRAW);m.fa=h.length;j.Ja[i]=m}i=j.Ja[i]}l=i;g!=l&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,l),g=l);c.drawElements(c.TRIANGLES,g.fa,c.UNSIGNED_SHORT,0)}for(f=0;f<this.X.length;f++)this.X[f].fd&&this.X[f].C(this.pa);c.disable(c.POLYGON_OFFSET_FILL);for(f=0;f<this.X.length;f++)this.X[f].fd||
this.X[f].C(this.pa);a&&a.end("renderTime")}a&&a.start("generateTime");for(b=0;b<this.La.length;b++)if(c=this.La[b],(d=c.hb)&&c.Bb){if(d.da==this.da){this.Ba?d.Va(this.ha,c.sa,this.Ba.Cc(c.Pc)):d.Va(this.ha,c.sa);for(b=0;b<this.X.length;b++)this.X[b].Va&&this.X[b].Va(d);this.jd++;P(this.a)}else d.state=Va;c.hb=t}else d&&c.Ib&&(d.state=-10,c.hb=t);a&&a.end("generateTime");a&&a.start("requestTime");this.Ma.sort(function(a,b){return a.j-b.j});b=this.Ma.length;for(c=0;c<b;c++)if(d=this.Ma[c],d.da==this.da){e=
t;for(g=0;g<this.La.length;g++)if(!this.La[g].hb){e=this.La[g];break}e?(e.hb=d,g=t,this.Ba&&(g=this.Ba.Wa(d)),f=this.Q.Wa(d),e.Bb=v,e.Ib=v,e.Pb=v,e.sa.src=f,g&&(e.Eb=v,e.Sa.open("GET",g),e.Sa.send()),d.state=2):d.state=Va}else d.state=Va;a&&a.end("requestTime");this.da++}};function V(a){this.R=-1;this.Na=t;this.Ha=-1;this.name=a&&a.hasOwnProperty("name")?a.name:"";this.Sd=a&&a.hasOwnProperty("overlay")?a.overlay:v;this.Xb=o;this.c=t}V.prototype.kb=function(a){this.c=a};V.prototype.lb=function(){this.c=t};function cb(a){this.Ib=this.Bb=v;this.hb=t;this.Pb=v;this.Eb=o;this.gc=a;var b=this;this.sa=new Image;this.sa.crossOrigin="";this.sa.onload=function(){b.Pb=o;b.Eb&&(b.Bb=o,b.gc())};this.sa.onerror=function(){console.log("Error while loading "+b.sa.src);b.Ib=o};this.Sa=new XMLHttpRequest;this.Sa.onreadystatechange=function(){4==b.Sa.readyState&&200==b.Sa.status&&(b.Pc=b.Sa.responseText,b.Eb=o,b.Pb&&(b.Bb=o,b.gc()))}};function W(a){this.a=new La(a);this.l=new bb(this.a);this.l.Ec=a.showWireframe;this.Qa=new eb(this);this.Ub=[];this.qa=[];var b=this;this.a.frame=function(){b.a.Jb=v;b.C();b.a.jc?P(b.a):0<b.qa.length&&P(b.a)};P(this.a);a.atmosphere&&(this.mb=new fb(this.a))}w=W.prototype;w.T=function(){this.l.ha.Oc();this.l.Td()};w.refresh=function(){P(this.a)};w.vd=function(a){this.l.Q&&this.l.Q.lb();var b=this.l;b.reset();if(b.Q=a)b.K.uc=a.R,b.H=a.Na.qc(b.K,b.ha);a&&a.kb(this);P(this.a)};
w.ud=function(a){this.l.Ba&&this.l.Q.lb();var b=this.l;b.reset();b.Ba=a;b.K.A=a?a.R:9;a&&a.kb(this);P(this.a)};w.Kc=function(a){this.Ub.push(a);a.kb(this);P(this.a)};w.qd=function(a){var b=this.Ub.indexOf(a);-1!=b&&(this.Ub.splice(b,1),a.lb())};w.Ca=function(a,b){var c=this.l.H[this.l.Q.Na.wc(a,b)];return 3==c.state?c.Ca(a,b):0};
w.Xc=function(){var a=this.a,b=H();I(a.q,b);var c=[b[12],b[13],b[14]];ia(a.Y,a.q,b);I(b);for(var a=[[-1,-1,1,1],[1,-1,1,1],[-1,1,1,1],[1,1,1,1]],d=C(),e=[0,0,0],f=0;4>f;f++){ka(b,a[f]);F(a[f],1/a[f][3]);E(a[f],c,a[f]);G(a[f]);var g=ua(c,a[f],e);if(0>g)return t;a[f]=Ea(sa(c,a[f],g,d))}b=new K;b.r=a[0][0];b.G=a[0][0];b.J=a[0][1];b.s=a[0][1];for(c=1;c<a.length;c++)b.r=Math.min(b.r,a[c][0]),b.G=Math.max(b.G,a[c][0]),b.J=Math.min(b.J,a[c][1]),b.s=Math.max(b.s,a[c][1]);return b};
w.sc=function(a,b){var c,d=this.a,e=2*(a/d.canvas.width)-1,f=-(2*(b/d.canvas.height)-1),g=H();ia(d.Y,d.q,g);I(g);c=[];ka(g,[e,f,0,1],c);c[0]/=c[3];c[1]/=c[3];c[2]/=c[3];I(d.q,g);d=[g[12],g[13],g[14]];e=C();E(c,d,e);G(e);c=ua(d,e,[0,0,0]);c=0<=c?sa(d,e,c):t;if(c==t)return t;d=[];Ea(c,d);return d};
w.C=function(){var a=this.a,b=a.ac,c=a.h;b&&b.start("globalRenderTime");if(0<this.qa.length)for(var d=Date.now(),e=0;e<this.qa.length;e++)this.qa[e].update(d);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);if(!(0==a.canvas.width||0==a.canvas.height)){c.viewport(0,0,a.canvas.width,a.canvas.height);c=H();I(a.q,c);da([0,0,0],a.Hb);ja(c,a.Hb);da([0,0,-1],a.Gb);var f=a.Gb,g;g||(g=f);d=f[0];e=f[1];f=f[2];g[0]=c[0]*d+c[4]*e+c[8]*f;g[1]=c[1]*d+c[5]*e+c[9]*f;g[2]=c[2]*d+c[6]*e+c[10]*f;a.ld=Ma(a);ma(a.oc,a.canvas.width/
a.canvas.height,a.xb,a.ka,a.Y);a.pc.Db(a.Y);Ka(a.dc,a.pc,a.q);if(this.mb&&(a=this.mb,g=this.l,a.tb)){var c=a.a.h,i=a.a.q,d=i[12],e=i[13],f=i[14],i=[-(i[0]*d+i[1]*e+i[2]*f),-(i[4]*d+i[5]*e+i[6]*f),-(i[8]*d+i[9]*e+i[10]*f)],j=ga(i);a.ga=j<a.W?a.cb:a.eb;a.la=j<a.W?a.Xa:a.Ya;a.ga.apply();c.uniform3f(a.ga.i.v3CameraPos,i[0],i[1],i[2]);c.uniform1f(a.ga.i.fCameraHeight2,j*j);c.uniform1f(a.ga.i.fCameraHeight,j);a.la.apply();d=[0,0,0];ja(a.a.q,d);c.uniform3f(a.la.i.earthCenter,d[0],d[1],d[2]);var h=[1,1,1];
G(h);var d=h[0],e=h[1],f=h[2],l=a.a.q;h[0]=l[0]*d+l[4]*e+l[8]*f;h[1]=l[1]*d+l[5]*e+l[9]*f;h[2]=l[2]*d+l[6]*e+l[10]*f;c.uniform3f(a.la.i.lightDir,h[0],h[1],h[2]);c.uniform3f(a.la.i.v3CameraPos,i[0],i[1],i[2]);c.uniform1f(a.la.i.fCameraHeight2,j*j);c.uniform1f(a.la.i.fCameraHeight,j);g.k=a.la;a.a.ka=3}this.l.C();0!=this.l.pa.length&&(this.mb&&this.mb.C(),b&&b.end("globalRenderTime"))}};function X(a,b,c,d){O.prototype.constructor.call(this);this.speed=b*Q/1E3;this.d=[];for(b=0;b<a.length;b++){var e={position:Da(a[b]),S:t,j:0};this.d.push(e);if(0<b){var e=this.d[b].position[0]-this.d[b-1].position[0],f=this.d[b].position[1]-this.d[b-1].position[1],g=this.d[b].position[2]-this.d[b-1].position[2];this.d[b-1].j=Math.sqrt(e*e+f*f+g*g)}}for(b=1;b<a.length-1;b++)e=E(this.d[b+1].position,this.d[b].position,C()),f=E(this.d[b-1].position,this.d[b].position,C()),G(e),G(f),this.d[b].S=E(e,f,
C()),G(this.d[b].S);e=E(this.d[1].position,this.d[0].position,C());F(e,3/this.d[0].j);this.d[0].S=E(e,this.d[1].S,C());F(this.d[0].S,0.5);b=a.length-1;e=E(this.d[b].position,this.d[b-1].position,C());F(e,3/this.d[b-1].j);this.d[b].S=E(e,this.d[b-1].S,C());F(this.d[b].S,0.5);this.c=d;this.ra=this.index=0;this.bb=-1;this.Md=[];this.hc=-0.2;this.ec=1E3;var i=this;this.Oa=c?c:function(a,b){var c=G(a,C()),d=Ea(a);d[2]=i.c.Ca(d[0],d[1])+i.ec;var e=Da(d),d=G(b,C()),f=ea(e,d,C());ea(f,F(c,i.hc,C()));(d=La.q)||
(d=H());var g=e[0],q=e[1],e=e[2],r=c[0],s=c[1],u=c[2],c=f[1],x=f[2];if(g==f[0]&&q==c&&e==x)d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0;else{var z,A,y,B,c=g-f[0],x=q-f[1],f=e-f[2];B=1/Math.sqrt(c*c+x*x+f*f);c*=B;x*=B;f*=B;z=s*f-u*x;u=u*c-r*f;r=r*x-s*c;(B=Math.sqrt(z*z+u*u+r*r))?(B=1/B,z*=B,u*=B,r*=B):r=u=z=0;s=x*r-f*u;A=f*z-c*r;y=c*u-x*z;(B=Math.sqrt(s*s+A*A+y*y))?(B=1/B,s*=B,A*=B,y*=B):y=A=s=0;d[0]=z;d[1]=s;d[2]=c;d[3]=0;d[4]=u;d[5]=
A;d[6]=x;d[7]=0;d[8]=r;d[9]=y;d[10]=f;d[11]=0;d[12]=-(z*g+u*q+r*e);d[13]=-(s*g+A*q+y*e);d[14]=-(c*g+x*q+f*e)}d[15]=1}}J(O,X);w=X.prototype;w.xd=function(a){this.speed=parseFloat(a)*Q/1E3};w.td=function(a){this.ec=parseFloat(a)};w.wd=function(a){this.hc=Math.tan(parseFloat(a)*Math.PI/180)};w.start=function(){var a=-1;this.state==O.Ld.Kd&&(a=this.startTime);O.prototype.start.call(this);this.bb=-1!=a?this.bb+(this.startTime-a):-1};
w.update=function(a){-1==this.bb?this.ra=this.index=0:this.ra+=(a-this.bb)*this.speed;for(this.bb=a;this.ra>=this.d[this.index].j&&this.index<this.d.length-1;)this.ra-=this.d[this.index].j,this.index+=1;if(this.index<this.d.length-1){var a=this.ra/this.d[this.index].j,b=this.d[this.index].position,c=this.d[this.index+1].position,d=F(this.d[this.index].S,this.d[this.index].j,C()),e=F(this.d[this.index+1].S,this.d[this.index].j,C()),f=a*a,g=f*a,i=2*b[0]-2*c[0]+d[0]+e[0],j=2*b[1]-2*c[1]+d[1]+e[1],h=
2*b[2]-2*c[2]+d[2]+e[2],l=-3*b[0]+3*c[0]-2*d[0]-e[0],m=-3*b[1]+3*c[1]-2*d[1]-e[1],k=-3*b[2]+3*c[2]-2*d[2]-e[2],n=C();n[0]=i*g+l*f+d[0]*a+b[0];n[1]=j*g+m*f+d[1]*a+b[1];n[2]=h*g+k*f+d[2]*a+b[2];f=a*a;g=6*b[0]-6*c[0]+3*d[0]+3*e[0];i=6*b[1]-6*c[1]+3*d[1]+3*e[1];j=6*b[2]-6*c[2]+3*d[2]+3*e[2];h=-6*b[0]+6*c[0]-4*d[0]-2*e[0];l=-6*b[1]+6*c[1]-4*d[1]-2*e[1];b=-6*b[2]+6*c[2]-4*d[2]-2*e[2];c=C();c[0]=g*f+h*a+d[0];c[1]=i*f+l*a+d[1];c[2]=j*f+b*a+d[2];this.Oa(n,c)}else this.index==this.d.length-1?this.Oa(this.d[this.index].position,
this.d[this.index].S):this.stop()};function gb(){var a={Id:o};this.navigation=t;this.Tb=this.Sb=this.pd=this.od=this.ab=-1;for(var b in a)this[b]=a[b]}function hb(a,b){ib(a.navigation,"start");void 0===b.wheelDelta?a.navigation.zoom(b.detail):a.navigation.zoom(-b.wheelDelta/120);b.preventDefault&&b.preventDefault();b.returnValue=v;ib(a.navigation,"end");P(a.navigation.c.a)};function eb(a){this.c=a;this.Ua=[];for(a=0;a<jb.length;a++)this.Ua.push({pb:jb[a].pb,nb:jb[a].nb,Ea:t})}var jb=[];eb.prototype.D=function(a,b){for(var c=a.geometry.type,d=0;d<this.Ua.length;d++){var e=this.Ua[d];e.nb(c,b)&&(e.Ea||(e.Ea=e.pb(this.c),this.c.l.X.push(e.Ea)),e.Ea.D(a,b))}};eb.prototype.$=function(a){for(var b=0;b<this.Ua.length;b++){var c=this.Ua[b];c.Ea&&c.Ea.$(a)}};var kb,lb=t;kb={Sc:function(a,b){lb||(lb=document.createElement("canvas"),lb.width=512,lb.height=20);b||(b="#fff");var c=lb.getContext("2d");c.clearRect(0,0,lb.width,lb.height);c.fillStyle=b;c.font="18px sans-serif";c.textBaseline="top";c.shadowColor="#000";c.shadowOffsetX=1;c.shadowOffsetY=1;c.shadowBlur=2;c.fillText(a,1,1);var d=c.measureText(a);return c.getImageData(0,0,Math.floor(d.width)+2,lb.height)}};
function mb(a){this.a=a.a;this.K=a.K;this.n=[];this.zc=0;this.k=new U(this.a);Ra(this.k,"\tattribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \n\tuniform mat4 viewProjectionMatrix; \n\tuniform vec3 poiPosition; // world position \n\tuniform vec2 poiScale; // x,y scale \n\tuniform vec2 tst; \n\t\n\tvarying vec2 texCoord; \n\t\n\tvoid main(void)  \n\t{ \n\t\t// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n\t\ttexCoord = vertex.xy + vec2(0.5) + tst; \n\t\t// Invert y \n\t\ttexCoord.y = 1.0 - texCoord.y; \n\t\t\n\t\t// Compute poi position in clip coordinate \n\t\tgl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n\t\tgl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n\t} \n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\t\n\tvarying vec2 texCoord; \n\tuniform sampler2D texture; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = texture2D(texture, texCoord); \n\t} \n\t");
this.wa=new Oa(this.a);Pa(this.wa,[-0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0,0.5,-0.5,0]);Qa(this.wa,[0,3,1,1,3,2])}function nb(a,b,c){b.N=Na(a.a,c);b.Hc=c.width;b.bc=c.height}mb.prototype.D=function(a,b){if(b){var c=this.Mb(b);if(b.label){var d=kb.Sc(a.properties.name,a.properties.textColor);nb(this,c,d)}var d=Da(a.geometry.coordinates),e=C();G(d,e);c.oa.push({nd:d,Hd:e,rb:a})}};
mb.prototype.$=function(a){for(var b=0;b<this.n.length;b++)for(var c=this.n[b],d=0;d<c.oa.length;d++)if(c.oa[d].rb==a){c.oa.splice(d,1);return}};mb.prototype.Mb=function(a){if(!a.label)for(var b=0;b<this.n.length;b++){var c=this.n[b];if(c.style.sb==a.sb&&c.style.Ob==a.Ob&&c.style.label==c.style.label)return c}c={N:t,oa:[],style:a};if(a.iconUrl){var d=new Image,e=this;d.onload=function(){nb(e,c,d)};d.src=a.sb}else a.icon&&nb(this,c,a.Ob);this.n.push(c);return c};
mb.prototype.C=function(){if(0!=this.n.length){this.zc=0;var a=this.a,b=this.a.h;b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.k.apply();ia(a.Y,a.q,a.na);b.uniformMatrix4fv(this.k.i.viewProjectionMatrix,v,a.na);b.uniform1i(this.k.i.texture,0);I(a.q,a.na);var c=[a.na[8],a.na[9],a.na[10]];G(c);F(c,this.K.Ta,c);for(var d=Ma(a),e=0;e<this.n.length;e++){var f=this.n[e];if(!(f.N==t||0==f.oa.length)){b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,
f.N);var g=[2*f.Hc/a.canvas.width,2*f.bc/a.canvas.height];b.uniform2fv(this.k.i.poiScale,g);b.uniform2fv(this.k.i.tst,[0.5/f.Hc,0.5/f.bc]);for(var i=0;i<f.oa.length;++i){var j=f.oa[i].nd,h=f.oa[i].Hd,g=f.bc*(d[0]*j[0]+d[1]*j[1]+d[2]*j[2]+d[3]),g=g*this.K.Ta,l;if(l=!(0.001*(g/Q)>f.style.md))if(l=0<ha(h,c)){a:{l=a.dc;for(var m=1,k=0;k<l.M.length;k++){var n=l.M[k].p,n=j[0]*n[0]+j[1]*n[1]+j[2]*n[2]+l.M[k].za;if(n<=g){if(n<-g){l=-1;break a}m=0}}l=m}l=0<=l}l&&(b.uniform3f(this.k.i.poiPosition,h[0]*g+j[0],
h[1]*g+j[1],h[2]*g+j[2]),this.wa.C(this.k.attributes),this.zc++)}}}b.disable(b.BLEND)}};jb.push({pb:function(a){return new mb(a.l)},nb:function(a){return"Point"==a}});function ob(){this.strokeColor=[1,0,0,1];this.fillColor=[1,0,0,1];this.gb=1;this.sb="hotspot.png";this.label=this.Ob=t;this.fill=v;this.md=40}function pb(a){"#"==a.charAt(0)&&(a=a.substring(1,9));var b=[];b[3]=parseInt(a.substring(0,2),16)/255;b[2]=parseInt(a.substring(2,4),16)/255;b[1]=parseInt(a.substring(4,6),16)/255;b[0]=parseInt(a.substring(6,8),16)/255;return b};function qb(a,b){this.h=b;this.style=a;this.w=this.m=t;this.b=[];this.z=[];this.U=[];this.qb=this.Aa=o;this.ja=this.B=t;this.Nb=-1}w=qb.prototype;w.fc=function(){this.ja=[[],[],[],[]];this.B=[t,t,t,t]};
w.$=function(a){for(var b=-1,c=0;c<this.U.length;c++){var d=this.U[c];if(d.rb==a){this.b.splice(d.Ab,d.jb);this.z.splice(d.fb,d.Qb);a=d.jb/3;for(d=d.fb;d<this.z.length;d++)this.z[d]-=a;b=c;break}}if(0<=b){this.qb=this.Aa=o;for(c=b+1;c<this.U.length;c++)d=this.U[c],d.Ab-=this.U[b].jb,d.fb-=this.U[b].Qb;this.U.splice(b,1);rb(this);this.ja=t;return o}return v};
w.D=function(a,b){var c=t,d=v;a._crossDateLine&&0>b.e.r&&(d=o);var e=a.geometry;"Polygon"==e.type?(c=d?e._negCoordinates[0]:e.coordinates[0],(c[0][0]!=c[c.length-1][0]||c[0][1]!=c[c.length-1][1])&&c.push(c[0])):"LineString"==e.type&&(c=d?e._negCoordinates:e.coordinates);if(c!=t){for(var d={rb:a,Ab:this.b.length,fb:this.z.length,jb:0,Qb:0},e=b.e.G-b.e.r,f=b.e.J-b.e.s,g=b.f.A,i=b.f.O,j=0;j<c.length-1;j++){for(var h=(g-1)*(c[j][0]-b.e.r)/e,l=(g-1)*(c[j][1]-b.e.s)/f,m=(g-1)*(c[j+1][0]-b.e.r)/e,k=(g-1)*
(c[j+1][1]-b.e.s)/f,n=Math.max(-1,Math.min(h,m)),p=Math.min(g-1,Math.max(h,m)),q=Math.max(-1,Math.min(l,k)),r=Math.min(g-1,Math.max(l,k)),s=[],n=Math.floor(n)+1;n<Math.floor(p)+1;n++){var u=n,x=ta(h,l,m,k,u,0,u,g-1);if(0<x[0]&&1>x[0]&&0<x[1]&&1>x[1]){var z=x[1]*(g-1),u=Math.floor(z),A=z-u,y=i*(u*g+n),u=(1-A)*b.b[y]+A*b.b[y+i*g],z=(1-A)*b.b[y+1]+A*b.b[y+i*g+1],A=(1-A)*b.b[y+2]+A*b.b[y+i*g+2];s.push([x[0],u,z,A])}}for(n=Math.floor(q)+1;n<Math.floor(r)+1;n++)z=n,x=ta(h,l,m,k,0,z,g-1,z),0<x[0]&&(1>x[0]&&
0<x[1]&&1>x[1])&&(u=x[1]*(g-1),q=Math.floor(u),p=u-q,y=i*(n*g+q),u=(1-p)*b.b[y]+p*b.b[y+i],z=(1-p)*b.b[y+1]+p*b.b[y+i+1],A=(1-p)*b.b[y+2]+p*b.b[y+i+2],s.push([x[0],u,z,A]));s.sort(function(a,b){return a[0]>b[0]});r=this.b.length/3;0<h&&(h<g-1&&0<l&&l<g-1)&&(h=Wa(b,h,l),this.b.push(h[0]),this.b.push(h[1]),this.b.push(h[2]));for(n=0;n<s.length;n++)this.b.push(s[n][1]),this.b.push(s[n][2]),this.b.push(s[n][3]);0<m&&(m<g-1&&0<k&&k<g-1)&&(h=Wa(b,m,k),this.b.push(h[0]),this.b.push(h[1]),this.b.push(h[2]));
m=this.b.length/3;for(n=r;n<m-1;n++)this.z.push(n),this.z.push(n+1)}d.jb=this.b.length-d.Ab;d.Qb=this.z.length-d.fb;return 0<d.jb?(this.U.push(d),this.qb=this.Aa=o,rb(this),this.ja=t,o):v}};function rb(a){var b=a.h;a.B&&(a.B[0]&&b.deleteBuffer(a.B[0]),a.B[1]&&b.deleteBuffer(a.B[1]),a.B[2]&&b.deleteBuffer(a.B[2]),a.B[3]&&b.deleteBuffer(a.B[3]));a.B=t}w.T=function(){var a=this.h;this.w&&a.deleteBuffer(this.w);this.m&&a.deleteBuffer(this.m);rb(this);this.m=this.w=t};
w.C=function(a){var b=this.h;this.m==t&&(this.m=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.m);this.Aa&&(b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.b),b.STATIC_DRAW),this.Aa=v);b.vertexAttribPointer(a.vertex,3,b.FLOAT,v,0,0);this.w==t&&(this.w=b.createBuffer());b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.w);this.qb&&(b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.z),b.STATIC_DRAW),this.qb=v);b.drawElements(this.Nb,this.z.length,b.UNSIGNED_SHORT,0)};function sb(a,b){qb.prototype.constructor.call(this,a,b);this.Nb=b.LINES}J(qb,sb);sb.prototype.fc=function(){this.ja=[[],[],[],[]];this.B=[t,t,t,t];for(var a=0;a<this.z.length/2;a++){var b=3*this.z[2*a],c=3*this.z[2*a+1],d=this.b[b],e=this.b[c],f=0;if(0<d||0==d&&0<e)f=1;b=this.b[b+1];c=this.b[c+1];d=1;if(0<b||0==b&&0<c)d=0;this.ja[2*d+f].push(this.z[2*a]);this.ja[2*d+f].push(this.z[2*a+1])}};
jb.push({pb:function(a){a=new tb(a.l);a.id="lineString";a.Fc=function(a,c){return a.strokeColor[0]==c.strokeColor[0]&&a.strokeColor[1]==c.strokeColor[1]&&a.strokeColor[2]==c.strokeColor[2]&&a.strokeColor[3]==c.strokeColor[3]&&a.gb==c.gb};a.zb=sb;return a},nb:function(a,b){return"LineString"==a||"Polygon"==a&&!b.fill}});function tb(a){this.l=a;this.n=[{style:new ob,t:[]}];this.k=new U(this.l.a);Ra(this.k,"\tattribute vec3 vertex; \n\tuniform float zOffset; \n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 projectionMatrix;\n\t\n\tvoid main(void)  \n\t{ \n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z + zOffset, 1.0); \n\t} \n\t","\t#ifdef GL_ES \n\tprecision highp float; \n\t#endif \n\tuniform vec4 color; \n\t\n\tvoid main(void) \n\t{ \n\t\tgl_FragColor = color; \n\t} \n\t");
this.zb=this.Fc=t;this.id="empty"}tb.prototype.Mb=function(a){for(var b=0;b<this.n.length;b++)if(this.Fc(a,this.n[b].style))return this.n[b];a={style:a,t:[]};this.n.push(a);return a};function ub(a,b,c,d){if(d.v[a.id])for(var e=d.v[a.id].aa,f=0;f<e.length;f++)if(e[f].style==b&&e[f].$(c)&&d.children)for(f=0;4>f;f++)3==d.children[f].state&&ub(a,b,c,d.children[f])}
tb.prototype.$=function(a){for(var b=t,c=0;c<this.n.length;c++){var d=this.n[c].t.indexOf(a);-1!=d&&(b=this.n[c].zd,this.n[c].t.splice(d,1))}if(b)for(c=0;c<this.l.H.length;c++)ub(this,b,a,this.l.H[c])};tb.prototype.D=function(a,b){var c=this.Mb(b);c.t.push(a);for(var d=0;d<this.l.H.length;d++){var e=this.l.H[d];3==e.state&&vb(this,c.style,a,e)}};
function vb(a,b,c,d){var e=v,f;a:{if(d.v[a.id]){f=d.v[a.id].aa;for(var g=0;g<f.length;g++)if(f[g].style==b){f=f[g];break a}}f=t}f||(f=new a.zb(b,a.l.a.h),e=o);if(f.D(c,d)&&d.children)for(g=0;4>g;g++)3==d.children[g].state&&vb(a,b,c,d.children[g]);e&&wb(a,d,f)}function xb(){this.aa=[]}xb.prototype.T=function(){for(var a=0;a<this.aa.length;a++)this.aa[a].T();this.aa.length=0};function wb(a,b,c){0<c.b.length&&(b.v[a.id]||(b.v[a.id]=new xb),b.v[a.id].aa.push(c))}
tb.prototype.Va=function(a){if(a.parent)for(var b=a.parent.v[this.id],c=b?b.aa.length:0,d=0;d<c;d++){for(var e=b.aa[d],f=new this.zb(e.style,this.l.a.h),g=0;g<e.U.length;g++)f.D(e.U[g].rb,a);wb(this,a,f)}else for(d=0;d<this.n.length;d++){b=this.n[d];f=new this.zb(b.style,this.l.a.h);for(g=0;g<b.t.length;g++)f.D(b.t[g],a);wb(this,a,f)}};
tb.prototype.C=function(a){var b=this.l.a,c=b.h,d=H();this.k.apply();c.depthFunc(c.LEQUAL);c.uniformMatrix4fv(this.k.i.projectionMatrix,v,b.Y);for(var e=t,f=0;f<a.length;++f){var g=a[f];if(g.v[this.id]){ia(b.q,g.u,d);c.uniformMatrix4fv(this.k.i.modelViewMatrix,v,d);c.uniform1f(this.k.i.zOffset,7E-4*g.Z);for(var i=g.v[this.id].aa,j=0;j<i.length;j++){var h=i[j];h.style!=e&&(e=h.style,c.lineWidth(e.gb),c.uniform4f(this.k.i.color,e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeColor[3]));i[j].C(this.k.attributes)}}else if(3!=
g.state&&g.parent.v[this.id]){ia(b.q,g.parent.u,d);c.uniformMatrix4fv(this.k.i.modelViewMatrix,v,d);c.uniform1f(this.k.i.zOffset,7E-4*g.parent.Z);i=g.parent.v[this.id].aa;for(j=0;j<i.length;j++){h=i[j];h.style!=e&&(e=h.style,c.lineWidth(e.gb),c.uniform4f(this.k.i.color,e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeColor[3]));var h=i[j],l=this.k.attributes,m=g.$a;h.ja==t&&h.fc();var k=h.ja[m];if(0!=k.length){var n=h.h;h.m==t&&(h.m=n.createBuffer());n.bindBuffer(n.ARRAY_BUFFER,h.m);h.Aa&&
(n.bufferData(n.ARRAY_BUFFER,new Float32Array(h.b),n.STATIC_DRAW),h.Aa=v);n.vertexAttribPointer(l.vertex,3,n.FLOAT,v,0,0);(l=h.B[m])?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,l):(n=h.h,l=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,l),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(k),n.STATIC_DRAW),h.B[m]=l);n.drawElements(h.Nb,k.length,n.UNSIGNED_SHORT,0)}}}}c.depthFunc(c.LESS)};function Y(a){this.style=a&&a.style?a.style:new ob;this.t=[];this.c=t;this.type="Vector"}w=Y.prototype;w.kb=function(a){this.c=a;for(a=0;a<this.t.length;a++)yb(this,this.t[a])};w.lb=function(){for(var a=0;a<this.t.length;a++)this.c.Qa.$(this.t[a]);this.c=t};w.Jc=function(a){if(a=a.features)for(var b=0;b<a.length;b++)this.D(a[b])};
function yb(a,b){var c=b.geometry,d=a.style,e=b.properties;e&&e.style&&(d=e.style);if(e="LineString"==c.type)a:{for(var e=c.coordinates[0],f=e[0][0],g=1;g<e.length;g++){if(180<Math.abs(e[g][0]-f)){e=o;break a}coord=e[g]}e=v}if(e){b._crossDateLine=o;e=c.coordinates[0];for(f=0;f<e.length;f++)0>e[f][0]&&(e[f][0]+=360);g=[];for(f=0;f<e.length;f++)g[f]=[e[f][0]-360,e[f][1]];c._negCoordinates=[g]}if("GeometryCollection"==c.type){c=c.geometries;for(e=0;e<c.length;e++)f={type:"Feature",properties:b.properties,
geometry:c[e]},f.properties.style=d,a.c.Qa.D(f,d)}else a.c.Qa.D(b,d)}w.D=function(a){var b=a.geometry;b&&b.type&&(this.t.push(a),this.c&&(yb(this,a),P(this.c.a)))};w.$=function(a){this.t.splice(this.t.indexOf(a),1);this.c&&(this.c.Qa.$(a),P(this.c.a))};w.ed=function(a,b){this.c.Qa.$(a);this.c.Qa.D(a,b)};var zb={type:"FeatureCollection",t:[]},Ab={};function Bb(a){for(var b=[],a=a.trim().split(/[\s,]+/),c=0;c<a.length;c+=3)b.push([parseFloat(a[c]),parseFloat(a[c+1])]);return b}
function Cb(a){switch(a.nodeName){case "MultiGeometry":for(var b=[],a=a.childNodes,c=0;c<a.length;c++){var d=Cb(a[c]);d&&b.push(d)}return{type:"GeometryCollection",Nd:b};case "LineString":b=a.getElementsByTagName("coordinates");if(1==b.length)return{type:"LineString",kc:Bb(b[0].textContent)};break;case "Polygon":b=a.firstElementChild.getElementsByTagName("coordinates");if(1==b.length)return{type:"Polygon",kc:[Bb(b[0].textContent)]};break;case "Point":if(b=a.getElementsByTagName("coordinates"),1==
b.length)return b=b[0].textContent.split(","),{type:"Point",kc:[b[0],b[1]]}}return t}
function Db(a){var b="#"+a.getAttribute("id"),c=new ob;c.label=o;Ab[b]=c;for(a=a.firstElementChild;a;){switch(a.nodeName){case "LineStyle":for(var b=c,d=a.firstElementChild;d;){switch(d.nodeName){case "color":b.strokeColor=pb(d.childNodes[0].nodeValue);break;case "width":b.gb=parseFloat(d.childNodes[0].nodeValue)}d=d.nextElementSibling}break;case "IconStyle":b=c;for(d=a.firstElementChild;d;){switch(d.nodeName){case "Icon":b.sb=d.firstElementChild?d.firstElementChild.childNodes[0].nodeValue:t}d=d.nextElementSibling}break;
case "LabelStyle":b=c;for(d=a.firstElementChild;d;){switch(d.nodeName){case "color":0==pb(d.textContent.trim())[3]&&(b.label=v)}d=d.nextElementSibling}}a=a.nextElementSibling}return c}
function Eb(a){switch(a.nodeName){case "Placemark":for(var b={type:"Feature",Wb:{},Kb:t},a=a.firstElementChild;a;){switch(a.nodeName){case "name":b.Wb.name=a.childNodes[0].nodeValue;break;case "styleUrl":var c=a.childNodes[0].nodeValue;Ab.hasOwnProperty(c)&&(b.Wb.style=Ab[c]);break;case "Style":if(c=Db(a))b.Wb.style=c;break;default:b.Kb==t&&(b.Kb=Cb(a))}a=a.nextElementSibling}b.Kb&&zb.t.push(b);break;case "Document":case "Folder":a:for(b=a.firstElementChild;b;){switch(b.nodeName){case "visibility":if(0==
parseInt(b.textContent))break a;break;case "Style":Db(b);break;default:Eb(b)}b=b.nextElementSibling}}};function Fb(a,b,c){O.prototype.constructor.call(this);this.u=a;this.F=[];this.duration=b;this.Qc=c;this.vc=0}J(O,Fb);Fb.prototype.start=function(){O.prototype.start.call(this);wa(this.F[0][1],this.F[0][2],this.u)};Fb.prototype.stop=function(){O.prototype.stop.call(this);var a=this.F.length-1;wa(this.F[a][1],this.F[a][2],this.u);this.Qc()};
Fb.prototype.update=function(a){var b=qa(a,this.startTime,this.startTime+this.duration);if(1<=b)this.stop();else{for(var c=this.F.length,a=this.vc;a<c&&this.F[a][0]<b;)a++;var d=Math.max(0,a-1),b=map01(b,this.F[d][0],this.F[a][0]),c=C(),e=this.F[d][1],f=this.F[a][1],g=b,i=c;i||(i=e);i[0]=e[0]+g*(f[0]-e[0]);i[1]=e[1]+g*(f[1]-e[1]);i[2]=e[2]+g*(f[2]-e[2]);e=new ca(4);d=this.F[d][2];g=this.F[a][2];f=b;b=e;i=d[0]*g[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3];b||(b=new ca(4));0>i?(i=-i,b[0]=-g[0],b[1]=-g[1],b[2]=
-g[2],b[3]=-g[3]):(b[0]=g[0],b[1]=g[1],b[2]=g[2],b[3]=g[3]);if(0.9999>Math.abs(i)){var j=Math.sqrt(1-i*i),i=Math.atan2(j,i),g=Math.sin((1-f)*i)/j,j=Math.sin(f*i)/j;b[0]=d[0]*g+j*b[0];b[1]=d[1]*g+j*b[1];b[2]=d[2]*g+j*b[2];b[3]=d[3]*g+j*b[3]}else b[0]=d[0]+(g[0]-d[0])*f,b[1]=d[1]+(g[1]-d[1])*f,b[2]=d[2]+(g[2]-d[2])*f,b[3]=d[3]+(g[3]-d[3])*f,j||(j=b),d=b[0],f=b[1],g=b[2],b=b[3],i=Math.sqrt(d*d+f*f+g*g+b*b),0==i?(j[0]=0,j[1]=0,j[2]=0,j[3]=0):(i=1/i,j[0]=d*i,j[1]=f*i,j[2]=g*i,j[3]=b*i);wa(c,e,this.u);
this.vc=a}};function Gb(a,b){this.c=a;this.ta=H();this.wb=1;this.vb=1.90702569426E7;this.L=[0,0,0];this.j=3;this.heading=0;this.ya=90;for(var c in b)this[c]=b[c];this.tc||(this.tc=new gb);var d=this.tc;d.navigation=this;c=d.navigation.c.a.canvas;c.addEventListener("mousedown",function(a){a.preventDefault();a=a||window.event;d.ab=a.button;if(a.button==0||a.button==1){d.od=a.clientX;d.pd=a.clientY;d.Sb=a.clientX;d.Tb=a.clientY;ib(d.navigation,"start")}},v);document.addEventListener("mouseup",function(a){a=a||window.event;
d.ab=-1;(a.button==0||a.button==1)&&ib(d.navigation,"end")},v);c.addEventListener("mousemove",function(a){a=a||window.event;if(!(d.ab<0)){var b=a.clientX-d.Sb,c=a.clientY-d.Tb;if(d.ab==0){var i=d.navigation,j=c,c=C();da(i.L,c);var h=H();Fa(i.L,h);var l=C(),m=C([0,1,0]);l[0]=h[8];l[1]=h[9];l[2]=h[10];ja(h,m,m);Hb(i,h);var k=C(),n=C();k[0]=h[0];k[1]=h[1];k[2]=h[2];n[0]=h[4];n[1]=h[5];n[2]=h[6];fa(l,k,n);fa(n,l,k);G(k,k);G(n,n);b=b/i.c.a.canvas.width;j=j/i.c.a.canvas.height;l=C();Da(i.L,l);F(k,b*i.j,
k);F(n,j*i.j,n);E(l,k,l);ea(l,n,l);G(l);F(l,1);Ea(l,i.L);b=C([0,1,0]);Fa(i.L,h);ja(h,b,b);if(ha(m,b)<0)i.heading=(i.heading+180)%360;Ib(i);if(Jb(i)){i.L=c;Ib(i)}P(d.navigation.c.a)}else if(d.ab==1){d.navigation.rotate(b,c);P(d.navigation.c.a)}d.Sb=a.clientX;d.Tb=a.clientY}},v);d.Id&&c.addEventListener("dblclick",function(a){var b=a||window.event;if(b.button==0){var c=d.navigation.c.a,a=[];if(b.pageX||b.pageY){a[0]=b.pageX;a[1]=b.pageY}else{a[0]=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;
a[1]=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}for(b=c.canvas;b;){a[0]=a[0]-b.offsetLeft;a[1]=a[1]-b.offsetTop;b=b.offsetParent}(a=d.navigation.c.sc(a[0],a[1]))&&d.navigation.Ic(a)}},v);c.addEventListener("DOMMouseScroll",function(a){a.preventDefault();hb(d,a||window.event)},v);c.addEventListener("mousewheel",function(a){a.preventDefault();hb(d,a||window.event)},v);this.wb*=Q;this.vb*=Q;this.ia={};Ib(this)}w=Gb.prototype;
w.Bd=function(a,b){this.ia[a]?this.ia[a].push(b):this.ia[a]=[b]};w.Fd=function(a,b){if(this.ia[a]){var c=this.ia[a].indexOf(b);-1!=c&&this.ia[a].splice(c,1)}};function ib(a,b){if(a.ia[b])for(var c=a.ia[b],d=0;d<c.length;d++)c[d]()}
w.Ic=function(a,b,c,d){var e=this,f=b||this.j/(4*Q),b=d||90,d=[this.L[0],this.L[1],this.j,this.ya],f=[a[0],a[1],f*Q,b],c=new ya(c||5E3,function(a){e.L[0]=a[0];e.L[1]=a[1];e.j=a[2];e.ya=a[3];Ib(e)}),g=Da(this.L),a=Da(a),a=E(g,a),a=ga(a),g=this.c.a.canvas,g=Math.min(45*Math.PI/180,45*g.width/g.height*Math.PI/180),a=1.1*(a/2/Math.tan(g/2));a>this.j?(b=[0.5*d[0]+0.5*f[0],0.5*d[1]+0.5*f[1],a,b],Ca(c,0,d,0.5,b,function(a,b,c){var d=a*a;return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*ra(a),
b[3]+(c[3]-b[3])*a]}),Ca(c,0.5,b,1,f,function(a,b,c){var d=ra(a);return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*a*a,b[3]+(c[3]-b[3])*a]})):Ca(c,0,d,1,f,function(a,b,c){var d=ra(a);return[b[0]+(c[0]-b[0])*d,b[1]+(c[1]-b[1])*d,b[2]+(c[2]-b[2])*a*a,b[3]+(c[3]-b[3])*a]});c.Bc=function(){ib(e,"end")};c.c=this.c;c.start();ib(this,"start")};function Hb(a,b){la(b,a.heading*Math.PI/180,[0,0,1]);la(b,(90-a.ya)*Math.PI/180,[1,0,0])}
function Ib(a){Ga(a.L,a.ta);Hb(a,a.ta);var b=a.ta,c=[0,0,a.j],d=c[0],e=c[1],c=c[2];b[12]=b[0]*d+b[4]*e+b[8]*c+b[12];b[13]=b[1]*d+b[5]*e+b[9]*c+b[13];b[14]=b[2]*d+b[6]*e+b[10]*c+b[14];b[15]=b[3]*d+b[7]*e+b[11]*c+b[15];I(a.ta,a.c.a.q)}w.zoom=function(a){var b=this.j;this.j*=1+0.1*a;this.j>this.vb&&(this.j=this.vb);this.j<this.wb&&(this.j=this.wb);Ib(this);Jb(this)&&(this.j=b,Ib(this))};function Jb(a){var b=[a.ta[12],a.ta[13],a.ta[14]],c=C();Ea(b,c);a=a.c.Ca(c[0],c[1]);return c[2]<a+50}
w.rotate=function(a,b){var c=this.heading,d=this.ya;this.heading+=0.1*a;this.ya+=0.1*b;Ib(this);Jb(this)&&(this.heading=c,this.ya=d,Ib(this))};function fb(a){this.a=a;this.Rb=0.0025;this.bd=0.0015;this.Gc=15;this.Rc=2;this.cc=[0.65,0.57,0.475];this.Da=1;this.W=1.025*this.Da;this.la=this.ga=t;this.tb=v;this.eb=new U(a);Sa(this.eb,"SkyFromSpaceVert.glsl","SkyFrag.glsl");this.cb=new U(a);Sa(this.cb,"SkyFromAtmosphereVert.glsl","SkyFrag.glsl");this.Ya=new U(a);Sa(this.Ya,"GroundFromSpaceVert.glsl","GroundFrag.glsl");this.Xa=new U(a);Sa(this.Xa,"GroundFromAtmosphereVert.glsl","GroundFrag.glsl");if(this.tb=this.eb.o!=t&&this.cb.o!=t&&this.Ya.o!=
t&&this.Xa.o!=t){this.eb.apply();Kb(this,this.eb.i);this.cb.apply();Kb(this,this.cb.i);this.Ya.apply();Kb(this,this.Ya.i);this.Xa.apply();Kb(this,this.Xa.i);for(var b=[],c=[],d=-72;72>=d;d++)for(var e=d*0.5*Math.PI/72,f=-144;144>=f;f++){var g=f*Math.PI/144,i=this.W*Math.sin(g)*Math.cos(e),j=this.W*Math.sin(e);b.push(this.W*Math.cos(g)*Math.cos(e));b.push(i);b.push(j)}for(d=0;144>d;d++)for(f=0;288>f;f++)c.push(289*d+f),c.push(289*(d+1)+f+1),c.push(289*d+f+1),c.push(289*(d+1)+f+1),c.push(289*d+f),c.push(289*
(d+1)+f);this.wa=new Oa(a);Pa(this.wa,b);Qa(this.wa,c)}}
function Kb(a,b){var c=a.a.h,d=[1,1,1];G(d);c.uniform1f(b.fKrESun,a.Rb*a.Gc);c.uniform1f(b.fKmESun,a.Rb*a.Gc);c.uniform1f(b.fKr4PI,4*a.Rb*Math.PI);c.uniform1f(b.fKm4PI,4*a.bd*Math.PI);c.uniform1f(b.fExposure,a.Rc);var e=[Math.pow(a.cc[0],4),Math.pow(a.cc[1],4),Math.pow(a.cc[2],4)];c.uniform3f(b.v3InvWavelength,1/e[0],1/e[1],1/e[2]);c.uniform3f(b.v3LightPos,d[0],d[1],d[2]);c.uniform1f(b.fInnerRadius,a.Da);c.uniform1f(b.fInnerRadius2,a.Da*a.Da);c.uniform1f(b.fOuterRadius,a.W);c.uniform1f(b.fOuterRadius2,
a.W*a.W);c.uniform1f(b.fScale,1/(a.W-a.Da));c.uniform1f(b.fScaleDepth,0.25);c.uniform1f(b.fScaleOverScaleDepth,1/(a.W-a.Da)/0.25);c.uniform1f(b.g,-0.95);c.uniform1f(b.g2,0.9025)}fb.prototype.C=function(){if(this.tb){var a=this.a.h;a.enable(a.CULL_FACE);this.ga.apply();a.uniformMatrix4fv(this.ga.i.projectionMatrix,v,this.a.Y);a.uniformMatrix4fv(this.ga.i.viewMatrix,v,this.a.q);this.wa.C(this.ga.attributes)}};function Lb(a,b){this.ub=a;this.Vb=b}Lb.prototype.qc=function(a){a.Ia=1;a.Ta=1;for(var b=[],c=180/this.Vb,d=360/this.ub,e=0;e<this.Vb;e++)for(var f=0;f<this.ub;f++){var g=new Z(new K(-180+f*d,-90+e*c,-180+(f+1)*d,-90+(e+1)*c));g.f=a;b.push(g)}return b};Lb.prototype.wc=function(a,b){return Math.floor((b+90)*this.Vb/180)*this.ub+Math.floor((a+180)*this.ub/360)};function Z(a){Ua.prototype.constructor.call(this);this.e=a}Z.prototype=new Ua;
Z.prototype.Ca=function(a,b){var c=(a-this.e.r)/(this.e.G-this.e.r),d=(b-this.e.s)/(this.e.J-this.e.s),e=2*(1<=d?1:Math.floor(2*d))+Math.floor(2*c);if(this.children&&3==this.children[e].state)return this.children[e].Ca(a,b);e=this.f.A;c=this.f.O*(Math.floor(d*e)*e+Math.floor(c*e));c=[this.b[c],this.b[c+1],this.b[c+2]];ja(this.u,c);return Ea(c)[2]};
Z.prototype.lc=function(){var a=0.5*(this.e.G+this.e.r),b=0.5*(this.e.s+this.e.J),c=new Z(new K(this.e.r,b,a,this.e.s)),d=new Z(new K(a,b,this.e.G,this.e.s)),e=new Z(new K(this.e.r,this.e.J,a,b)),a=new Z(new K(a,this.e.J,this.e.G,b));Xa(c,this,0,0);Xa(d,this,1,0);Xa(e,this,0,1);Xa(a,this,1,1);this.children=[c,d,e,a]};
Z.prototype.rc=function(a){this.u=Ga(this.e.Lb());var b=H();I(this.u,b);this.Fa=b;for(var c=this.f.O,d=this.f.A,e=new Float32Array(c*d*(d+6)),f=(this.e.G-this.e.r)/(d-1),g=(this.e.J-this.e.s)/(d-1),i=0,j=this.e.s*Math.PI/180,g=g*Math.PI/180,f=f*Math.PI/180,h=0;h<d;h++){for(var l=Math.cos(j),m=Math.sin(j),k=this.e.r*Math.PI/180,n=0;n<d;n++){var p=a?Q*a[i]:0,q=(1+p)*Math.cos(k)*l,r=(1+p)*Math.sin(k)*l,p=(1+p)*m,s=i*c;e[s]=b[0]*q+b[4]*r+b[8]*p+b[12];e[s+1]=b[1]*q+b[5]*r+b[9]*p+b[13];e[s+2]=b[2]*q+b[6]*
r+b[10]*p+b[14];i++;k+=f}j+=g}return e};function Mb(a){this.Zb=a}Mb.prototype.qc=function(a){a.Ia=o;a.Ta=1;for(var b=[],c=Math.pow(2,this.Zb),d=Math.pow(2,this.Zb),e=0;e<d;e++)for(var f=0;f<c;f++){var g=new Nb(this.Zb,f,e);g.f=a;b.push(g)}return b};Mb.prototype.wc=function(){return 0};function Ob(a,b){var c=Math.PI-2*Math.PI*a/Math.pow(2,b);return 180/Math.PI*Math.atan(0.5*(Math.exp(c)-Math.exp(-c)))}
function Nb(a,b,c){Ua.prototype.constructor.call(this);this.ua=a;this.x=b;this.y=c;this.e=new K(360*(b/Math.pow(2,a))-180,Ob(c+1,a),360*((b+1)/Math.pow(2,a))-180,Ob(c,a))}Nb.prototype=new Ua;Nb.prototype.Ca=function(){return 0};Nb.prototype.lc=function(){var a=new Nb(this.ua+1,2*this.x,2*this.y),b=new Nb(this.ua+1,2*this.x+1,2*this.y),c=new Nb(this.ua+1,2*this.x,2*this.y+1),d=new Nb(this.ua+1,2*this.x+1,2*this.y+1);Xa(a,this,0,0);Xa(b,this,1,0);Xa(c,this,0,1);Xa(d,this,1,1);this.children=[a,b,c,d]};
Nb.prototype.rc=function(a){this.u=Ga(this.e.Lb());var b=H();I(this.u,b);this.Fa=b;for(var c=this.f.A,d=new Float32Array(3*c*(c+6)),e=1/(c-1),f=0,g=Math.pow(2,this.ua),i=this.y,j=0;j<c;j++){for(var h=Math.PI*(1-2*i/g),l=Math.atan(0.5*(Math.exp(h)-Math.exp(-h))),h=Math.cos(l),l=Math.sin(l),m=this.x,k=0;k<c;k++){var n=Math.PI*(2*m/g-1),p=a?Q*a[f]:0,q=(1+p)*Math.cos(n)*h,n=(1+p)*Math.sin(n)*h,p=(1+p)*l,r=3*f;d[r]=b[0]*q+b[4]*n+b[8]*p+b[12];d[r+1]=b[1]*q+b[5]*n+b[9]*p+b[13];d[r+2]=b[2]*q+b[6]*n+b[10]*
p+b[14];f++;m+=e}i+=e}return d};function Pb(a){V.prototype.constructor.call(this,a);this.ca=a.baseUrl;this.R=a.tilePixelSize||256;this.Na=new Lb(4,2);this.Ha=a.numberOfLevels||21;this.type="ImageryRaster";var b=this.ca,b=-1==b.indexOf("?",0)?b+"?service=wms":b+"&service=wms",b=b+"&version="+(a.hasOwnProperty("version")?a.version:"1.1.1"),b=b+"&request=GetMap&srs="+(a.hasOwnProperty("srs")?a.srs:"EPSG:4326"),b=b+("&layers="+a.layers);a.hasOwnProperty("styles")&&(b+="&styles="+a.zd);b=b+"&format="+(a.hasOwnProperty("format")?a.format:
"image/jpeg");b=b+"&width="+this.R;this.Uc=b=b+"&height="+this.R}J(V,Pb);Pb.prototype.Wa=function(a){var a=a.e,b=this.Uc,b=b+"&bbox="+a.r,b=b+","+a.J,b=b+","+a.G;return b=b+","+a.s};function Qb(a){a.format="image/x-aaigrid";a.tilePixelSize=a.tilePixelSize||33;Pb.prototype.constructor.call(this,a)}J(Pb,Qb);Qb.prototype.Cc=function(a){for(var b=[],a=a.trim().split("\n"),c=5;c<a.length;c++)for(var d=a[c].trim().split(/\s+/),e=0;e<d.length;e++)b.push(parseInt(d[e]));return b};var Rb;Rb={Ed:function(a,b,c){for(var d="";0<c;c--){var e="0",f=1<<c-1;0!=(a&f)&&e++;0!=(b&f)&&(e++,e++);d+=e}return d},Rd:function(a,b,c){a=Math.min(Math.max(a,-85.05112878),85.05112878);b=Math.min(Math.max(b,-180),180);b=(b+180)/360;a=Math.sin(a*Math.PI/180);a=0.5-Math.log((1+a)/(1-a))/(4*Math.PI);c=256<<c;b=Math.min(Math.max(b*c+0.5,0),c-1);c=Math.min(Math.max(a*c+0.5,0),c-1);return[Math.floor(b),Math.floor(c)]}};
function Sb(a){V.prototype.constructor.call(this,a);this.R=256;this.Na=new Mb(a.Lc||2);this.Ha=18;this.type="ImageryRaster";this.Xb=v;this.ca="";this.Cb=[];var b=this;window._bingTileProviderCallback=function(c){b.ca=c.rd[0].sd[0].Pd;b.Cb=c.rd[0].sd[0].Qd;b.Xb=o;a.Ac&&a.Ac instanceof Function&&a.Ac(b);b.c&&P(b.c.a)};var c=document.createElement("script");c.type="text/javascript";c.src="http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+a.Od+"?jsonp=_bingTileProviderCallback&key="+a.key;c.id="_bingTileProviderCallback";
document.getElementsByTagName("head")[0].appendChild(c)}J(V,Sb);Sb.prototype.Wa=function(a){return this.ca.replace("{quadkey}",Rb.Ed(a.x,a.y,a.ua)).replace("{subdomain}",this.Cb[Math.floor(Math.random()*this.Cb.length)])};function Tb(a){V.prototype.constructor.call(this,a);this.R=a.R||256;this.Na=new Mb(a.Lc||2);this.Ha=a.Ha||21;this.type="ImageryRaster";this.ca=a.ca}J(V,Tb);Tb.prototype.Wa=function(a){return this.ca+"/"+a.ua+"/"+a.x+"/"+a.y+".png"};function Ub(a){V.prototype.constructor.call(this,a);this.R=a.tilePixelSize||33;this.Na=new Lb(4,2);this.Ha=a.numberOfLevels||21;this.type="ElevationRaster";this.ca=a.baseUrl}J(V,Ub);Ub.prototype.Wa=function(a){var a=a.e,b=this.ca,b=b+"?extent="+a.r,b=b+","+a.J,b=b+","+a.G,b=b+","+a.s,b=b+"&size="+this.R;return b=b+","+this.R};Ub.prototype.Cc=function(a){for(var a=JSON.parse(a),b=0;b<a.length;b++)0>a[b]&&(a[b]=0);return a};window.GlobWeb={};window.GlobWeb.Globe=W;window.GlobWeb.Navigation=Gb;window.GlobWeb.Stats=na;window.GlobWeb.KMLParser={parse:function(a){for(a=a.documentElement.firstElementChild;a;)Eb(a),a=a.nextElementSibling;return zb}};window.GlobWeb.WMSLayer=Pb;window.GlobWeb.WMSElevationLayer=Qb;window.GlobWeb.OSMLayer=Tb;window.GlobWeb.BingLayer=Sb;window.GlobWeb.BasicElevationLayer=Ub;window.GlobWeb.VectorLayer=Y;window.GlobWeb.GroundOverlayLayer=ba.Jd;W.prototype.addLayer=W.prototype.Kc;
W.prototype.removeLayer=W.prototype.qd;W.prototype.dispose=W.prototype.T;W.prototype.getLonLatFromPixel=W.prototype.sc;W.prototype.getViewportGeoBound=W.prototype.Xc;W.prototype.setBaseImagery=W.prototype.vd;W.prototype.setBaseElevation=W.prototype.ud;W.prototype.refresh=W.prototype.refresh;Y.prototype.addFeatureCollection=Y.prototype.Jc;Y.prototype.addFeature=Y.prototype.D;Y.prototype.modifyFeatureStyle=Y.prototype.ed;Y.prototype.removeFeature=Y.prototype.$;Gb.prototype.zoomTo=Gb.prototype.Ic;
Gb.prototype.subscribe=Gb.prototype.Bd;Gb.prototype.unsubscribe=Gb.prototype.Fd;window.GlobWeb.PathAnimation=X;X.prototype.stop=X.prototype.stop;X.prototype.start=X.prototype.start;X.prototype.setAltitudeOffset=X.prototype.td;X.prototype.setDirectionAngle=X.prototype.wd;X.prototype.setSpeed=X.prototype.xd;window.GlobWeb.GeoBound=K;K.prototype.getSouth=K.prototype.Wc;K.prototype.getNorth=K.prototype.Vc;K.prototype.getEast=K.prototype.Tc;K.prototype.getWest=K.prototype.Yc;
